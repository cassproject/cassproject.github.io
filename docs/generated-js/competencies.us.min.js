var AddFieldModal=function(e){e.prototype.display=function(e){var k=this.field,d=ViewManager.getView(this.repoEditContainerId);ViewManager.showView(new MessageContainer("addField"),"#addFieldMessageContainer");0<k.children("ul").length?$(".objectProperties").hide():$(".objectProperties").show();void 0!=d?($("#addFieldModalText").click(function(){var b=$("#addFieldModalName").val();""!=b?(ViewManager.getView("#addFieldMessageContainer").clearAlert("emptyText"),0<k.find("[field\x3d"+b+"]").size()?ViewManager.getView("#addFieldMessageContainer").displayAlert("Field with that name already exists",
"exists"):(d.addField(k,b,"value"),ModalManager.hideModal())):0<k.children("ul").length?(d.addField(k,b,"value"),ModalManager.hideModal()):ViewManager.getView("#addFieldMessageContainer").displayAlert("Unable to add Text without a field name","emptyText")}),$("#addFieldModalArray").click(function(){var b=$("#addFieldModalName").val();""!=b?(ViewManager.getView("#addFieldMessageContainer").clearAlert("emptyArr"),0<k.find("[field\x3d"+b+"]").size()?ViewManager.getView("#addFieldMessageContainer").displayAlert("Field with that name already exists",
"exists"):(d.addField(k,b,[]),ModalManager.hideModal())):0<k.children("ul").length?(d.addField(k,b,[]),ModalManager.hideModal()):ViewManager.getView("#addFieldMessageContainer").displayAlert("Unable to add Array without a field name","emptyArr")}),$("#addFieldModalJsonLd").click(function(){var b=$("#addFieldModalName").val();""!=b||0<k.children("ul").length?(ViewManager.getView("#addFieldMessageContainer").clearAlert("emptyObj"),""!=b&&0<k.find("[field\x3d"+b+"]").size()&&0==k.children("ul").length?
ViewManager.getView("#addFieldMessageContainer").displayAlert("Field with that name already exists","exists"):($("#typeSelectRow").removeClass("hide"),$("#addBtn").click(function(){if(""!=b&&0<k.find("[field\x3d"+b+"]").size())ViewManager.getView("#addFieldMessageContainer").displayAlert("Field with that name already exists","exists");else if(""!=b||0<k.children("ul").length){var h=new Thing;d.addField(k,b,h.toJson());ModalManager.hideModal()}else ViewManager.getView("#addFieldMessageContainer").displayAlert("Unable to add Object without a field name",
"emptyObj")}))):ViewManager.getView("#addFieldMessageContainer").displayAlert("Unable to add Object without a field name","emptyObj")})):ViewManager.getView("#addFieldMessageContainer").displayAlert("Unable to add Field, are you sure you're on the right page?","addField");$("#addFieldModalCancel").click(function(){ModalManager.hideModal()})};return e}(AddFieldModal),AddOwnerModal=function(e){e.prototype.display=function(e){var k=this.field,d=this.objectContainerId;ViewManager.showView(new MessageContainer("addOwner"),
"#addOwnerMessageContainer");e=k.children("div").children("[field\x3d'@owner']").find("ul").find(".identityDisplay");for(var b=[],h=0;h<e.size();h++){var g=e.get(h),g=$(g).attr("data-pk");b.push(g)}ViewManager.showView(new DataViewer("addOwner",{buildMenu:function(){},buildRowToolbar:function(){},buildDataRow:function(b,c,f){c=$("\x3cdiv class\x3d'small-12 columns'\x3e\x3c/div\x3e");c.text(f.displayName);c.attr("title",f.pk.toPem());b.append(c);b.attr("data-id",f.pk.toPem())}}),"#contactDisplay",
function(){var g={},c;for(c in EcIdentityManager.contacts){var f=EcIdentityManager.contacts[c];if(void 0!=f.pk&&-1==b.indexOf(f.pk.toPem())){var a=new EcContact;a.displayName=f.displayName;a.pk=f.pk;a.id=a.pk.toPem();g[a.pk.toPem()]=a}}for(c in EcIdentityManager.ids)f=EcIdentityManager.ids[c],void 0!=f.ppk&&-1==b.indexOf(f.ppk.toPk().toPem())&&(a=new EcContact,a.displayName=f.displayName,a.pk=f.ppk.toPk(),a.id=a.pk.toPem(),g[a.pk.toPem()]=a);ViewManager.getView("#contactDisplay").populate(g);$("#addOwner-data").css("border",
"1px solid #b3b3b3");$("#addOwner-none").text("No Identities or Contacts available")});$("#addOwnerSubmit").click(function(){var b=$("#ownerKeyPaste").text();if(void 0==b||""==b){var b=ViewManager.getView("#contactDisplay").getSelected(),c;for(c in b)ViewManager.getView(d).addOwner(k,b[c].pk.toPem())}else ViewManager.getView(d).addOwner(k,b);ModalManager.hideModal()});$("#addOwnerModalCancel").click(function(){ModalManager.hideModal()})};return e}(AddOwnerModal),AddServerModal=function(e){function l(d){var b=
$("#addServerName").val();d=$("#addServerUrl").val();var h=new EcRepository;h.selectedServer=d;h.autoDetectRepositoryAsync(function(){AppController.serverController.addServer(b,h.selectedServer,function(){AppController.serverController.selectServer(b,function(){AppController.loginController.getLoggedIn()&&(AppController.loginController.setLoggedIn(!1),ViewManager.getView("#menuContainer").setLoggedOut());AppMenu.prototype.setCurrentServer();ModalManager.hideModal()})},k)},k)}function k(d){ViewManager.getView("#addServerMessageContainer").displayAlert(d)}
e.prototype.display=function(d){var b=this.onClose;ViewManager.showView(new MessageContainer("addServer"),"#addServerMessageContainer");void 0!=this.server&&null!=this.server&&($("#addServerUrl").val(this.server).attr("disabled","disabled"),$("#addServerMessage").text("It looks like you are coming from a new CASS server. Enter a name below to identify it for future use. This will only be available to your computer."));$("#addServerForm").submit(function(h){h.preventDefault();l(b)});$("#addServerCancel").click(function(h){h.preventDefault();
ModalManager.hideModal();b()})};return e}(AddServerModal),AddToFrameworkModal=function(e){function l(d){ViewManager.getView("#addToFrameworkMessageContainer").displayAlert(d)}function k(d){var b=$("\x3coption\x3e\x3c/option\x3e");b.val(d.id);b.text(d.name+(void 0==d.owner?" (Public)":""));return b}e.prototype.display=function(d){var b=this.data;ViewManager.showView(new MessageContainer("addToFramework"),"#addToFrameworkMessageContainer",function(){if(b instanceof Array){var h=!1,g=!1,d=!1,c;for(c in b)void 0!=
b[c].type?-1!=(new EcCompetency).getTypes().indexOf(b[c].getFullType())?h=!0:-1!=(new EcAlignment).getTypes().indexOf(b[c].getFullType())?g=!0:(d=!0,ViewManager.getView("#addToFrameworkMessageContainer").displayWarning("Unsure how to add object ("+b[c].id+") with type ("+b[c].type+") to framework","unknownType")):(d=!0,ViewManager.getView("#addToFrameworkMessageContainer").displayWarning("Unsure how to add object ("+b[c].id+") with no type to framework","noType"));d||g&&h?1<b.length?$("#dataDescription").text("the objects"):
$("#dataDescription").text("the object"):g?1<b.length?$("#dataDescription").text("the relations"):$("#dataDescription").text("the relation"):h&&(1<b.length?$("#dataDescription").text("the competencies"):$("#dataDescription").text("the competency"))}else void 0!=b.id&&(void 0!=b.type?-1!=EcCompetency.getTypes().indexOf(b.getFullType())?$("#dataDescription").text("the competency"):-1!=EcAlignment.getTypes().indexOf(b.getFullType())?$("#dataDescription").text("the relation"):ViewManager.getView("#addToFrameworkMessageContainer").displayWarning("Unsure how to add object ("+
b[c].id+") with type ("+b[c].type+") to framework","unknownType"):ViewManager.getView("#addToFrameworkMessageContainer").displayWarning("Unsure how to add object ("+b[c].id+") with no type to framework","noType"))});EcFramework.search(AppController.serverController.getRepoInterface(),"*",function(b){$("#addToFrameworkList").html();for(var g in b)AppController.identityController.canEdit(b[g])&&$("#addToFrameworkList").append(k(b[g]));0==$("#addToFrameworkList option").size()&&($("#addToFrameworkList").append("\x3coption selected\x3eUnable to add to any Frameworks\x3c/option\x3e"),
$("#addToFrameworkList").attr("disabled","disabled"),ViewManager.getView("#addToFrameworkMessageContainer").displayAlert("Must have editing priviledges on a framework to add competencies"))},l);$("#addToFrameworkSave").click(function(h){h.preventDefault();h=$("#addToFrameworkList").val();EcFramework.get(h,function(g){if(b instanceof Array)for(var h in b)void 0!=b[h].type?-1!=(new EcCompetency).getTypes().indexOf(b[h].getFullType())?g.addCompetency(b[h].id):-1!=(new EcAlignment).getTypes().indexOf(b[h].getFullType())&&
g.addRelation(b[h].id):ViewManager.getView("#addToFrameworkMessageContainer").displayWarning("Unsure how to add object ("+b[h].id+") with unknown type to framework","unknownType");else if(void 0!=b.id)if(void 0!=b.type)if(-1!=(new EcCompetency).getTypes().indexOf(b.getFullType()))g.addCompetency(b.id);else if(-1!=(new EcAlignment).getTypes().indexOf(b.getFullType()))g.addRelation(b.id);else return;else g.addCompetency(b.id);g.save(function(){ModalManager.hideModal();ScreenManager.changeScreen(new FrameworkViewScreen(g))},
l)},l)});$("#addToFrameworkCancel").click(function(){ModalManager.hideModal()})};return e}(AddToFrameworkModal),AdvancedPermissionsModal=function(e){function l(b){$("#advancedPermissionsAddOwner").typeahead("val","");var h;h=void 0!=b.pk?b.pk:b.ppk.toPk();1==$("#advancedPermissionsOwners option").size()&&($("#noOwners").addClass("hide"),$("#advancedPermissionsOwners").removeClass("empty"),$("#advancedPermissionsOwners").removeAttr("disabled"));var g=$("\x3coption\x3e\x3c/option\x3e");g.val(h.toPem());
g.text(b.displayName);$("#advancedPermissionsOwners").append(g)}function k(b){$("#advancedPermissionsAddReader").typeahead("val","");var h;h=void 0!=b.pk?b.pk:b.ppk.toPk();1==$("#advancedPermissionsReaders option").size()&&($("#noReaders").addClass("hide"),$("#advancedPermissionsReaders").removeClass("empty"),$("#advancedPermissionsReaders").removeAttr("disabled"));var g=$("\x3coption\x3e\x3c/option\x3e");g.val(h.toPem());g.text(b.displayName);$("#advancedPermissionsReaders").append(g)}function d(){$("#advancedPermissionsAddOwner").typeahead({hint:!1,
highlight:!0,minLength:2},{name:"contacts",source:function(b,h,g){b=[];for(var d in EcIdentityManager.ids)b.push(EcIdentityManager.ids[d]);for(d in EcIdentityManager.contacts)b.push(EcIdentityManager.contacts[d]);for(d=0;d<b.length;d++){g=void 0!=b[d].pk?b[d].pk:b[d].ppk.toPk();var c=$("#advancedPermissionsOwners option").map(function(f,a){return $(a).attr("value")});if(-1!=c.toArray().indexOf(g.toPem())||void 0==b[d].source)b.splice(d,1),d--;else if(c=$("#advancedPermissionsReaders option").map(function(f,
a){return $(a).attr("value")}),-1!=c.toArray().indexOf(g.toPem())||void 0==b[d].source)b.splice(d,1),d--}h(b)},async:!1,display:function(b){return b.displayName},templates:{suggestion:function(b){return"\x3cdiv\x3e"+b.displayName+"\x3c/div\x3e"},notFound:function(){return"\x3cdiv style\x3d'text-align:center'\x3eNo Identies or Contacts Found\x3c/div\x3e"}}}).bind("typeahead:selected",function(b,h){l(h);b=$("#advancedPermissionsOwners option").map(function(b,c){if(void 0!=$(c).attr("value"))return $(c).attr("value")}).toArray();
h=new EcRemoteLinkedData;h.owner=[];for(var g in b)h.addOwner(EcPk.fromPem(b[g]));AppController.identityController.canEdit(h)?ViewManager.getView("#advancedPermissionsMessageContainer").clearWarning("lostOwnership"):ViewManager.getView("#advancedPermissionsMessageContainer").displayWarning("This will prevent further modifications by you, as you no longer own the object(s)","lostOwnership");ViewManager.getView("#advancedPermissionsMessageContainer").clearWarning("public")}).bind("typeahead:autocompleted",
function(b,h){l(h);b=$("#advancedPermissionsOwners option").map(function(b,c){if(void 0!=$(c).attr("value"))return $(c).attr("value")}).toArray();h=new EcRemoteLinkedData;h.owner=[];for(var g in b)h.addOwner(EcPk.fromPem(b[g]));AppController.identityController.canEdit(h)?ViewManager.getView("#advancedPermissionsMessageContainer").clearWarning("lostOwnership"):ViewManager.getView("#advancedPermissionsMessageContainer").displayWarning("This will prevent further modifications by you, as you no longer own the object(s)",
"lostOwnership");ViewManager.getView("#advancedPermissionsMessageContainer").clearWarning("public")});$("#advancedPermissionsAddReader").typeahead({hint:!1,highlight:!0,minLength:2},{name:"contacts",source:function(b,h,g){b=[];for(var d in EcIdentityManager.ids)b.push(EcIdentityManager.ids[d]);for(d in EcIdentityManager.contacts)b.push(EcIdentityManager.contacts[d]);for(d=0;d<b.length;d++){g=void 0!=b[d].pk?b[d].pk:b[d].ppk.toPk();var c=$("#advancedPermissionsOwners option").map(function(f,a){return $(a).attr("value")});
if(-1!=c.toArray().indexOf(g.toPem())||void 0==b[d].source)b.splice(d,1),d--;else if(c=$("#advancedPermissionsReaders option").map(function(f,a){return $(a).attr("value")}),-1!=c.toArray().indexOf(g.toPem())||void 0==b[d].source)b.splice(d,1),d--}h(b)},async:!1,display:function(b){return b.displayName},templates:{suggestion:function(b){return"\x3cdiv\x3e"+b.displayName+"\x3c/div\x3e"},notFound:function(){return"\x3cdiv style\x3d'text-align:center'\x3eNo Identies or Contacts Found\x3c/div\x3e"}}}).bind("typeahead:selected",
function(b,h){k(h)}).bind("typeahead:autocompleted",function(b,h){k(h)})}e.prototype.display=function(b){var h=this.data,g=this.saveCallback,k=this.onlyReaders,c={},f={};ViewManager.showView(new MessageContainer("advancedPermissions"),"#advancedPermissionsMessageContainer",function(){for(var a in c)ViewManager.getView("#advancedPermissionsMessageContainer").displayAlert(c[a],a);for(a in f)ViewManager.getView("#advancedPermissionsMessageContainer").displayWarning(f[a],a)});b=!0;if(h instanceof Array){f[0]=
"Modifying multiple resources, all resources will have the same permissions if saved";ViewManager.getView("#advancedPermissionsMessageContainer").displayWarning("Modifying multiple resources, all resources will have the same permissions if saved");for(var a in h)void 0==h[a].owner?(c["public"]="One or more objects is public, Cannot Modify Permissions",ViewManager.getView("#advancedPermissionsMessageContainer").displayAlert("One or more objects is public, Cannot Modify Permissions","public"),b=!1):
AppController.identityController.owns(h[a])||(c.notOwned="One or more objects not owned by you, Cannot Modify Permissions",ViewManager.getView("#advancedPermissionsMessageContainer").displayAlert("One or more objects not owned by you, Cannot Modify Permissions","notOwned"),b=!1),h[a].type==EcEncryptedValue.type&&(f.decrypt="May be decrypting an object by setting all public",ViewManager.getView("#advancedPermissionsMessageContainer").displayWarning("May be decrypting an object by setting all public",
"decrypt"))}else void 0==h.owner?(c["public"]="Cannot Modify Permissions of Public Object",ViewManager.getView("#advancedPermissionsMessageContainer").displayAlert("Cannot Modify Permissions of Public Object","public"),$("#noOwners").removeClass("public"),$("#advancedPermissionsOwners").addClass("empty"),b=!1):AppController.identityController.owns(h)||(c.notOwned="Cannot Modify Permissions of Object not owned by you",ViewManager.getView("#advancedPermissionsMessageContainer").displayAlert("Cannot Modify Permissions of Object not owned by you",
"notOwned"),b=!1);if(b){k?($("#advancedPermissionsAddOwner").prop("disabled","disabled"),$("#advancedPermissionsOwners").prop("disabled","disabled"),$("#privateSwitch").prop("checked",!0),$("#privateSwitch").prop("disabled","disabled"),$("#ownerRow").addClass("hide"),$("#privacyRow").addClass("hide"),$("#readerRow").is(":visible")||$("#readerRow").slideDown()):$("#privateSwitch").change(function(){1==$("#advancedPermissionsOwners option").size()&&"disabled"==$("#advancedPermissionsOwners").attr("disabled")?
($("#privateSwitch").prop("checked",!1),ViewManager.getView("#advancedPermissionsMessageContainer").displayAlert("Cannot encrypt a publicly owned object","publicPrivate")):($("#readerRow").slideToggle(),h instanceof Array?$("#privateSwitch").prop("checked")?ViewManager.getView("#advancedPermissionsMessageContainer").clearWarning("decrypt"):ViewManager.getView("#advancedPermissionsMessageContainer").displayWarning("May be decrypting an object by setting all public","decrypt"):EcEncryptedValue.encryptOnSave(h.id,
!0)&&!$("#privateSwitch").prop("checked")?ViewManager.getView("#advancedPermissionsMessageContainer").displayWarning("Decrypting object by setting it public","decrypt"):ViewManager.getView("#advancedPermissionsMessageContainer").clearWarning("decrypt"))});if(h instanceof Array)void 0!=AppController.identityController.selectedIdentity?(b=$("\x3coption\x3e\x3c/option\x3e"),b.val(AppController.identityController.selectedIdentity.ppk.toPk().toPem()),b.text(AppController.identityController.selectedIdentity.displayName),
$("#advancedPermissionsOwners").append(b)):($("#noOwners").removeClass("hide"),$("#advancedPermissionsOwners").attr("disabled","disabled"),$("#advancedPermissionsOwners").addClass("empty"));else{for(a in h.owner)b=$("\x3coption\x3e\x3c/option\x3e"),b.val(h.owner[a]),b.attr("title",h.owner[a]),b.text(AppController.identityController.lookup(h.owner[a]).displayName),$("#advancedPermissionsOwners").append(b);for(a in h.reader)b=$("\x3coption\x3e\x3c/option\x3e"),b.val(h.reader[a]),b.attr("title",h.reader[a]),
b.text(AppController.identityController.lookup(h.reader[a]).displayName),$("#advancedPermissionsReaders").append(b),$("#noReaders").addClass("hide"),$("#advancedPermissionsReaders").removeAttr("disabled"),$("#advancedPermissionsReaders").removeClass("empty")}EcEncryptedValue.encryptOnSave(h.id)&&($("#privateSwitch").prop("checked",!0),$("#readerRow").css("display","block"));$("#advancedPermissionsOwners").focus(function(){$("#advancedPermissionsOwners").css("margin-bottom","0px");$("#advancedPermissionsDeleteOwner").slideDown();
$("#advancedPermissionsOwners").blur(function(){$("#advancedPermissionsDeleteOwner").slideUp(function(){$("#advancedPermissionsOwners").removeAttr("style")})})});$("#advancedPermissionsDeleteOwner").click(function(){$("#advancedPermissionsOwners option[value\x3d'"+$("#advancedPermissionsOwners").val()+"']").remove();if(1==$("#advancedPermissionsOwners option").size())$("#noOwners").removeClass("hide"),$("#advancedPermissionsOwners").attr("disabled","disabled"),$("#advancedPermissionsOwners").addClass("empty"),
ViewManager.getView("#advancedPermissionsMessageContainer").displayWarning("Public objects will not allow futher modifications of permissions","public");else{ViewManager.getView("#advancedPermissionsMessageContainer").clearWarning("public");var a=$("#advancedPermissionsOwners option").map(function(a,f){if(void 0!=$(f).attr("value"))return $(f).attr("value")}).toArray(),f=new EcRemoteLinkedData;f.owner=[];for(var c in a)f.addOwner(EcPk.fromPem(a[c]));AppController.identityController.canEdit(f)?ViewManager.getView("#advancedPermissionsMessageContainer").clearWarning("lostOwnership"):
ViewManager.getView("#advancedPermissionsMessageContainer").displayWarning("This will prevent further modifications by you, as you no longer own the object(s)","lostOwnership")}});$("#advancedPermissionsReaders").focus(function(){$("#advancedPermissionsReaders").css("margin-bottom","0px");$("#advancedPermissionsDeleteReader").slideDown();$("#advancedPermissionsReaders").blur(function(){$("#advancedPermissionsDeleteReader").slideUp(function(){$("#advancedPermissionsReaders").removeAttr("style")})})});
$("#advancedPermissionsDeleteReader").click(function(){$("#advancedPermissionsReaders option[value\x3d'"+$("#advancedPermissionsReaders").val()+"']").remove();1==$("#advancedPermissionsReaders option").size()&&($("#noReaders").removeClass("hide"),$("#advancedPermissionsReaders").attr("disabled","disabled"),$("#advancedPermissionsReaders").addClass("empty"))});d();$("#advancedPermissionsSave").click(function(a){a.preventDefault();a=$("#advancedPermissionsOwners option").map(function(a,f){if(void 0!=
$(f).attr("value"))return $(f).attr("value")}).toArray();var f=$("#advancedPermissionsReaders option").map(function(a,f){if(void 0!=$(f).attr("value"))return $(f).attr("value")}).toArray();if(h instanceof Array)for(var m in h){h[m].owner=[];for(var c in a)k||h[m].addOwner(EcPk.fromPem(a[c]));h[m].reader=[];for(c in f)h[m].addReader(EcPk.fromPem(f[c]));k||EcEncryptedValue.encryptOnSave(h[m].id,$("#privateSwitch").prop("checked"))}else{h.owner=[];for(c in a)k||h.addOwner(EcPk.fromPem(a[c]));h.reader=
[];for(c in f)h.addReader(EcPk.fromPem(f[c]));k||EcEncryptedValue.encryptOnSave(h.id,$("#privateSwitch").prop("checked"))}g(h)})}else $("#advancedPermissionsSave").attr("disabled","disabled"),$("#privateSwitch").attr("disabled","disabled"),$("#advancedPermissionsOwners").attr("disabled","disabled"),$("#advancedPermissionsReaders").attr("disabled","disabled");$("#advancedPermissionsCancel").click(function(){ModalManager.hideModal();h.isAny((new EcLevel).getTypes())&&g(h)})};return e}(AdvancedPermissionsModal);
AlignmentEditorColumn=function(e){var l="",k={},d=.1;k[EcAlignment.IS_EQUIVALENT_TO]="rgba(0,0,0,"+d+")";k[EcAlignment.IS_RELATED_TO]="rgba(128,128,128,"+d+")";k[EcAlignment.REQUIRES]="rgba(210,105,30,"+d+")";k[EcAlignment.NARROWS]="rgba(0,0,255,"+d+")";k[EcAlignment.DESIRES]="rgba(255,128,0,"+d+")";k[EcAlignment.IS_ENABLED_BY]="rgba(128,0,128,"+d+")";k.teaches="rgba(0,128,0,"+d+")";k.assesses="rgba(255,0,0,"+d+")";k.requires="rgba(210,105,30,"+d+")";k["http://schema.cassproject.org/0.2/vocab/asserts"]=
"rgba(255,0,255,"+d+")";var b={},d=.6;b[EcAlignment.IS_EQUIVALENT_TO]="rgba(0,0,0,"+d+")";b[EcAlignment.IS_RELATED_TO]="rgba(128,128,128,"+d+")";b[EcAlignment.REQUIRES]="rgba(210,105,30,"+d+")";b[EcAlignment.NARROWS]="rgba(0,0,255,"+d+")";b[EcAlignment.DESIRES]="rgba(255,128,0,"+d+")";b[EcAlignment.IS_ENABLED_BY]="rgba(128,0,128,"+d+")";b.teaches="rgba(0,128,0,"+d+")";b.assesses="rgba(255,0,0,"+d+")";b.requires="rgba(210,105,30,"+d+")";b["http://schema.cassproject.org/0.2/vocab/asserts"]="rgba(255,0,255,"+
d+")";var h={},d=.05;h[EcAlignment.IS_EQUIVALENT_TO]="rgba(0,0,0,"+d+")";h[EcAlignment.IS_RELATED_TO]="rgba(128,128,128,"+d+")";h[EcAlignment.REQUIRES]="rgba(210,105,30,"+d+")";h[EcAlignment.NARROWS]="rgba(0,0,255,"+d+")";h[EcAlignment.DESIRES]="rgba(255,128,0,"+d+")";h[EcAlignment.IS_ENABLED_BY]="rgba(128,0,128,"+d+")";h.teaches="rgba(0,128,0,"+d+")";h.assesses="rgba(255,0,0,"+d+")";h.requires="rgba(210,105,30,"+d+")";h["http://schema.cassproject.org/0.2/vocab/asserts"]="rgba(255,0,255,"+d+")";var g=
{},d=.2;g[EcAlignment.IS_EQUIVALENT_TO]="rgba(0,0,0,"+d+")";g[EcAlignment.IS_RELATED_TO]="rgba(128,128,128,"+d+")";g[EcAlignment.REQUIRES]="rgba(210,105,30,"+d+")";g[EcAlignment.NARROWS]="rgba(0,0,255,"+d+")";g[EcAlignment.DESIRES]="rgba(255,128,0,"+d+")";g[EcAlignment.IS_ENABLED_BY]="rgba(128,0,128,"+d+")";g.teaches="rgba(0,128,0,"+d+")";g.assesses="rgba(255,0,0,"+d+")";g.requires="rgba(210,105,30,"+d+")";g["http://schema.cassproject.org/0.2/vocab/asserts"]="rgba(255,0,255,"+d+")";var p={};e.prototype.populate=
function(){var c=this,f=$(c.containerId),a=f.find(".alignmentEditorContainer");a.html("").hide();f.find(".loadingRow").show();p={};for(f=0;f<c.collection.length;f++){var m=c.collection[f],b;b=void 0!=m.getName?m.getName():m.name;if(null==b||null==c.filter||""==c.filter||-1!=b.toLowerCase().indexOf(c.filter.toLowerCase()))a.append(l),b=a.children().last(),b.attr("id",m.shortId()),null!=m.name?null!=m.name["@value"]?b.find("[ec-field\x3d'name']").text(m.getName()):b.find("[ec-field\x3d'name']").text(m.name):
null!=m.url?b.find("[ec-field\x3d'name']").text(m.url):b.find("[ec-field\x3d'name']").text("\x3cUnknown\x3e"),null!=m.url&&null!=p[m.url]?b.remove():(p[m.url]=!0,b.click(function(a){a=$(a.currentTarget);c.selectElement(a.attr("id"));a.toggleClass("selected");null!=c.screenHook&&c.screenHook()}))}a.off("scroll");a.scroll(function(){c.redraw()});c.getRelations()};e.prototype.deselectAll=function(){$(this.containerId).find(".alignmentEditorElement.selected").trigger("click");this.selected=[]};e.prototype.redraw=
function(){var c=$(this.containerId);c.find(".alignmentEditorContainer").show();c.find(".loadingRow").hide();c.find(".alignmentEditorElement");null!=this.left&&this.left.redraw();if(null!=this.right){$(this.right.containerId).find(".alignmentEditorElement");var f=parseInt($("#alignmentEditorColumns").css("margin-bottom")),a=$("#canvas")[0],m=$("#alignmentEditorColumns");a.style.width=$(a).parent().width()+"px";a.style.height=m.height()+f+"px";a.width!=a.offsetWidth&&(a.width=a.offsetWidth);a.height!=
a.offsetHeight&&(a.height=m.height()+f);m=$("#canvas")[0].getContext("2d");m.clearRect(0,0,a.width,a.height);m.fillStyle="rgb(255,255,255)";m.fillRect(0,0,a.width,a.height+f);if(null!=this.relations){for(var q=0;q<this.relations.length;q++){var n=this.relations[q].relationType;null==n&&null!=this.relations[q].educationalAlignment&&(n=this.relations[q].educationalAlignment.alignmentType);if(null!=n){var r=this.relations[q].source;null==r&&(r=this.relations[q].url);if(null!=r){var d=this.relations[q].target;
null==d&&null!=this.relations[q].educationalAlignment&&(d=this.relations[q].educationalAlignment.targetUrl);if(null!=d){var t=c.find("[id\x3d'"+r+"']"),e=$(this.right.containerId+" [id\x3d'"+d+"']");if(0!=t.length&&0!=e.length){var p=!0;if(0==this.selected.length&&0==this.right.selected.length)m.fillStyle=g[this.relations[q].relationType];else{for(var p=!1,l=0;l<this.selected.length;l++)this.selected[l].shortId()==r&&(p=!0),this.selected[l].shortId()==d&&(p=!0);for(l=0;l<this.right.selected.length;l++)this.right.selected[l].shortId()==
r&&(p=!0),this.right.selected[l].shortId()==d&&(p=!0)}m.beginPath();m.strokeStyle=p?b[n]:k[n];var r=t.position().left+t.outerWidth()-$(a).position().left,d=t.position().top+(t.outerHeight(!0)-t.outerHeight(!1))/2-$(a).position().top,l=e.position().left-$(a).position().left,v=e.position().top+(e.outerHeight(!0)-e.outerHeight(!1))/2-$(a).position().top,w=l,e=e.position().top+e.outerHeight(!0)-(e.outerHeight(!0)-e.outerHeight(!1))/2-$(a).position().top,A=r,t=t.position().top+t.outerHeight(!0)-(t.outerHeight(!0)-
t.outerHeight(!1))/2-$(a).position().top;m.moveTo(r,d);m.lineTo(l,v);m.lineTo(w,e);m.lineTo(A,t);m.lineTo(r,d);m.closePath();m.fillStyle=p?g[n]:h[n];m.fill();m.stroke()}}}}}m.clearRect(0,a.height-f,a.width,f);m.fillStyle="rgb(255,255,255)";m.fillRect(0,a.height-f,a.width,f);$("#mappingFrameworkColumn").is(":visible")&&(m.clearRect(0,0,a.width,$("#mappingFrameworkColumn").height()),m.fillStyle="rgb(255,255,255)",m.fillRect(0,0,a.width,$("#mappingFrameworkColumn").height()))}}};e.prototype.bindControls=
function(c){var f=this,a=$(c);l=a.find(".alignmentEditorContainer").html();a.find(".alignmentEditorContainer").html("");a.find(".alignmentEditorCategory").change(function(c){c=a.find(".alignmentEditorCategory option:selected").val();a.find(".alignmentEditorCollection").hide();a.find(".alignmentEditorContainer").hide();a.find(".alignmentEditorContainer").html("");a.find(".columnFilter").addClass("hide");var m=a.find(".alignmentEditorSource");m.html("\x3coption disabled selected value\x3e -- Select Source -- \x3c/option\x3e").show();
var b={course:"Courses",competency:"Frameworks",credential:"Credentials",badge:"Badges",resource:"Resources"},g;for(g in AppController.serverController.serverList)m.append("\x3coption/\x3e").children().last().attr("value",AppController.serverController.serverList[g]).text(g+" "+b[c]);f.redraw()});a.find(".alignmentEditorSource").change(function(c){c=a.find(".alignmentEditorCategory option:selected").val();var b=a.find(".alignmentEditorSource option:selected").val(),m=a.find(".alignmentEditorCollection");
a.find(".alignmentEditorContainer").hide();m.html("\x3coption disabled selected value\x3e -- Select Framework -- \x3c/option\x3e").hide();f.selectedCategory=c;f.selectedSource=b;f.sourceRepo=new EcRepository;f.sourceRepo.selectedServer=b;f.sourceRepo.autoDetectRepository();"course"==c&&f.populateListCourses();if("competency"==c)a.find(".alignmentEditorContainer").html(""),a.find(".columnFilter").addClass("hide"),EcFramework.search(f.sourceRepo,"",function(a){for(var c=0;c<a.length;c++){var b=a[c];
m.append("\x3coption/\x3e").children().last().attr("value",b.shortId()).text(b.getName())}m.show();f.redraw()},function(a){},{size:5E3});else{var g=a.find(".alignmentEditorSource option:selected").text();a.find(".alignmentEditorColumnSelectCollapsed").html("\x3ci class\x3d'fa fa-caret-right'\x3e\x3c/i\x3e "+g);a.find(".alignmentEditorColumnSelects").slideUp(function(){f.redraw();null!=f.screenHook&&f.screenHook()});void 0!=b&&""!=b&&(a.find(".columnFilter").removeClass("hide"),a.find(".alignmentEditorColumnSelectCollapsed").addClass("navigationHidden"))}"credential"==
c&&f.populateListCredentials();"badge"==c&&f.populateListBadges();"resource"==c&&f.populateListResources();f.redraw();a.find(".alignmentEditorContainer").hide();a.find(".loadingRow").show()});a.find(".alignmentEditorCollection").change(function(c){c=a.find(".alignmentEditorCategory option:selected").val();var b=a.find(".alignmentEditorSource option:selected").val(),m=a.find(".alignmentEditorCollection option:selected").val();a.find(".alignmentEditorContainer").hide();f.selectedCategory=c;f.selectedSource=
b;f.selectedCollection=m;"course"==c&&f.populateListCourses();"competency"==c&&(f.populateListCompetencies(),b=a.find(".alignmentEditorSource option:selected").text().substring(0,a.find(".alignmentEditorSource option:selected").text().length-11),m=a.find(".alignmentEditorCollection option:selected").text(),a.find(".alignmentEditorColumnSelectCollapsed").html("\x3ci class\x3d'fa fa-caret-right'\x3e\x3c/i\x3e "+b+" : "+m),a.find(".alignmentEditorColumnSelects").slideUp(function(){f.redraw();null!=f.screenHook&&
f.screenHook()}));"badge"==c&&f.populateListBadges();"credential"==c&&f.populateListCredentials();"resource"==c&&f.populateListResources();f.redraw();a.find(".alignmentEditorColumnSelectCollapsed").hasClass("navigationHidden")||(a.find(".alignmentEditorColumnSelectCollapsed").addClass("navigationHidden"),a.find(".columnFilter").removeClass("hide"))});a.find(".columnFilter").keyup(function(c){f.deselectAll();f.filter=a.find(".columnFilter").val();f.populate()});a.find(".alignmentEditorColumnSelectCollapsed").click(function(a){f.toggleNavigation(a)})};
e.prototype.toggleNavigation=function(c){var f=this;c=$(f.containerId);if(c.find(".alignmentEditorColumnSelectCollapsed").hasClass("navigationHidden")){var a=c.find(".alignmentEditorColumnSelectCollapsed").text();c.find(".alignmentEditorColumnSelectCollapsed").html("\x3ci class\x3d'fa fa-caret-down'\x3e\x3c/i\x3e "+a);c.find(".alignmentEditorColumnSelectCollapsed").removeClass("navigationHidden");var a=c.find(".alignmentEditorCategory option:selected").val(),b=c.find(".alignmentEditorSource option:selected").val(),
g=c.find(".alignmentEditorCollection option:selected").val();"competency"==a&&void 0!=g&&""!=g||"competency"!=a&&void 0!=b&&""!=b?c.find(".columnFilter").removeClass("hide"):c.find(".columnFilter").addClass("hide")}else a=c.find(".alignmentEditorColumnSelectCollapsed").text(),c.find(".alignmentEditorColumnSelectCollapsed").html("\x3ci class\x3d'fa fa-caret-right'\x3e\x3c/i\x3e "+a),c.find(".alignmentEditorColumnSelectCollapsed").addClass("navigationHidden");c.find(".alignmentEditorColumnSelects").slideToggle(function(){f.redraw();
null!=f.screenHook&&f.screenHook()})};return e}(AlignmentEditorColumn);
AlignmentEditorScreen=function(e){var l=0;e.prototype.createColumnDiv=function(){var k=$("#alignmentEditorColumns").append('\x3cdiv class\x3d"columns large-4"/\x3e').children().last(),d="alignmentEditorColumn"+l++;k.attr("id",d);return"#"+d};e.prototype.updateControls=function(){$(this.containerId+" #alignmentEditorControls button").attr("disabled","true");if(2==this.columns.length&&(0<this.columns[0].selected.length&&$("#alignmentEditorDeselectLeft").attr("disabled",null),0<this.columns[1].selected.length&&
$("#alignmentEditorDeselectRight").attr("disabled",null),0!=this.columns[0].collection.length&&0!=this.columns[1].collection.length&&0!=this.columns[0].selected.length&&0!=this.columns[1].selected.length)){var k=this.columns[0].selectedCategory,d=this.columns[1].selectedCategory;"course"==k&&("course"==d&&($("#alignmentEditorEquivalent").attr("disabled",null),$("#alignmentEditorTeaches").attr("disabled",null),$("#alignmentEditorRequires").attr("disabled",null)),"competency"==d&&($("#alignmentEditorTeaches").attr("disabled",
null),$("#alignmentEditorAssesses").attr("disabled",null),$("#alignmentEditorRequires").attr("disabled",null)),"credential"==d&&($("#alignmentEditorGrants").attr("disabled",null),$("#alignmentEditorRequires").attr("disabled",null)),"resource"==d&&($("#alignmentEditorTeaches").attr("disabled",null),$("#alignmentEditorRequires").attr("disabled",null)));"credential"==k&&("course"==d&&$("#alignmentEditorRequires").attr("disabled",null),"competency"==d&&($("#alignmentEditorAsserts").attr("disabled",null),
$("#alignmentEditorGrants").attr("disabled",null),$("#alignmentEditorRequires").attr("disabled",null)),"credential"==d&&($("#alignmentEditorEquivalent").attr("disabled",null),$("#alignmentEditorGrants").attr("disabled",null),$("#alignmentEditorRequires").attr("disabled",null)));"competency"==k&&"competency"==d&&($("#alignmentEditorEquivalent").attr("disabled",null),$("#alignmentEditorRelated").attr("disabled",null),$("#alignmentEditorRequires").attr("disabled",null),$("#alignmentEditorNarrows").attr("disabled",
null),$("#alignmentEditorDesires").attr("disabled",null),$("#alignmentEditorEnables").attr("disabled",null));"resource"==k&&("course"==d&&$("#alignmentEditorRequires").attr("disabled",null),"competency"==d&&($("#alignmentEditorTeaches").attr("disabled",null),$("#alignmentEditorAssesses").attr("disabled",null),$("#alignmentEditorRequires").attr("disabled",null)),"credential"==d&&$("#alignmentEditorRequires").attr("disabled",null),"resource"==d&&($("#alignmentEditorEquivalent").attr("disabled",null),
$("#alignmentEditorRequires").attr("disabled",null)));"badge"==k&&"competency"==d&&$("#alignmentEditorAsserts").attr("disabled",null)}};e.prototype.reflow=function(){if(void 0!=this.columns&&1<this.columns.length){var k=this.columns[1].selectedCategory;if("competency"==this.columns[0].selectedCategory&&"competency"==k){var k=this.columns[0].selectedCollection,d=this.columns[1].selectedCollection,b,h;null!=k&&void 0!=k&&""!=k&&(b=EcFramework.getBlocking(k));null!=d&&void 0!=d&&""!=d&&(h=EcFramework.getBlocking(d));
void 0!=b&&void 0!=h&&null!=b&&null!=h?k==d?(AppController.identityController.canEdit(b)?ViewManager.getView("#alignmentEditorMessageContainer").clearWarning("noEdit"):ViewManager.getView("#alignmentEditorMessageContainer").displayWarning("Cannot modify this framework, please select a different framework or two frameworks to align with each other","noEdit"),$("#mappingFrameworkColumn").slideUp(),b=$("#canvas")[0].getContext("2d"),b.clearRect(0,0,canvas.width,$("#mappingFrameworkColumn").height()),
b.fillStyle="rgb(255,255,255)",b.fillRect(0,0,canvas.width,$("#mappingFrameworkColumn").height())):(d=k=!1,AppController.identityController.canEdit(b)&&(k=!0),AppController.identityController.canEdit(h)&&(d=!0),k||d?(ViewManager.getView("#alignmentEditorMessageContainer").clearWarning("noEdit"),$("#mappingFrameworkColumn").slideUp()):(ViewManager.getView("#alignmentEditorMessageContainer").displayWarning("Cannot modify either framework, created relationships will not be placed in a framework unless a third 'mapping' framework is chosen below",
"noEdit"),$("#mappingFrameworkColumn").slideDown())):$("#mappingFrameworkColumn").slideUp()}}b=$(".alignmentEditorContainer:visible");for(h=0;h<b.length;h++)$(b[h]).css("height",$("#alignmentEditorColumns").innerHeight()-($(b[h]).position().top-$("#alignmentEditorColumns").position().top));for(h=0;h<this.columns.length;h++)this.columns[h].redraw()};e.prototype.bindControls=function(k){var d=this;$(window).resize(function(b){d.reflow()});k=$(k+" #alignmentEditorControls");k.append("\x3cbutton class\x3d'button' id\x3d'alignmentEditorDeselectLeft' disabled title\x3d'Deselect all items on the left side.'\x3eLeft: Deselect All\x3c/button\x3e").children().last().click(function(b){d.columns[0].deselectAll()});
k.append("\x3cbutton class\x3d'button' id\x3d'alignmentEditorEquivalent' style\x3d'background:black;' disabled title\x3d'Items on the left are de-facto or functionally equivalent to items on the right.'\x3eEquivalent\x3c/button\x3e").children().last().click(function(b){d.createRelations(Relation.IS_EQUIVALENT_TO)});k.append("\x3cbutton class\x3d'button' id\x3d'alignmentEditorRelated' style\x3d'background:gray;' disabled title\x3d'Items on the left and right are related in some non-functional way.'\x3eRelated To\x3c/button\x3e").children().last().click(function(b){d.createRelations(Relation.IS_RELATED_TO)});
k.append("\x3cbutton class\x3d'button' id\x3d'alignmentEditorNarrows' style\x3d'background:blue;' disabled title\x3d'Items on the left are sub-items of items on the right.'\x3eNarrows\x3c/button\x3e").children().last().click(function(b){d.createRelations(Relation.NARROWS)});k.append("\x3cbutton class\x3d'button' id\x3d'alignmentEditorDesires' style\x3d'background:orange;color:black;' disabled title\x3d'Items on the left are positively influenced by items on the right.'\x3eDesires\x3c/button\x3e").children().last().click(function(b){d.createRelations(Relation.DESIRES)});
k.append("\x3cbutton class\x3d'button' id\x3d'alignmentEditorRequires' style\x3d'background:chocolate;' disabled title\x3d'Items on the left require items on the right for completion.'\x3eRequires\x3c/button\x3e").children().last().click(function(b){d.createRelations(Relation.REQUIRES);d.createAlignments("requires")});k.append("\x3cbutton class\x3d'button' id\x3d'alignmentEditorTeaches' style\x3d'background:green;' disabled title\x3d'Items on the left teach about items on the right.'\x3eTeaches\x3c/button\x3e").children().last().click(function(b){d.createAlignments("teaches")});
k.append("\x3cbutton class\x3d'button' id\x3d'alignmentEditorAssesses' style\x3d'background:red;' disabled title\x3d'Items on the left assess knowledge about items on the right.'\x3eAssesses\x3c/button\x3e").children().last().click(function(b){d.createAlignments("assesses")});k.append("\x3cbutton class\x3d'button' id\x3d'alignmentEditorAsserts' style\x3d'background:pink;' disabled title\x3d'Items on the left assess knowledge about items on the right.'\x3eAsserts\x3c/button\x3e").children().last().click(function(b){d.createAlignments("http://schema.cassproject.org/0.2/vocab/asserts")});
k.append("\x3cbutton class\x3d'button' id\x3d'alignmentEditorDeselectRight' disabled title\x3d'Deselect all items on the right side.'\x3eRight: Deselect All\x3c/button\x3e").children().last().click(function(b){d.columns[1].deselectAll()});k.append("\x3cbutton class\x3d'button' id\x3d'alignmentEditorHelp' disabled style\x3d'float:right;'\x3e?\x3c/button\x3e");setTimeout(function(){d.reflow()},100)};return e}(AlignmentEditorScreen);
AlignmentExplorerColumn=function(e){e.prototype.redrawJsInit=function(){$(this.containerId).find(".alignmentEditorElement").removeClass("highlighted")};e.prototype.redrawJsFinal=function(){$(this.containerId).find(".loadingRow").hide();$(this.containerId).find(".alignmentEditorContainer").show();for(var e=0,k=this;null!=k;)e+=k.selected,k=k.left;for(k=this;null!=k;)e+=k.selected,k=k.right;k=this;0==e&&0==$(this.containerId).find(".alignmentEditorElement.highlighted").length&&$(this.containerId).find(".alignmentEditorElement").addClass("highlighted");
null==k.left&&null==k.right&&$(this.containerId).find(".alignmentEditorElement").addClass("highlighted")};e.prototype.redrawJs=function(){for(var e=[],k=null,d=this;null!=d;)e=e.concat(d.selected),k=d.containerId,d=d.left;for(d=this.right;null!=d;)e=e.concat(d.selected),d=d.right;for(d=0;d<e.length;d++)$('[id\x3d"'+e[d].shortId()+'"]').addClass("highlighted");if(null!=this.relations)for(d=0;d<this.relations.length;d++){var b=this.relations[d];if((new Relation).isA(b.type)){var h=$('[id\x3d"'+b.source+
'"]');if(0==h.length)continue;var g=$('[id\x3d"'+b.target+'"]');if(0==g.length)continue;0<$(k).find('[id\x3d"'+b.source+'"]').length&&h.addClass("highlighted");0<$(k).find('[id\x3d"'+b.target+'"]').length&&g.addClass("highlighted");if(0==h.hasClass("highlighted")&&0<e.length)continue;if(0==g.hasClass("highlighted")&&0<e.length)continue;h.addClass("highlighted");g.addClass("highlighted")}(new CreativeWork).isA(b.type)&&(h=$('[id\x3d"'+b.url+'"]'),0!=h.length&&null!=b.educationalAlignment&&(g=$('[id\x3d"'+
b.educationalAlignment.targetUrl+'"]'),0!=g.length&&(0<$(k).find('[id\x3d"'+b.url+'"]').length&&h.addClass("highlighted"),0<$(k).find('[id\x3d"'+b.educationalAlignment.targetUrl+'"]').length&&g.addClass("highlighted"),0==h.hasClass("highlighted")&&0<e.length||0==g.hasClass("highlighted")&&0<e.length||(h.addClass("highlighted"),g.addClass("highlighted")))))}$(this.containerId).find(".alignmentEditorElement ul li").remove();for(d=0;d<this.highlighted.length;d++)if($(this.containerId).find("[id\x3d'"+
this.highlighted[d].shortId()+"']").addClass("highlighted"),e=this.idToComments[this.highlighted[d].shortId()],null!=e)for(k=0;k<e.length;k++)b=$(this.containerId).find("[id\x3d'"+this.highlighted[d].shortId()+"'] ul").append("\x3cli/\x3e").children().last(),b.text(e[k]),1==this.idToCommentHighlight[e[k]]&&b.addClass("fulfilled")};return e}(AlignmentExplorerColumn);
AlignmentExplorerScreen=function(e){var l=0;e.prototype.createColumnDiv=function(){var e=$("#alignmentExplorerColumns").append('\x3cdiv class\x3d"columns large-3"/\x3e').children().last(),d="alignmentExplorerColumn"+l++;e.attr("id",d);return"#"+d};e.prototype.reflow=function(){for(var e=$(".alignmentEditorContainer:visible"),d=canvas.height,b=0,h=0;h<e.length;h++)d=Math.min(d,$(e[h]).position().top),b=Math.max(b,$(e[h]).position().top);$(".alignmentEditorContainer").css("height",window.innerHeight-
d);for(h=0;h<this.columns.length;h++)this.columns[h].redrawJsInit();for(h=0;h<this.columns.length;h++)this.columns[h].redraw();for(h=0;h<this.columns.length;h++)this.columns[h].redrawJsFinal()};e.prototype.bindControls=function(e){var d=this;setTimeout(function(){d.reflow()},100)};return e}(AlignmentExplorerScreen);
var AppMenu=function(e){function l(a){$("#appMenuIdentityList").find(".fake-a").removeClass("selected");$("#appMenuIdentityList").find("[title\x3d'"+a+"']").addClass("selected");AppController.identityController.select(a);ScreenManager.replaceScreen(ScreenManager.getCurrentScreen());$("#appMenuUserIdentity").children().first().text(AppController.identityController.selectedIdentity.displayName+" @ "+AppController.serverController.selectedServerName)}function k(){var a=EcIdentityManager.ids;$("#sessionIdentitySelect").find("option[data-id]").remove();
for(var f in a){var c=a[f].ppk.toPem().replaceAll("\r?\n",""),b=a[f].displayName,c=$("\x3coption data-id\x3d'true' value\x3d'"+c+"'\x3e\x3c/option\x3e");c.text(b);void 0!=AppController.identityController.selectedIdentity&&b==AppController.identityController.selectedIdentity.displayName&&c.prop("selected",!0);$("#sessionIdentitySelect").prepend(c)}a=$("\x3coption data-id\x3d'true' value\x3d'public'\x3ePUBLIC_NAME\x3c/option\x3e");a.prepend(a);$("#appMenuIdentityList").prepend(a)}function d(a){a=EcRemoteLinkedData.trimVersionFromUrl(a);
0==$("#appMenuRecentList li[data-id\x3d'"+a+"']").size()&&EcCompetency.get(a,function(f){var c=$("\x3cli data-recent\x3d'competency'\x3e\x3ca\x3e\x3c/a\x3e\x3c/li\x3e");c.attr("data-id",a);c.find("a").text(f.getName());c.find("a").attr("title",a);c.find("a").attr("href","#"+CompetencyViewScreen.prototype.getDisplayName()+"?id\x3d"+a);c.find("a").click(function(a){a.preventDefault();ScreenManager.changeScreen(new CompetencyViewScreen(f));return!1});$("#appMenuCompetencyListStart").after(c);$("#appMenuCompetencyListStart").removeClass("hide")},
function(){AppController.storageController.removeRecent(EcCompetency.myType,a)})}function b(a){if(null!=a&&0<a.length){$("#appMenuNoRecent").addClass("hide");$("#appMenuCompetencyListStart").nextAll("[data-recent\x3d'competency']").remove();for(var f in a)d(a[f])}else $("#appMenuCompetencyListStart").nextAll("[data-id]").remove(),$("#appMenuCompetencyListStart").addClass("hide")}function h(a){a=EcRemoteLinkedData.trimVersionFromUrl(a);0==$("#appMenuRecentList li[data-id\x3d'"+a+"']").size()&&EcFramework.get(a,
function(f){var c=$("\x3cli data-recent\x3d'framework'\x3e\x3ca\x3e\x3c/a\x3e\x3c/li\x3e");c.attr("data-id",a);c.find("a").text(f.getName());c.find("a").attr("title",a);c.find("a").attr("href","#"+FrameworkViewScreen.prototype.getDisplayName()+"?id\x3d"+a);c.find("a").click(function(a){a.preventDefault();ScreenManager.changeScreen(new FrameworkViewScreen(f));return!1});$("#appMenuFrameworkListStart").after(c);$("#appMenuFrameworkListStart").removeClass("hide")},function(){AppController.storageController.removeRecent(EcFramework.myType,
a)})}function g(a){if(null!=a&&0<a.length){$("#appMenuNoRecent").addClass("hide");$("#appMenuFrameworkListStart").nextAll("[data-recent\x3d'framework']").each(function(f,c){-1==a.indexOf($(c).attr("data-id"))&&$(c).remove()});for(var f in a)h(a[f])}else $("#appMenuFrameworkListStart").nextAll("[data-id]").remove(),$("#appMenuFrameworkListStart").addClass("hide")}function p(){var a=AppController.serverController.getServerList(),f=$("#sessionServerSelect"),c=$("#sessionLoginSelect");f.find("option[value]").remove();
c.find("option[value]").not("[value\x3d'google']").remove();if(null!=a&&0<Object.keys(a).length){f.removeClass("noServers");f.find("#noServers").addClass("hide");f.find("#noServers").removeAttr("selected");f.removeAttr("disabled");var b=0,g;for(g in a)2>b&&!AppController.loginController.getLoggedIn()?c.append($("\x3coption value\x3d'"+a[g]+"'\x3eto "+g+"\x3c/option\x3e")):2==b&&c.append($("\x3coption value\x3d'new'\x3eto Other...\x3c/option\x3e")),b++,g===AppController.serverController.selectedServerName?
f.append($("\x3coption selected\x3d'selected' value\x3d'"+a[g]+"'\x3e"+g+"\x3c/option\x3e")):f.append($("\x3coption value\x3d'"+a[g]+"'\x3e"+g+"\x3c/option\x3e"));AppController.loginController.getLoggedIn()||c.append($("\x3coption value\x3d'create'\x3eCreate Account\x3c/option\x3e"))}else f.addClass("noServers"),f.find("#noServers").removeClass("hide"),f.find("#noServers").attr("selected","selected"),f.attr("disabled",!0)}function c(){var a=$("#appMenuLoginUser").val(),f=$("#appMenuLoginPass").val(),
c=$("#sessionLoginSelect").val();void 0!=a&&""!=a||void 0!=f&&""!=f?void 0==a||""==a?($("#appMenuLoginUser").addClass("error"),$("#appMenuLoginPass").removeClass("error")):void 0==f||""==f?($("#appMenuLoginPass").addClass("error"),$("#appMenuLoginUser").removeClass("error")):($("#appMenuLoginUser").removeClass("error"),$("#appMenuLoginPass").removeClass("error"),$("#appMenuLoginSpinner").next().addClass("hide"),$("#appMenuLoginSpinner").removeClass("hide"),$("#appMenuLoginUser").prop("disabled",!0),
$("#appMenuLoginPass").prop("disabled",!0),AppController.loginController.login(a,f,c,function(){AppController.serverController.checkForAdmin(function(){ViewManager.getView("#menuContainer").setLoggedIn();$("#appMenuLoginPanel").animate({right:"-100%"},800);$("#appMenuLoginSpinner").next().removeClass("hide");$("#appMenuLoginSpinner").addClass("hide");$("#appMenuLoginUser").removeAttr("disabled").val("");$("#appMenuLoginPass").removeAttr("disabled").val("");$("#sessionLoginSelect").find("option").not("[value]").prop("selected",
"true")})},function(a){$("#appMenuLoginUser").addClass("error");$("#appMenuLoginPass").addClass("error");$("#appMenuLoginSpinner").next().removeClass("hide");$("#appMenuLoginSpinner").addClass("hide");$("#appMenuLoginUser").removeAttr("disabled");$("#appMenuLoginPass").removeAttr("disabled")})):($("#appMenuLoginUser").addClass("error"),$("#appMenuLoginPass").addClass("error"))}function f(){$("#appMenuHeader").attr("href","#"+WelcomeScreen.prototype.getDisplayName());$("#appMenuHeader").click(function(a){a.preventDefault();
ScreenManager.changeScreen(new WelcomeScreen);return!1});$("#appMenuRepoSearch").attr("href","#"+RepoSearchScreen.prototype.getDisplayName());$("#appMenuRepoSearch").click(function(a){a.preventDefault();ScreenManager.changeScreen(new RepoSearchScreen)});$("#appMenuRepository").attr("href","#"+RepoSearchScreen.prototype.getDisplayName());$("#appMenuRepository").click(function(a){a.preventDefault();ScreenManager.changeScreen(new RepoSearchScreen)});$("#appMenuRepoCreate").attr("href","#"+RepoCreateScreen.prototype.getDisplayName());
$("#appMenuRepoCreate").click(function(a){a.preventDefault();ScreenManager.changeScreen(new RepoCreateScreen)});$("#appMenuGeneralImport").click(function(a){a.preventDefault();ModalManager.showModal(new RepoImportModal)});$("#appMenuFileManager").attr("href","#"+FileManagerScreen.prototype.getDisplayName());$("#appMenuFileManager").click(function(a){a.preventDefault();ScreenManager.changeScreen(new FileManagerScreen)});$("#appMenuFrameworks").attr("href","#"+FrameworkSearchScreen.prototype.getDisplayName());
$("#appMenuFrameworks").click(function(a){a.preventDefault();ScreenManager.changeScreen(new FrameworkSearchScreen)});$("#appMenuFrameworkSearch").attr("href","#"+CompetencySearchScreen.prototype.getDisplayName());$("#appMenuFrameworkSearch").click(function(a){a.preventDefault();ScreenManager.changeScreen(new FrameworkSearchScreen)});$("#appMenuFrameworkCreate").attr("href","#"+CompetencyEditScreen.prototype.getDisplayName());$("#appMenuFrameworkCreate").click(function(a){a.preventDefault();ScreenManager.changeScreen(new FrameworkEditScreen)});
$("#appMenuCompetencies").attr("href","#"+CompetencySearchScreen.prototype.getDisplayName());$("#appMenuCompetencies").click(function(a){a.preventDefault();ScreenManager.changeScreen(new CompetencySearchScreen)});$("#appMenuCompetencySearch").attr("href","#"+CompetencySearchScreen.prototype.getDisplayName());$("#appMenuCompetencySearch").click(function(a){a.preventDefault();ScreenManager.changeScreen(new CompetencySearchScreen)});$("#appMenuCompetencyCreate").attr("href","#"+CompetencyEditScreen.prototype.getDisplayName());
$("#appMenuCompetencyCreate").click(function(a){a.preventDefault();ScreenManager.changeScreen(new CompetencyEditScreen)});$("#appMenuCompetencyImport").click(function(a){a.preventDefault();ModalManager.showModal(new ImportCompetenciesModal)});$("#appMenuRelationships").attr("href","#"+RelationshipSearchScreen.prototype.getDisplayName());$("#appMenuRelationships").click(function(a){a.preventDefault();ScreenManager.changeScreen(new RelationshipSearchScreen)});$("#appMenuRelationshipSearch").attr("href",
"#"+RelationshipSearchScreen.prototype.getDisplayName());$("#appMenuRelationshipSearch").click(function(a){a.preventDefault();ScreenManager.changeScreen(new RelationshipSearchScreen)});$("#appMenuRelationshipCreate").attr("href","#"+RelationshipEditScreen.prototype.getDisplayName());$("#appMenuRelationshipCreate").click(function(a){a.preventDefault();ScreenManager.changeScreen(new RelationshipEditScreen)});$("#appMenuLevels").attr("href","#"+RelationshipSearchScreen.prototype.getDisplayName());$("#appMenuLevels").click(function(a){a.preventDefault();
ScreenManager.changeScreen(new LevelSearchScreen)});$("#appMenuLevelSearch").attr("href","#"+RelationshipSearchScreen.prototype.getDisplayName());$("#appMenuLevelSearch").click(function(a){a.preventDefault();ScreenManager.changeScreen(new LevelSearchScreen)});$("#appMenuRollupRules").attr("href","#"+RelationshipSearchScreen.prototype.getDisplayName());$("#appMenuRollupRules").click(function(a){a.preventDefault();ScreenManager.changeScreen(new RollupRuleSearchScreen)});$("#appMenuRollupRulesSearch").attr("href",
"#"+RelationshipSearchScreen.prototype.getDisplayName());$("#appMenuRollupRulesSearch").click(function(a){a.preventDefault();ScreenManager.changeScreen(new RollupRuleSearchScreen)});$("#appMenuProfile").click(function(a){a.preventDefault();ModalManager.showModal(new MessageModal("Not Implemented Yet!","This feature has not been implemented yet!","tiny"))});$("#appMenuAssertions").attr("href","#"+AssertionSearchScreen.prototype.getDisplayName());$("#appMenuAssertions").click(function(a){a.preventDefault();
ScreenManager.changeScreen(new AssertionSearchScreen)});$("#appMenuAssertionSearch").attr("href","#"+AssertionSearchScreen.prototype.getDisplayName());$("#appMenuAssertionSearch").click(function(a){a.preventDefault();ScreenManager.changeScreen(new AssertionSearchScreen)});$("#appMenuAssertionCreate").attr("href","#"+AssertionEditScreen.prototype.getDisplayName());$("#appMenuAssertionCreate").click(function(a){a.preventDefault();ScreenManager.changeScreen(new AssertionEditScreen)});$("#appMenuAlignmentEditor").attr("href",
"#"+AlignmentEditorScreen.prototype.getDisplayName());$("#appMenuAlignmentEditor").click(function(a){a.preventDefault();ScreenManager.changeScreen(new AlignmentEditorScreen)});$("#appMenuAlignmentExplorer").attr("href","#"+AlignmentExplorerScreen.prototype.getDisplayName());$("#appMenuAlignmentExplorer").click(function(a){a.preventDefault();ScreenManager.changeScreen(new AlignmentExplorerScreen)});$("#appMenuViewPublic").click(function(a){a.preventDefault();void 0!=ScreenManager.getCurrentScreen().filterPublic&&
ScreenManager.getCurrentScreen().filterPublic()});$("#appMenuViewAll").click(function(a){a.preventDefault();void 0!=ScreenManager.getCurrentScreen().filterAll&&ScreenManager.getCurrentScreen().filterAll()});$("#appMenuViewAdvanced").click(function(a){a.preventDefault();ModalManager.showModal(new MessageModal("Advanced View Options Incomplete"))});$("#appMenuSortByTime").click(function(a){a.preventDefault();void 0!=ScreenManager.getCurrentScreen().sortByTimestamp&&ScreenManager.getCurrentScreen().sortByTimestamp()});
$("#appMenuSortByOwner").click(function(a){a.preventDefault();void 0!=ScreenManager.getCurrentScreen().sortByOwner&&ScreenManager.getCurrentScreen().sortByOwner()});$("#appMenuSortBySource").click(function(a){a.preventDefault();void 0!=ScreenManager.getCurrentScreen().sortBySource&&ScreenManager.getCurrentScreen().sortBySource()});$("#appMenuSortByTarget").click(function(a){a.preventDefault();void 0!=ScreenManager.getCurrentScreen().sortByTarget&&ScreenManager.getCurrentScreen().sortByTarget()});
$("#appMenuSortByCompetency").click(function(a){a.preventDefault();void 0!=ScreenManager.getCurrentScreen().sortByCompetency&&ScreenManager.getCurrentScreen().sortByCompetency()});$("#appMenuHowTo").click(function(a){a.preventDefault();ModalManager.showModal(new MessageModal("How To Incomplete"))});$("#appMenuApi").click(function(a){a.preventDefault();window.open("http://docs.cassproject.org","_blank")});$("#appMenuReportIssue").click(function(a){a.preventDefault();ModalManager.showModal(new MessageModal("Report Issue Incomplete"))});
$("#appMenuGetInvolved").click(function(a){a.preventDefault();window.open("http://www.cassproject.org","_blank")})}e.prototype.display=function(a){$("#appMenuToggle").click(function(a){a.preventDefault();return!1});e.prototype.setCurrentServer();f();a=AppController.storageController.getRecent(EcCompetency.myType);b(a);a=AppController.storageController.getRecent(EcFramework.myType);g(a);p();$("#appMenuAddServerBtn").click(function(){ModalManager.showModal(new AddServerModal)});$("#sessionServerSelect").change(function(){var a=
$("#sessionServerSelect"),f=a.val();AppController.serverController.selectServer(f,function(){var c=a.find("option");c.removeAttr("selected");c.filter("[value\x3d'"+f+"']").prop("selected","true");ScreenManager.reloadCurrentScreen()},function(){})});AppController.serverController.onServerChange.push(function(){p()});$("#sessionLoginSelect").change(function(){var a=$("#sessionLoginSelect"),f=a.val();"create"===f?(ModalManager.showModal(new CreateUserModal),a.find("option").not("[value]").prop("selected",
"true")):"google"===f?AppController.loginController.hello(f,function(){AppController.serverController.checkForAdmin(function(){ViewManager.getView("#menuContainer").setLoggedIn();a.find("option").not("[value]").prop("selected","true")})},function(){a.find("option").not("[value]").prop("selected","true")}):$("#appMenuLoginPanel").animate({right:"0px"},800)});$("#appMenuLoginPanel").submit(c);$("#sessionIdentitySelect").change(function(){var a=$("#sessionIdentitySelect").val();"new"==a?ModalManager.showModal(new CreateIdentityModal(function(){k()})):
"signout"==a?(AppController.loginController.logout(),ViewManager.getView("#menuContainer").setLoggedOut(),"Identity"==ScreenManager.getCurrentScreen().getDisplayName()?ScreenManager.changeScreen(new WelcomeScreen):ScreenManager.reloadCurrentScreen()):l(a)});$("#appMenuIdentityOptionsBtn").click(function(){ScreenManager.changeScreen(new UserIdentityScreen)});$("#closeLoginPanel").click(function(){$("#appMenuLoginPanel").animate({right:"-100%"},800);$("#sessionLoginSelect").find("option").not("[value]").prop("selected",
"true")});Foundation.MediaQuery.atLeast("medium")&&($("#appMenuMain").removeClass("vertical"),$("#appMenuPublic").removeClass("vertical"),$("#appMenuUserInfo").removeClass("vertical"),$("#appMenuUserInfo").addClass("align-right"),$("#appMenuUserIdentitySubMenu").removeClass("hide"),k());$(window).on("changed.zf.mediaquery",function(a,f){"small"==f?($("#appMenuMain").addClass("vertical"),$("#appMenuPublic").addClass("vertical"),$("#appMenuUserInfo").addClass("vertical"),$("#appMenuUserInfo").removeClass("align-right"),
$("#appMenuUserIdentitySubMenu").addClass("hide")):($("#appMenuMain").removeClass("vertical"),$("#appMenuPublic").removeClass("vertical"),$("#appMenuUserInfo").removeClass("vertical"),$("#appMenuUserInfo").addClass("align-right"),$("#appMenuUserIdentitySubMenu").removeClass("hide"),k())})};e.prototype.rebuildIdentityList=function(){k()};e.prototype.setCurrentServer=function(){void 0!=AppController.loginController.loginServer&&void 0!=AppController.loginController.loginServer.server&&""!=AppController.loginController.loginServer.server?
$("#appMenuSessionLogout").text("Sign out of "+AppController.loginController.loginServer.server):$("#appMenuSessionLogout").text("Sign out");k();p()};e.prototype.setLoggedIn=function(){$("#appMenuIdentityOptionsBtn").removeClass("invisible");$("#sessionIdentitySelect").removeClass("hide");$("#sessionLoginSelect").addClass("hide");this.setCurrentServer();k()};e.prototype.setLoggedOut=function(){$("#appMenuIdentityOptionsBtn").addClass("invisible");$("#sessionIdentitySelect").addClass("hide");$("#sessionLoginSelect").removeClass("hide");
p()};e.prototype.checkAdmin=function(){AppController.serverController.getAdmin()?$("#appMenuAdmin").removeClass("hide"):$("#appMenuAdmin").addClass("hide")};e.prototype.showSortBasic=function(){$("#appMenuSortBar").removeClass("hide");$("#appMenuSortByTime").removeClass("hide");$("#appMenuSortByOwner").removeClass("hide")};e.prototype.showSortRelations=function(){$("#appMenuSortBar").removeClass("hide");$("#appMenuSortBySource").removeClass("hide");$("#appMenuSortByTarget").removeClass("hide")};e.prototype.showSortByCompetency=
function(){$("#appMenuSortBar").removeClass("hide");$("#appMenuSortByCompetency").removeClass("hide")};e.prototype.hideSort=function(){$("#appMenuSortBar").addClass("hide");$("#appMenuSortByTime").addClass("hide");$("#appMenuSortByOwner").addClass("hide");$("#appMenuSortBySource").addClass("hide");$("#appMenuSortByTarget").addClass("hide");$("#appMenuSortByCompetency").addClass("hide")};e.prototype.showRepoMenu=function(a){a?$("#appMenuRepo").removeClass("hide"):$("#appMenuRepo").addClass("hide")};
e.prototype.showExamplesMenu=function(a){a?$("#appMenuExamples").removeClass("hide"):$("#appMenuExamples").addClass("hide")};e.prototype.buildRecentCompetencyList=function(a){b(a)};e.prototype.buildRecentFrameworkList=function(a){g(a)};return e}(AppMenu);
AssertionEditScreen=function(e){function l(f){function a(a){return 10<=a?a:"0"+a}f=new Date(f.toUTCString());return f.getFullYear()+"-"+a(f.getMonth()+1)+"-"+a(f.getDate())+"T"+a(f.getHours())+":"+a(f.getMinutes())+":"+a(f.getSeconds())}function k(f){$("#competencyEditor").show();$("#assertionEditId").val(f.id);if(void 0!=f.agent){$("#assertionAgentInput option").removeAttr("selected");var a=$("#assertionAgentInput option[value\x3d'"+f.getAgent().toPem()+"']");1!=a.size()?$("#assertionAgentInput").append($("\x3coption selected\x3eUnknown\x3c/option\x3e")):
a.attr("selected","selected")}else void 0!=AppController.identityController.selectedIdentity&&($("#assertionAgentInput option[value\x3d'"+AppController.identityController.selectedIdentity.ppk.toPk().toPem()+"']").attr("selected","selected"),$("#assertionAgentInput").css("font-style","normal"));void 0!=f.subject&&(a=$("#assertionSubjectInput option[value\x3d'"+f.getSubject().toPem()+"']"),$("#assertionSubjectInput option").removeAttr("selected"),1==a.size()?a.attr("selected","selected"):(a=$("\x3coption selected\x3d'selected'\x3eUnknown Subject\x3c/option\x3e"),
a.attr("value",f.getSubject().toPem()),$("#assertionSubjectInput").append(a)),$("#assertionSubjectInput").css("font-style","normal"));void 0!=f.competency&&(a=$("#assertionCompetencyInput option[value\x3d'"+f.competency+"']"),$("#assertionCompetencyInput option").removeAttr("selected"),1==a.size()?a.attr("selected","selected"):EcCompetency.get(f.competency,function(a){var c=$("#assertionCompetencyInput option[value\x3d'"+EcRemoteLinkedData.trimVersionFromUrl(a.id)+"']");0<c.size()?c.attr("selected",
"selected"):(c=$("\x3coption\x3e\x3c/option\x3e"),c.text(a.getName()),c.attr("value",EcRemoteLinkedData.trimVersionFromUrl(a.id)),f.competency==EcRemoteLinkedData.trimVersionFromUrl(a.id)&&($("#assertionCompetencyInput option").removeAttr("selected"),c.attr("selected")),$("#assertionCompetencyInput").append(c))},function(a){a=$("\x3coption selected\x3d'selected'\x3eUnknown Competency\x3c/option\x3e");a.attr("value",f.competency);$("#assertionCompetencyInput").append(a);ViewManager.getView("#assertionEditMessageContainer").displayAlert("Unable to find assertion's competency")}),
$("#assertionCompetencyInput").css("font-style","normal"),void 0!=f.level&&""!=f.level?(a=$("#assertionLevelInput option[value\x3d'"+f.level+"']"),$("#assertionLevelInput option").removeAttr("selected"),1==a.size()?a.attr("selected","selected"):(a=$("\x3coption selected\x3d'selected'\x3eUnknown Level\x3c/option\x3e"),a.attr("value",f.level),$("#assertionLevelInput").append(a))):($("#assertionLevelInput").append("\x3coption value\x3d'held' selected\x3d'selected'\x3eHeld (Demonstrated, but with no performance measures)\x3c/option\x3e"),
$("#assertionLevelInput").attr("disabled","disabled")));void 0!=f.confidence&&($("#assertionConfidenceInput").val(100*f.confidence),$("#assertionConfidenceDisplay").text(100*f.confidence));if(void 0!=f.evidence&&0<f.getEvidenceCount()){for(var c=[],a=0;a<f.getEvidenceCount();a++)c.push(f.getEvidence(a));c=c.join("/n");$("#assertionEvidenceInput").text(c)}void 0!=f.getAssertionDate()&&$("#assertionDateInput").val(l(new Date(f.getAssertionDate())));void 0!=f.getExpirationDate()&&$("#assertionExpirationInput").val(l(new Date(f.getExpirationDate())));
void 0!=f.decayFunction&&$("#assertionDecayInput").val(f.getDecayFunction());if(void 0!=f.owner&&0<f.owner.length)for($("#assertionEditOwner").html(""),a=0;a<f.owner.length;a++)0<a&&$("#assertionEditOwner").append(", "),c=f.owner[a],$("#assertionEditOwner").append("\x3cspan id\x3d'assertion-owner-"+a+"'\x3e\x3c/span\x3e"),ViewManager.showView(new IdentityDisplay(c),"#assertion-owner-"+a);else $("#assertionEditOwner").text("N/A");if(void 0!=f.reader&&0<f.reader.length)for($("#assertionEditReaders").html(""),
$("#assertionEditNoReader").addClass("hide"),a=0;a<f.reader.length;a++)0<a&&$("#assertionEditReaders").append(", "),c=f.reader[a],$("#assertionEditReaders").append("\x3cspan id\x3d'assertion-reader-"+a+"'\x3e\x3c/span\x3e"),ViewManager.showView(new IdentityDisplay(c),"#assertion-reader-"+a);else $("#assertionEditNoReader").removeClass("hide")}function d(f){for(var a in EcIdentityManager.ids){var b=$("\x3coption\x3e\x3c/option\x3e");b.text(EcIdentityManager.ids[a].displayName);b.attr("value",EcIdentityManager.ids[a].ppk.toPk().toPem());
$("#assertionAgentInput").append(b)}$("#assertionAgentInput").change(function(a){a=$("#assertionAgentInput").val();$("#assertionEditOwner").html("\x3cspan id\x3d'assertion-owner-0'\x3e\x3c/span\x3e");ViewManager.showView(new IdentityDisplay(a),"#assertion-owner-0")});for(a in EcIdentityManager.contacts)b=$("\x3coption\x3e\x3c/option\x3e"),b.text(EcIdentityManager.contacts[a].displayName),b.attr("value",EcIdentityManager.contacts[a].pk.toPem()),$("#assertionSubjectInput").append(b);for(a in EcIdentityManager.ids)b=
$("\x3coption\x3e\x3c/option\x3e"),b.text(EcIdentityManager.ids[a].displayName),b.attr("value",EcIdentityManager.ids[a].ppk.toPk().toPem()),$("#assertionSubjectInput").append(b);0==EcIdentityManager.contacts.length&&0==EcIdentityManager.ids.length&&(b=$("\x3coption selected\x3eMust be connected with other users to Assert Competency\x3c/option\x3e"),$("#assertionSubjectInput option").removeAttr("selected"),$("#assertionSubjectInput").append(b.clone()),$("#assertionSubjectInput").attr("disabled","disabled"),
$("#assertionCompetencyInput option").removeAttr("selected"),$("#assertionCompetencyInput").append(b.clone()),$("#assertionCompetencyInput").attr("disabled","disabled"),$("#assertionLevelInput option").removeAttr("selected"),$("#assertionLevelInput").append(b.clone()),$("#assertionLevelInput").attr("disabled","disabled"),$("#assertionConfidenceInput").attr("disabled","disabled"),$("#assertionEvidenceInput").attr("disabled","disabled"),$("#assertionDateInput").attr("disabled","disabled"),$("#assertionExpirationInput").attr("disabled",
"disabled"),$("#assertionDecayInput").attr("disabled","disabled"),ViewManager.getView("#assertionEditMessageContainer").displayAlert("Cannot create an assertion unless you have a contact to assert about"));$("#assertionSubjectInput").change(function(){var a=$("#assertionSubjectInput").val();ViewManager.showView(new IdentityDisplay(a),"#assertionEditSubject");$("#assertionSubjectInput").css("font-style","normal")});EcCompetency.search(AppController.serverController.getRepoInterface(),"*",function(a){for(var c in a){var b=
$("#assertionCompetencyInput option[value\x3d'"+EcRemoteLinkedData.trimVersionFromUrl(a[c].id)+"']");0<b.size()?b.attr("selected","selected"):(b=$("\x3coption\x3e\x3c/option\x3e"),b.text(a[c].getName()),b.attr("value",EcRemoteLinkedData.trimVersionFromUrl(a[c].id)),f.competency==EcRemoteLinkedData.trimVersionFromUrl(a[c].id)&&($("#assertionCompetencyInput option").removeAttr("selected"),b.attr("selected")),$("#assertionCompetencyInput").append(b))}},p);if(void 0!=f.competency&&""!=f.competency){if(void 0==
f.level||""==f.level)$("#assertionLevelInput option").removeAttr("selected"),$("#assertionLevelInput").append($("\x3coption selected\x3eNo level selected\x3c/option\x3e"));EcLevel.searchByCompetency(AppController.serverController.getRepoInterface(),f.competency,function(a){for(var c in a){var b=$("\x3coption\x3e\x3c/option\x3e");b.text(a[c].name);b.attr("value",EcRemoteLinkedData.trimVersionFromUrl(a[c].id));void 0!=f.level&&f.level==EcRemoteLinkedData.trimVersionFromUrl(a[c].id)&&($("#assertionLevelInput option").removeAttr("selected"),
b.attr("selected","selected"));$("#assertionLevelInput").append(b)}},c)}$("#assertionCompetencyInput").change(function(){var a=$("#assertionCompetencyInput").val();$("#assertionCompetencyInput").css("font-style","normal");EcLevel.searchByCompetency(AppController.serverController.getRepoInterface(),a,function(a){$("#assertionLevelInput option").remove();for(var c in a){var f=$("\x3coption\x3e\x3c/option\x3e");f.text(a[c].name);f.attr("value",EcRemoteLinkedData.trimVersionFromUrl(a[c].id));$("#assertionLevelInput").append(f)}0==
a.length?($("#assertionLevelInput").append("\x3coption selected value\x3d'held'\x3eHeld (Demonstrated, but with no performance measures)\x3c/option\x3e"),$("#assertionLevelInput").attr("disabled","disabled"),$("#assertionLevelInput").css("font-style","normal")):($("#assertionLevelInput").removeAttr("disabled"),$("#assertionLevelInput").css("font-style","italic"),$("#assertionLevelInput").append("\x3coption selected class\x3d'hide' disabled\x3d'disabled'\x3eSelect the level of competency being asserted\x3c/option\x3e"))},
c)});$("#assertionLevelInput").change(function(){$("#assertionLevelInput").css("font-style","normal")});$("#assertionConfidenceInput").change(function(){var a=$("#assertionConfidenceInput").val();$("#assertionConfidenceDisplay").text(a)});$("#assertionDateInput").val(l(new Date));a=new Date;a.setFullYear((new Date).getFullYear()+1);$("#assertionExpirationInput").val(l(a))}function b(){$("#datum").effect("highlight",{},1500)}function h(c){void 0==c&&(c="Unable to Connect to Server to Retrieve Assertion for Editing");
ViewManager.getView("#assertionEditMessageContainer").displayAlert(c)}function g(c){void 0==c&&(c="Unable to Connect to Server to Save Assertion");ViewManager.getView("#assertionEditMessageContainer").displayAlert(c,"saveFail")}function p(c){void 0==c&&(c="Unable to Connect to Server to Retrieve Competencies");ViewManager.getView("#assertionEditMessageContainer").displayAlert(c)}function c(c){void 0==c&&(c="Unable to Connect to Server to Retrieve Levels");ViewManager.getView("#assertionEditMessageContainer").displayAlert(c)}
e.prototype.display=function(c){var a=this.data;void 0!=a&&void 0!=a.id&&ScreenManager.setScreenParameters({id:a.id});var f=!1;void 0==a&&(f=!0,a=new EcAssertion,a.generateId(AppController.serverController.getRepoInterface().selectedServer),void 0!=AppController.identityController.selectedIdentity&&a.addOwner(AppController.identityController.selectedIdentity.ppk.toPk()));ViewManager.showView(new MessageContainer("assertionEdit"),"#assertionEditMessageContainer",function(){f&&!AppController.loginController.getLoggedIn()&&
ViewManager.getView("#assertionEditMessageContainer").displayAlert("Unable to Create an Assertion Unless you Identify yourself by logging in")});$("#assertionEditSearchBtn").attr("href","#"+AssertionSearchScreen.prototype.displayName);$("#assertionEditSearchBtn").click(function(a){a.preventDefault();ScreenManager.changeScreen(new AssertionSearchScreen)});f?$("#assertionEditViewBtn").hide():($("#assertionEditViewBtn").attr("href","#"+AssertionViewScreen.prototype.displayName),$("#assertionEditViewBtn").click(function(c){c.preventDefault();
ScreenManager.changeScreen(new AssertionViewScreen(a))}));$("#assertionEditBtn").attr("href","#"+e.prototype.displayName);$("#assertionEditBtn").click(function(a){a.preventDefault()});$("#assertionEditCancelBtn").click(function(a){a.preventDefault();ScreenManager.changeScreen(new AssertionViewScreen)});f?$("#assertionEditDeleteBtn").remove():$("#assertionEditDeleteBtn").click(function(c){c.preventDefault();ModalManager.showModal(new ConfirmModal(function(){EcRepository._delete(a,function(){ScreenManager.changeScreen(new AssertionSearchScreen)},
function(a){void 0==a&&(a="Unable to connect to server to delete assertion");ViewManager.getView("#assertionEditMessageContainer").displayAlert(a)});ModalManager.hideModal()},"Are you sure you want to delete this assertion?"))});!f||AppController.loginController.getLoggedIn()&&AppController.identityController.canEdit(a)?($("#assertionEditSaveBtn").click(function(c){c.preventDefault();if(void 0==$("#assertionSubjectInput").val()||""==$("#assertionSubjectInput").val()||$("#assertionSubjectInput").val()==
$("#assertionSubjectInput #noSubject").text())ViewManager.getView("#assertionEditMessageContainer").displayAlert("Unable to Create an Assertion Without Subject");else if(a.setSubject(EcPk.fromPem($("#assertionSubjectInput").val())),void 0==$("#assertionAgentInput").val()||""==$("#assertionAgentInput").val()||$("#assertionAgentInput").val()==$("#assertionAgentInput #noAgent").text())ViewManager.getView("#assertionEditMessageContainer").displayAlert("Unable to Create an Assertion Without Specifying Agent");
else if(a.setAgent(EcPk.fromPem($("#assertionAgentInput").val())),void 0==$("#assertionCompetencyInput").val()||""==$("#assertionCompetencyInput").val()||$("#assertionCompetencyInput").val()==$("#assertionCompetencyInput #noCompetency").text())ViewManager.getView("#assertionEditMessageContainer").displayAlert("Unable to Create an Assertion Without Specifying Competency");else{a.setCompetency($("#assertionCompetencyInput").val());void 0==$("#assertionLevelInput").val()||""==$("#assertionLevelInput").val()||
$("#assertionLevelInput").val()==$("#assertionLevelInput #noLevel").text()||"held"==$("#assertionLevelInput").val()?a.setLevel(""):a.setLevel($("#assertionLevelInput").val());c=$("#assertionConfidenceInput").val();1<c&&(c/=100);a.setConfidence(c);c=$("#assertionEvidenceInput").val().split(/\n/);void 0!=c&&1==c.length&&void 0==c[0]||""==c[0]?a.evidence=void 0:a.setEvidence(c);c=(new Date($("#assertionDateInput").val())).toUTCString().split(" ");c.splice(5,1);var f=(new Date($("#assertionExpirationInput").val())).toUTCString().split(" ");
f.splice(5,1);a.setAssertionDate((new Date(c.join(" "))).getTime());a.setExpirationDate((new Date(f.join(" "))).getTime());a.setDecayFunction($("#assertionDecayInput").val());a.save(b,g)}}),$("#assertionEditSaveBtn").on("mousemove",function(){var a=$("#assertionEditId").val().split("/");"data"==a[a.length-4]&&(a[a.length-1]=(new Date).getTime());$("#assertionEditId").val(a.join("/"))}),d(a)):($("#assertionEditSaveBtn").removeClass("fake-a-label"),$("#assertionEditSaveBtn").css("cursor","default"),
$("#assertionAgentInput").attr("disabled","disabled"),$("#assertionSubjectInput").attr("disabled","disabled"),$("#assertionCompetencyInput").attr("disabled","disabled"),$("#assertionLevelInput").attr("disabled","disabled"),$("#assertionConfidenceInput").attr("disabled","disabled"),$("#assertionEvidenceInput").attr("disabled","disabled"),$("#assertionDateInput").attr("disabled","disabled"),$("#assertionExpirationInput").attr("disabled","disabled"),$("#assertionDecayInput").attr("disabled","disabled"));
$("#assertionEditAddReader").click(function(c){c.preventDefault();ModalManager.showModal(new AdvancedPermissionsModal(a,function(a){k(a);ModalManager.hideModal()},!0))});f?k(a):EcAssertion.get(a.id,function(c){a=c;k(c)},h)};return e}(AssertionEditScreen);
AssertionSearchScreen=function(e){function l(h){setTimeout(function(){ViewManager.getView("#assertionSearchMessageContainer").clearAlert("searchFail");var g;g=void 0==h?k:d;var e={size:24};e.start=h;EcAssertion.search(AppController.serverController.getRepoInterface(),"*",function(c){var f=function(){void 0!=ViewManager.getView("#assertionSearchResults")?g(c):setTimeout(f,100)};f()},b,e)},100)}function k(b){ViewManager.getView("#assertionSearchResults").clear();d(b)}function d(b){ViewManager.getView("#menuContainer").showSortBasic();
ViewManager.getView("#assertionSearchResults").populate(b);0==b.length&&0==$("#assertionResults-data").first().children().size()?ViewManager.getView("#assertionSearchResults").showNoDataMessage():24>b.length?$("#moreSearchResults").addClass("hide"):($("#getMoreResults").click(function(){$("#getMoreResults").addClass("hide");$("#loadingMoreResults").removeClass("hide");l($("#assertionResults-data").first().children().size())}),$("#getMoreResults").removeClass("hide"),$("#moreSearchResults").removeClass("hide"),
$("#loadingMoreResults").addClass("hide"))}function b(b){void 0==b&&(b="Unable to Connect to Server for Assertion Search");ViewManager.getView("#competencySearchMessageContainer").displayAlert(b,"searchFail")}e.prototype.display=function(b){ViewManager.showView(new MessageContainer("assertionSearch"),"#assertionSearchMessageContainer");ViewManager.showView(new DataViewer("assertionResults",{sort:{},clickDataEdit:function(b){ScreenManager.changeScreen(new AssertionEditScreen(b))},buildDataRow:function(b,
d,c){b.append("\x3cdiv class\x3d'small-5 columns'\x3e\x3ca\x3eAssertion about \x3cspan class\x3d'datum-competency' style\x3d'font-style:italic'\x3e\x3c/span\x3e\x3c/a\x3e\x3c/div\x3e\x3cdiv class\x3d'small-2 columns datum-subject'\x3e\x3c/div\x3e\x3cdiv class\x3d'small-2 columns datum-agent'\x3e\x3c/div\x3e\x3cdiv class\x3d'small-3 columns datum-owner'\x3e\x3c/div\x3e");b.find(".datum-competency").text("Loading..");EcCompetency.get(c.competency,function(a){$("[data-id\x3d'"+c.id+"']").find(".datum-competency").text(a.getName())},
function(){b.find(".datum-competency").text("Unknown Competency")});for(var f in c.owner){var a=EcRemoteLinkedData.trimVersionFromUrl(d),a=a.split("/")[a.split("/").length-1]+"-owner-"+f,g=$("\x3cspan id\x3d'"+a+"'\x3e\x3c/span\x3e");b.find(".datum-owner").append(g);ViewManager.showView(new IdentityDisplay(c.owner[f]),"#"+a)}b.find(".datum-agent").html("\x3cspan style\x3d'font-style:italic;'\x3eLoading...\x3c/span\x3e");c.getAgentAsync(function(a){void 0==a||null==a?b.find(".datum-agent").html("by \x3cspan style\x3d'font-style:italic;'\x3e\x26lt;Restricted\x26gt;\x3c/span\x3e"):
(b.find(".datum-agent").html("by \x3cspan id\x3d'assertion-agent"+c.getGuid()+"'\x3e\x3c/span\x3e"),ViewManager.showView(new IdentityDisplay(a.toPem()),"#assertion-agent"+c.getGuid()+""))},function(a){b.find(".datum-agent").html("by \x3cspan style\x3d'font-style:italic;'\x3e\x26lt;Restricted\x26gt;\x3c/span\x3e")});b.find(".datum-subject").html("\x3cspan style\x3d'font-style:italic;'\x3eLoading...\x3c/span\x3e");c.getSubjectAsync(function(a){void 0==a||null==a?b.find(".datum-subject").html("about \x3cspan style\x3d'font-style:italic;'\x3e\x26lt;Restricted\x26gt;\x3c/span\x3e"):
(b.find(".datum-subject").html("about \x3cspan id\x3d'assertion-subject"+c.getGuid()+"'\x3e\x3c/span\x3e"),ViewManager.showView(new IdentityDisplay(a.toPem()),"#assertion-subject"+c.getGuid()+""))},function(a){b.find(".datum-subject").html("about \x3cspan style\x3d'font-style:italic;'\x3e\x26lt;Restricted\x26gt;\x3c/span\x3e")});b.find("a").click(function(a){a.preventDefault();ScreenManager.changeScreen(new AssertionViewScreen(c))})}}),"#assertionSearchResults");l();ViewManager.getView("#menuContainer").showSortBasic()};
e.prototype.onClose=function(){ViewManager.getView("#menuContainer").hideSort()};e.prototype.sortByTimestamp=function(){$("#assertionResults-sortSelect").val("timestamp");$("#assertionResults-sortSelect").trigger("change")};e.prototype.sortByOwner=function(){$("#assertionResults-sortSelect").val("owner");$("#assertionResults-sortSelect").trigger("change")};return e}(AssertionSearchScreen);
AssertionViewScreen=function(e){function l(b){$("#assertionViewId").text(b.id);var h=b.getAgent();if(void 0!=h){var g=$(createContactSmall(h.toPem()));$("#assertionViewAgent").html(g);ViewManager.showView(new IdentityDisplay(h.toPem()),"#assertionViewAgent");"Unknown"==g.find(".contactText").text()&&($("#assertionViewAgentContainer").addClass("unknown"),$("#assertionToggleUnknownBtn").removeClass("hide"))}else $("#assertionViewAgent").html("\x3cspan style\x3d'font-style:italic'\x3eUnknown\x3c/span\x3e"),
$("#assertionViewAgentContainer").addClass("unknown"),$("#assertionViewAgentContainer").css("display","none"),$("#assertionToggleUnknownBtn").removeClass("hide");h=b.getSubject();void 0!=h?(ViewManager.showView(new IdentityDisplay(h.toPem()),"#assertionViewSubject"),"Unknown"==g.find(".contactText").text()&&($("#assertionViewSubjectContainer").addClass("unknown"),$("#assertionToggleUnknownBtn").removeClass("hide"))):($("#assertionViewSubject").html("\x3cspan style\x3d'font-style:italic'\x3eUnknown\x3c/span\x3e"),
$("#assertionViewSubjectContainer").addClass("unknown"),$("#assertionViewSubjectContainer").css("display","none"),$("#assertionToggleUnknownBtn").removeClass("hide"));g=b.competency;void 0!=g?EcCompetency.get(g,function(b){if(void 0!=b){var c=$("\x3ca href\x3d'"+CompetencyViewScreen.displayName+"?id\x3d"+b.id+"'\x3e"+b.name+"\x3c/a\x3e");c.click(function(c){c.preventDefault();ScreenManager.changeScreen(new CompetencyViewScreen(b))});$("#assertionViewCompetency").html(c)}else $("#assertionViewCompetency").html("\x3cspan style\x3d'font-style:italic'\x3eUnknown\x3c/span\x3e"),
$("#assertionViewCompetencyContainer").addClass(" unknown"),$("#assertionViewCompetencyContainer").css("display","none"),$("#assertionToggleUnknownBtn").removeClass("hide")},function(b){try{JSON.parse(b);void 0==b&&(b="Unable to Connect to Server to Retrieve Assertion Competency");ViewManager.getView("#assertionViewMessageContainer").displayAlert(b,"getCompetency");return}catch(c){}$("#assertionViewCompetency").html("\x3cspan style\x3d'font-style:italic'\x3eUnknown\x3c/span\x3e");$("#assertionViewCompetencyContainer").addClass(" unknown");
$("#assertionViewCompetencyContainer").css("display","none");$("#assertionToggleUnknownBtn").removeClass("hide")}):(ViewManager.getView("#assertionViewMessageContainer").displayAlert("Assertion is Missing Competency Reference"),$("#assertionViewCompetency").html("\x3cspan style\x3d'font-style:italic'\x3eUnknown\x3c/span\x3e"),$("#assertionViewCompetencyContainer").addClass("hide unknown"),$("#assertionViewCompetencyContainer").css("display","none"),$("#assertionToggleUnknownBtn").removeClass("hide"));
g=b.level;void 0!=g?EcLevel.get(g,function(b){if(void 0!=b){var c="";void 0!=b.description&&""!=b.description&&(c+="Description: "+b.description+"\x3cbr/\x3e\x3cbr/\x3e");void 0!=b.title&&""!=b.title&&(c+="Title: "+b.title+"\x3cbr/\x3e\x3cbr/\x3e");void 0!=b.performance&&""!=b.performance&&(c+="Performance Measure: "+b.performance+"\x3cbr/\x3e\x3cbr/\x3e");if(void 0!=b.owner&&0<b.owner.length){for(var c=c+"Owner: ",f=0;f<b.owner.length;f++)0!=f&&(c+=", "),c+=AppController.identityController.lookup(b.owner[f]).displayName;
c+="\x3cbr/\x3e\x3cbr/\x3e"}c+=b.id;f=$("\x3cspan class\x3d'has-tip' style\x3d'font-weight:normal'\x3e\x3c/span\x3e");f.text(b.name);$("#assertionViewLevel").append(f);new Foundation.Tooltip($("#assertionViewLevel .has-tip"),{tipText:c})}else $("#assertionViewLevel").html("\x3cspan style\x3d'font-style:italic'\x3eUnknown\x3c/span\x3e"),$("#assertionViewLevelContainer").addClass("unknown"),$("#assertionViewLevelContainer").css("display","none"),$("#assertionToggleUnknownBtn").removeClass("hide")},
d):$("#assertionViewLevel").html("Held (Demonstrated, but with no performance measures)");g=b.confidence;1>g&&(g=Math.round(100*g));$("#assertionViewConfidence").text(g+"%");g=b.getDecayFunction();void 0!=g?"linear"==g?$("#assertionViewDecay").text("Linear"):"exponential"==g?$("#assertionViewDecay").text("Exponential"):"logarithmic"==g&&$("#assertionViewDecay").text("Logarithmic"):($("#assertionViewDecay").html("\x3cspan style\x3d'font-style:italic'\x3eUnknown\x3c/span\x3e"),$("#assertionViewDecayContainer").addClass("unknown"),
$("#assertionViewDecayContainer").css("display","none"),$("#assertionToggleUnknownBtn").removeClass("hide"));g=b.getEvidenceCount();0==g?$("#assertionViewEvidence").text("No pieces of evidence available"):(1==g?$("#assertionViewEvidence").text("1 piece of evidence available"):$("#assertionViewEvidence").text(g+" pieces of evidence available"),$("#assertionViewEvidence").addClass("fake-a"),$("#assertionViewEvidence").click(function(g){g.preventDefault();g=[];for(var c=0;c<b.getEvidenceCount();c++)g.push(b.getEvidence(c));
ModalManager.showModal(new EvidenceViewModal(g))}));g=b.getAssertionDate();void 0!=g?$("#assertionViewDate").text((new Date(g)).toLocaleString()):($("#assertionViewDate").html("\x3cspan style\x3d'font-style:italic'\x3eUnknown\x3c/span\x3e"),$("#assertionViewDateContainer").addClass("unknown"),$("#assertionViewDateContainer").css("display","none"),$("#assertionToggleUnknownBtn").removeClass("hide"));g=b.getExpirationDate();void 0!=g?$("#assertionViewExpiration").text((new Date(g)).toLocaleString()):
($("#assertionViewExpiration").html("\x3cspan style\x3d'font-style:italic'\x3eUnknown\x3c/span\x3e"),$("#assertionViewExpirationContainer").addClass("unknown"),$("#assertionViewExpirationContainer").css("display","none"),$("#assertionToggleUnknownBtn").removeClass("hide"));if(void 0!=b.owner&&0<b.owner.length)for($("#assertionViewOwner").text(""),g=0;g<b.owner.length;g++)0<g&&$("#assertionViewOwner").append(", "),h=b.owner[g],$("#assertionViewOwner").append("\x3cspan id\x3d'assertion-owner-"+g+"'\x3e\x3c/span\x3e"),
ViewManager.showView(new IdentityDisplay(h),"#assertion-owner-"+g)}function k(b){void 0==b&&(b="Unable to Connect to Server to Retrieve Assertion");ViewManager.getView("#assertionViewMessageContainer").displayAlert(b,"getAssertion")}function d(b){void 0==b&&(b="Unable to Connect to Server to Retrieve Level");ViewManager.getView("#assertionViewMessageContainer").displayAlert(b,"getLevel")}e.prototype.display=function(b){var d=this.data;null!=d.id&&ScreenManager.setScreenParameters({id:d.id});ViewManager.showView(new MessageContainer("assertionView"),
"#assertionViewMessageContainer");$("#assertionViewSearchBtn").attr("href","#"+AssertionSearchScreen.prototype.displayName);$("#assertionViewSearchBtn").click(function(b){b.preventDefault();ScreenManager.changeScreen(new AssertionSearchScreen(d))});$("#assertionViewBtn").attr("href","#"+e.prototype.displayName);$("#assertionViewBtn").click(function(b){b.preventDefault()});$("#assertionToggleUnknownBtn").click(function(b){b.preventDefault();"Show"==$("#assertionToggleUnknownBtn #toggleKeyword").text()?
($("#assertionToggleUnknownBtn #toggleKeyword").text("Hide"),$(".unknown").slideDown()):($("#assertionToggleUnknownBtn #toggleKeyword").text("Show"),$(".unknown").slideUp())});AppController.identityController.canEdit(d)?$("#editAssertionBtn").click(function(b){b.preventDefault();ScreenManager.changeScreen(new AssertionEditScreen(d))}):$("#editAssertionBtn").remove();AppController.identityController.owns(d)||AppController.serverController.getAdmin()?$("#assertionViewDeleteBtn").click(function(){ModalManager.showModal(new ConfirmModal(function(){EcRepository._delete(d,
function(){ScreenManager.changeScreen(new AssertionSearchScreen)},function(b){void 0==b&&(b="Unable to connect to server to delete assertion");ViewManager.getView("#assertionViewMessageContainer").displayAlert(b)});ModalManager.hideModal()},"Are you sure you want to delete this assertion?"))}):$("#assertionViewDeleteBtn").remove();EcAssertion.get(d.id,function(b){d=b;l(b)},k)};return e}(AssertionViewScreen);
var ChangeServerModal=function(e){function l(){var d=$("#newServer").val();AppController.serverController.selectServer(d,function(){ModalManager.hideModal();AppController.loginController.loginServer.isGlobal()||(AppController.loginController.logout(),ViewManager.getView("#menuContainer").setLoggedOut());AppController.loginController.loginServer=AppController.serverController.getRepoInterface();AppMenu.prototype.setCurrentServer();ScreenManager.reloadCurrentScreen()},function(b){$("#newServer").val(k);
b="Unable to change servers, reverting to previous server: "+b;ViewManager.getView("#changeServerMessageContainer").displayAlert(b)})}var k;e.prototype.display=function(d){ViewManager.showView(new MessageContainer("changeServer"),"#changeServerMessageContainer",function(){AppController.loginController.getLoggedIn()&&(AppController.loginController.loginServer.isGlobal()||ViewManager.getView("#changeServerMessageContainer").displayWarning("You are currently logged in, you will be logged out if you change servers"))});
$("#changeServerCurrentServer").text(AppController.serverController.selectedServerName);$("#changeServerCurrentServer").attr("title",AppController.serverController.selectedServerUrl);if(0<$(AppController.serverController.serverList).size()){$("#newServer").html("");for(var b in AppController.serverController.serverList){d=AppController.serverController.serverList[b];var h=$("\x3coption\x3e\x3c/option\x3e");b==AppController.serverController.selectedServerName&&h.attr("selected","selected");h.attr("value",
d);h.text(b);$("#newServer").append(h)}}k=AppController.serverController.selectedServerUrl;$("#addServer").click(function(){ModalManager.showModal(new AddServerModal(function(){ModalManager.showModal(new e)}))});$("#changeServerForm").submit(function(b){b.preventDefault();l()});$("#changeServerCancel").click(function(b){b.preventDefault();ModalManager.hideModal()})};return e}(ChangeServerModal),ChangeTypeModal=function(e){function l(d){if(null!=d.type&&null!=d.context){var b=$("\x3coption\x3e\x3c/option\x3e");
b.text(d.type);b.attr("value",d.type);b.attr("selected","selected");$("#changeTypeSelect").prepend(b);k[d.type]=function(b){void 0!=d.generateId&&d.generateId(AppController.serverController.getRepoInterface().selectedServer);b.changeObject(d)}}}var k={};e.prototype.display=function(d){k=[];var b=this.changeObj,h=ViewManager.getView(this.repoEditContainerId);ViewManager.showView(new MessageContainer("changeType"),"#changeTypeMessageContainer");d=new Thing;d.name="New Thing";l(d);void 0!=h?($("#changeTypeSelect").change(function(){"other"==
$("#changeTypeSelect").val()?$("#changeTypeOtherContainer").removeClass("hide"):$("#changeTypeOtherContainer").addClass("hide")}),$("#changeTypeSubmit").click(function(){var g=$("#changeTypeSelect").val();if(void 0!=k[g])k[g](addingTo,h),ModalManager.hideModal();else{var g=$("#changeTypeOtherSchemaInput").val(),d=$("#changeTypeOtherInput").val();void 0!=d&&""!=d&&void 0!=g&&""!=g?(h.changeType(b,g,d),ModalManager.hideModal()):ViewManager.getView("#changeTypeMessageContainer").displayAlert("Cannot Set Blank Context or Type")}})):
($("#changeTypeSelect").attr("disabled","disabled"),ViewManager.getView("#changeTypeMessageContainer").displayAlert("Unable to change type, are you one the right screen?"));$("#changeTypeCancel").click(function(){ModalManager.hideModal()})};return e}(ChangeTypeModal);
CompetencyEditScreen=function(e){function l(a){$("#competencyEditor").show();$("#competencyEditId").val(a.id);$("#competencyEditName").val(a.getName());$("#competencyEditDescription").val(a.getDescription());$("#competencyEditScope").val(a.scope);if(void 0!=a.owner&&0<a.owner.length){$("#competencyEditOwner").html("");for(var b=0;b<a.owner.length;b++){0<b&&$("#competencyEditOwner").append(", ");var f=a.owner[b];$("#competencyEditOwner").append("\x3cspan id\x3d'competency-owner-"+b+"'\x3e\x3c/span\x3e");
ViewManager.showView(new IdentityDisplay(f),"#competency-owner-"+b)}}else $("#competencyEditOwner").text("Public"),$("#competencyEditOwnerAdvanced").hide();if(EcEncryptedValue.encryptOnSave(a.id))if("none"==$("#privateRow").css("display")&&$("#privateRow").slideDown(),void 0!=a.reader&&0!=a.reader.length)for($("#competencyEditNoReaders").addClass("hide"),$("#competencyEditReaders").html(""),b=0;b<a.reader.length;b++)f=a.reader[b],$("#competencyEditReaders").append("\x3cspan id\x3d'competency-reader-"+
b+"'\x3e\x3c/span\x3e"),ViewManager.showView(new IdentityDisplay(f),"#competency-reader-"+b),b<a.reader.length-1&&$("#competencyEditReaders").append(", ");else $("#competencyEditNoReaders").removeClass("hide");else"none"!=$("#privateRow").css("display")&&$("#privateRow").slideUp();$("#competencyNoLevels").removeClass("hide");$("#competencyLevelContainer").children(".level").remove();a.levels(AppController.serverController.getRepoInterface(),k,p);$("#competencyNoRollupRules").removeClass("hide");$("#competencyRollupRuleContainer").children(".rollupRule").remove();
a.rollupRules(AppController.serverController.getRepoInterface(),d,c)}function k(a){$("#competencyNoLevels").addClass("hide");var b=$("\x3cspan data-tooltip data-fade-out-duration\x3d'1500' class\x3d'level fake-a has-tip top'\x3e\x3c/span\x3e");b.append(a.getName());b.attr("id",a.id);var c="";void 0!=a.description&&""!=a.description&&(c+="Description: "+a.description+"\x3cbr/\x3e\x3cbr/\x3e");void 0!=a.title&&""!=a.title&&(c+="Title: "+a.title+"\x3cbr/\x3e\x3cbr/\x3e");void 0!=a.performance&&""!=a.performance&&
(c+="Performance Measure: "+a.performance+"\x3cbr/\x3e\x3cbr/\x3e");if(void 0!=a.owner&&0<a.owner.length){for(var c=c+"Owner: ",f=0;f<a.owner.length;f++)0!=f&&(c+=", "),c+=AppController.identityController.lookup(a.owner[f]).displayName;c+="\x3cbr/\x3e\x3cbr/\x3e"}c+=a.id;0<$("#competencyLevelContainer").children("span").size()&&$("#competencyLevelContainer").append(", ");$("#competencyLevelContainer").append(b);b.click(function(c){c.preventDefault();ModalManager.showModal(new EditLevelModal(a,function(a){b.parent().contents().filter(function(){return 3==
this.nodeType}).last().remove();b.foundation("destroy");b.remove();null!=a?k(a):0==$("#competencyLevelContainer").find(".level").size()&&$("#competencyNoLevels").removeClass("hide")}))});new Foundation.Tooltip(b,{tipText:c})}function d(a){$("#competencyNoRollupRules").addClass("hide");var c=$("\x3cspan data-tooltip data-fade-out-duration\x3d'1500' class\x3d'rollup-rule fake-a has-tip top'\x3e\x3c/span\x3e");c.append(a.getName());c.attr("id",a.id);var b="";void 0!=a.description&&""!=a.description&&
(b+="Description: "+a.description+"\x3cbr/\x3e\x3cbr/\x3e");void 0!=a.rule&&""!=a.rule&&(b+="Rule: "+a.rule+"\x3cbr/\x3e\x3cbr/\x3e");void 0!=a.outcome&&""!=a.outcome&&(b+="Outcome: "+a.outcome+"\x3cbr/\x3e\x3cbr/\x3e");if(void 0!=a.owner&&0<a.owner.length){for(var b=b+"Owner: ",f=0;f<a.owner.length;f++)0!=f&&(b+=", "),b+=AppController.identityController.lookup(a.owner[f]).displayName;b+="\x3cbr/\x3e\x3cbr/\x3e"}b+=a.id;0<$("#competencyRollupRuleContainer").children("span").size()&&$("#competencyRollupRuleContainer").append(", ");
$("#competencyRollupRuleContainer").append(c);c.click(function(b){b.preventDefault();ModalManager.showModal(new EditRollupRuleModal(a,function(a){c.parent().contents().filter(function(){return 3==this.nodeType}).last().remove();c.foundation("destroy");c.remove();null!=a?d(a):0==$("#competencyRollupRuleContainer").find("span").size()&&$("#competencyNoRollupRules").removeClass("hide")}))});new Foundation.Tooltip(c,{tipText:b})}function b(){$("#datum").effect("highlight",{},1500);null!=f&&EcFramework.get(f,
function(b){var d=!1,n=!1;b.addCompetency(a.id);a.levels(AppController.serverController.getRepoInterface(),function(a){b.addLevel(a.id)},p,function(a){b.save(function(a){d?ScreenManager.changeScreen(new FrameworkEditScreen({id:EcRemoteLinkedData.trimVersionFromUrl(f)})):n=!0},g)});a.rollupRules(AppController.serverController.getRepoInterface(),function(a){b.addRollupRule(a.id)},c,function(a){b.save(function(a){n?ScreenManager.changeScreen(new FrameworkEditScreen({id:EcRemoteLinkedData.trimVersionFromUrl(f)})):
d=!0},g)})},h)}function h(a){void 0==a&&(a="Unable to Connect to Server to Retrieve Competency for Editing");ViewManager.getView("#competencyEditMessageContainer").displayAlert(a)}function g(a){void 0==a&&(a="Unable to Connect to Server to Save Competency");ViewManager.getView("#competencyEditMessageContainer").displayAlert(a,"saveFail")}function p(a){void 0==a&&(a="Unable to Connect to Server to Retrieve Competency Levels");ViewManager.getView("#competencyEditMessageContainer").displayAlert(a,"getLevels")}
function c(a){void 0==a&&(a="Unable to Connect to Server to Retrieve Competency Rollup Rules");ViewManager.getView("#competencyEditMessageContainer").displayAlert(a,"getRollupRules")}var f=null,a=null;e.prototype.display=function(c){a=this.data;null==a&&(a={});void 0!=a.id&&ScreenManager.setScreenParameters({id:a.id});null!=this.frameworkId?ScreenManager.setScreenParameters({frameworkId:this.frameworkId}):null!=a.frameworkId&&ScreenManager.setScreenParameters({frameworkId:this.frameworkId=a.frameworkId});
f=this.frameworkId;void 0==a.id&&(a=new EcCompetency,a.generateId(AppController.serverController.getRepoInterface().selectedServer),a.name="",void 0!=AppController.identityController.selectedIdentity&&a.addOwner(AppController.identityController.selectedIdentity.ppk.toPk()),$("#competencyEditName").focus());ViewManager.showView(new MessageContainer("competencyEdit"),"#competencyEditMessageContainer",function(){""==a.name&&void 0==AppController.identityController.selectedIdentity&&ViewManager.getView("#competencyEditMessageContainer").displayWarning("You are Creating a Public Competency, this competency can be modified by anyone")});
$("#competencyEditSearchBtn").attr("href","#"+CompetencySearchScreen.prototype.displayName);$("#competencyEditSearchBtn").click(function(b){b.preventDefault();""==a.name?ScreenManager.changeScreen(new CompetencySearchScreen):ScreenManager.changeScreen(new CompetencySearchScreen(a))});""==a.name?$("#competencyEditViewBtn").hide():($("#competencyEditViewBtn").attr("href","#"+CompetencyViewScreen.prototype.displayName),$("#competencyEditViewBtn").click(function(b){b.preventDefault();ScreenManager.changeScreen(new CompetencyViewScreen(a))}));
$("#competencyEditBtn").attr("href","#"+e.prototype.displayName);$("#competencyEditBtn").click(function(a){a.preventDefault()});$("#competencyEditCancelBtn").click(function(b){b.preventDefault();null==f?ScreenManager.changeScreen(new CompetencyViewScreen(a)):ScreenManager.changeScreen(new FrameworkEditScreen({id:EcRemoteLinkedData.trimVersionFromUrl(f)}))});""==a.name?$("#competencyEditDeleteBtn").remove():$("#competencyEditDeleteBtn").click(function(b){b.preventDefault();ModalManager.showModal(new ConfirmModal(function(){a._delete(function(){ScreenManager.changeScreen(new CompetencySearchScreen)},
function(a){void 0==a&&(a="Unable to connect to server to delete framework");ViewManager.getView("#competencyEditMessageContainer").displayAlert(a)});ModalManager.hideModal()},"Are you sure you want to delete this competency?"))});$("#competencyEditSaveBtn").click(function(c){c.preventDefault();a.setName($("#competencyEditName").val());a.setDescription($("#competencyEditDescription").val());a.scope=$("#competencyEditScope").val();""!=a.name?(ViewManager.getView("#competencyEditMessageContainer").clearAlert("saveFail"),
ViewManager.getView("#competencyEditMessageContainer").clearAlert("defaultName"),a.save(b,g)):ViewManager.getView("#competencyEditMessageContainer").displayAlert("Cannot Save Competency Without a Name","defaultName")});$("#competencyEditSaveBtn").on("mousemove",function(){var a=$("#competencyEditId").val().split("/");"data"==a[a.length-4]&&(a[a.length-1]=(new Date).getTime());$("#competencyEditId").val(a.join("/"))});$("#competencyAddLevel").click(function(b){b.preventDefault();ModalManager.showModal(new EditLevelModal(a,
function(a){k(a)}))});$("#competencyAddRollupRule").click(function(b){b.preventDefault();ModalManager.showModal(new EditRollupRuleModal(a,function(a){d(a)}))});$("#competencyEditOwnerAdvanced").click(function(b){b.preventDefault();a.setName($("#competencyEditName").val());a.setDescription($("#competencyEditDescription").val());a.scope=$("#competencyEditScope").val();ModalManager.showModal(new AdvancedPermissionsModal(a,function(b){a.owner=b.owner;a.reader=b.reader;l(a);ModalManager.hideModal()}))});
""==a.name?l(a):EcCompetency.get(a.id,function(b){a=b;l(b)},h)};return e}(CompetencyEditScreen);
CompetencySearchScreen=function(e){function l(g){var e=$("#competencySearchText").val();if(null==e||""==e)e="*";null!=h&&clearTimeout(h);var c=$("#competencySearchOwnership").val(),c=1==c?"public":3==c?"owned":4==c?"me":"all",f;f=void 0==g?k:d;h=setTimeout(function(){var a={};if(1<window.location.hash.split("?").length)for(var d=window.location.hash.split(/[?&]/),h=1;h<d.length;h++){var n=d[h].split("\x3d");2==n.length&&(a[n[0]]=n[1])}"*"!=e&&(a.query=e);"all"!=c&&(a.ownership=c);0<Object.keys(a).length?
(ScreenManager.setScreenParameters(a),ScreenManager.getCurrentScreen().setParams(a)):(ScreenManager.setScreenParameters(null),ScreenManager.getCurrentScreen().clearParams());ViewManager.getView("#competencySearchMessageContainer").clearAlert("searchFail");ViewManager.getView("#competencySearchResults").deselectAll();a={};a.ownership=c;a.size=24;a.start=g;EcCompetency.search(AppController.serverController.getRepoInterface(),e,f,b,a)},100)}function k(b){ViewManager.getView("#competencySearchResults").clear();
d(b)}function d(b){ViewManager.getView("#menuContainer").showSortBasic();ViewManager.getView("#competencySearchResults").populate(b);0==b.length&&0==$("#competencyResults-data").first().children().size()?ViewManager.getView("#competencySearchResults").showNoDataMessage():24>b.length?$("#moreSearchResults").addClass("hide"):($("#getMoreResults").click(function(){$("#getMoreResults").addClass("hide");$("#loadingMoreResults").removeClass("hide");l($("#competencyResults-data").first().children().size())}),
$("#getMoreResults").removeClass("hide"),$("#moreSearchResults").removeClass("hide"),$("#loadingMoreResults").addClass("hide"));h=null}function b(b){void 0==b&&(b="Unable to Connect to Server for Competency Search");ViewManager.getView("#competencySearchMessageContainer").displayAlert(b,"searchFail");$("#competencySearchNone").removeClass("hide");$("#competencySearchProgress").addClass("hide")}var h=null;e.prototype.display=function(b){b=this.query;var g=this.ownership;ViewManager.showView(new MessageContainer("competencySearch"),
"#competencySearchMessageContainer");ViewManager.showView(new DataViewer("competencyResults",{sort:{},clickDataEdit:function(b){ScreenManager.changeScreen(new CompetencyEditScreen(b))},moreMenuTools:function(){var b=$("\x3cdiv\x3e\x3c/div\x3e"),f=$("\x3cli\x3e\x3cspan\x3e\x3ci class\x3d'fa fa-sitemap'\x3e\x3c/i\x3e Add to Framework\x3c/span\x3e\x3c/li\x3e");f.click(function(){var a=ViewManager.getView("#competencySearchResults").getSelected();ModalManager.showModal(new AddToFrameworkModal(a))});b.append(f);
f=$("\x3cli\x3e\x3cspan\x3e\x3ci class\x3d'fa fa-download'\x3e\x3c/i\x3e Export\x3c/span\x3e\x3c/li\x3e");f.click(function(){var a=ViewManager.getView("#competencySearchResults").getSelected();ModalManager.showModal(new RepoExportModal(a))});b.append(f);return b.contents()},buildDataRow:function(b,f,a){b.append("\x3cdiv class\x3d'small-8 columns'\x3e\x3ca class\x3d'datum-name'\x3e\x3c/a\x3e\x3cspan class\x3d'datum-description'\x3e\x3c/span\x3e\x3c/div\x3e\x3cdiv class\x3d'small-4 columns datum-owner'\x3e\x3c/div\x3e");
var c;c=void 0!=a.getName?a.getName():void 0!=a.name?a.name:f;b.find(".datum-name").text(c);c=void 0!=a.getDescription&&null!=a.getDescription()&&""!=a.getDescription()?" - "+a.getDescription():void 0!=a.description&&""!=a.description?" - "+a.description:"";b.find(".datum-description").text(c);if(void 0!=a.owner&&0<a.owner.length)for(var g in a.owner){c=EcRemoteLinkedData.trimVersionFromUrl(f);c=c.split("/")[c.split("/").length-1]+"-owner-"+g;var d=$("\x3cspan id\x3d'"+c+"'\x3e\x3c/span\x3e");b.find(".datum-owner").append(d);
ViewManager.showView(new IdentityDisplay(a.owner[g]),"#"+c)}else b.find(".datum-owner").text("Public");b.find("a.datum-name").click(function(b){b.preventDefault();ScreenManager.changeScreen(new CompetencyViewScreen(a))})}}),"#competencySearchResults");$("#competencySearchSubmit").click(function(b){b.preventDefault();l()});$("#competencySearchText").keypress(function(b){13==b.which&&l()});null!=b&&$("#competencySearchText").val(b);AppController.loginController.getLoggedIn()?($("#competencySearchOwnership").attr("max",
4),$("#competencySearchOwnershipLoggedIn").removeClass("hide"),$("#competencySearchOwnershipPublic").addClass("hide")):($("#competencySearchOwnershipLoggedIn").addClass("hide"),$("#competencySearchOwnershipPublic").removeClass("hide"));null!=g&&("public"==g?g=1:"owned"==g?g=3:"me"==g&&(g=4),$("#competencySearchOwnership").val(g));l();ViewManager.getView("#menuContainer").showSortBasic()};e.prototype.onClose=function(){ViewManager.getView("#menuContainer").hideSort()};e.prototype.sortByTimestamp=function(){$("#competencyResults-sortSelect").val("timestamp");
$("#competencyResults-sortSelect").trigger("change")};e.prototype.sortByOwner=function(){$("#competencyResults-sortSelect").val("owner");$("#competencyResults-sortSelect").trigger("change")};e.prototype.filterPublic=function(){$("#competencySearchOwnership").val(1);l()};e.prototype.filterAll=function(){$("#competencySearchOwnership").val(2);l()};e.prototype.filterOwned=function(){$("#competencySearchOwnership").val(3);l()};e.prototype.filterOwnedByMe=function(){AppController.loginController.getLoggedIn()&&
($("#competencySearchOwnership").val(4),l())};e.prototype.setParams=function(b){void 0==b?this.clearParams():(this.query=b.query,this.ownership=b.ownership)};e.prototype.clearParams=function(){this.ownership=this.query=void 0};return e}(CompetencySearchScreen);CompetencyViewScreen.prototype.errorFindingRelations=function(e){void 0==e&&(e="Unable to Connect to Server to Retrieve Relationships");ViewManager.getView("#competencyViewMessageContainer").displayAlert(e,"getRelationships")};
CompetencyViewScreen.prototype.errorFindingRollupRules=function(e){void 0==e&&(e="Unable to Connect to Server to Retrieve Relationships");ViewManager.getView("#competencyViewMessageContainer").displayAlert(e,"getRelationships")};CompetencyViewScreen.prototype.errorFindingLevels=function(e){void 0==e&&(e="Unable to Connect to Server to Retrieve Levels");ViewManager.getView("#competencyViewMessageContainer").displayAlert(e,"getLevels")};
CompetencyViewScreen.prototype.bindControls=function(e){var l=this.data;$("#competencyViewSearchBtn").attr("href","#"+CompetencySearchScreen.prototype.displayName);$("#competencyViewSearchBtn").click(function(e){e.preventDefault();ScreenManager.changeScreen(new CompetencySearchScreen(l))});$("#competencyViewBtn").attr("href","#"+CompetencyViewScreen.prototype.displayName);$("#competencyViewBtn").click(function(e){e.preventDefault()});$(".relationViewLink").off("click");$(".relationViewLink").on("click",
function(){ScreenManager.changeScreen(new RelationshipViewScreen({id:$(this).closest(".relation").attr("id")}))});$("#addToFrameworkBtn").off("click");$("#addToFrameworkBtn").on("click",function(e){e.preventDefault();ModalManager.showModal(new AddToFrameworkModal(l))});AppController.identityController.canEdit(l)?$("#editCompetencyBtn").click(function(e){e.preventDefault();ScreenManager.changeScreen(new CompetencyEditScreen(l))}):$("#editCompetencyBtn").remove();$("#createSourceRelation").off("click");
$("#createSourceRelation").attr("href","#"+RelationshipEditScreen.prototype.getDisplayName()+"?source\x3d"+l.shortId());$("#createSourceRelation").click("click",function(e){e.preventDefault();ScreenManager.changeScreen(new RelationshipEditScreen({source:l.shortId()}));return!1});$("#createTargetRelation").off("click");$("#createTargetRelation").attr("href","#"+RelationshipEditScreen.prototype.getDisplayName()+"?target\x3d"+l.shortId());$("#createTargetRelation").on("click",function(e){e.preventDefault();
ScreenManager.changeScreen(new RelationshipEditScreen({target:l.shortId()}));return!1});$('[ec-container\x3d"competency"]').on("click","a[id]",null,function(e){-1!=this.getAttribute("id").indexOf(".competency/")&&ScreenManager.changeScreen(new CompetencyViewScreen({id:this.getAttribute("id")}))});AppController.identityController.owns(l)||AppController.serverController.getAdmin()?$("#competencyViewDeleteBtn").click(function(){ModalManager.showModal(new ConfirmModal(function(){l._delete(function(){ScreenManager.changeScreen(new CompetencySearchScreen)},
function(e){void 0==e&&(e="Unable to connect to server to delete competenncy");ViewManager.getView("#competencyViewMessageContainer").displayAlert(e)});ModalManager.hideModal()},"Are you sure you want to delete this competency?"))}):$("#competencyViewDeleteBtn").remove();if(void 0!=l.owner&&0<l.owner.length)for($("#competencyViewOwner").text(""),e=0;e<l.owner.length;e++)0<e&&$("#competencyViewOwner").append(", "),$("#competencyViewOwner").append("\x3cspan id\x3d'competency-owner-"+e+"'\x3e\x3c/span\x3e"),
ViewManager.showView(new IdentityDisplay(l.owner[e]),"#competency-owner-"+e);else $("#competencyViewOwner").text("Public")};
var ConfirmModal=function(e){e.prototype.display=function(e){e=this.message;var k=this.confirmCallback;ViewManager.showView(new MessageContainer("confirm"),"#confirmMessageContainer");void 0!=this.header&&$("#confirmHeader").text(this.header);$("#confirmMessage").html(e);$("#confirmBtn").click(function(d){k()});$("#cancelBtn").click(function(d){ModalManager.hideModal()})};e.prototype.displayAlertMessage=function(e){ViewManager.getView("#confirmMessageContainer").displayAlert(e)};return e}(ConfirmModal),
ContactAcceptModal=function(e){e.prototype.display=function(e){var k=this,d=!1,b=this.grant,h=this.onClose;ViewManager.showView(new MessageContainer("contactAccept"),"#contactAcceptMessageContainer",function(){});$("#newContactName").text(b.displayName);$("#addContact").click(function(g){g.preventDefault();g=new EcContact;g.pk=EcPk.fromPem(b.pk);g.source=b.source;g.displayName=b.displayName;EcIdentityManager.addContact(g);EcRepository._delete(b);ModalManager.hideModal()});$("#skipAddContact").click(function(b){b.preventDefault();
ModalManager.hideModal()});$(e).on("closed.zf.reveal",function(){ModalManager.getCurrentModal()==k&!d&&h();d=!0})};return e}(ContactAcceptModal),ContactGrantModal=function(e){e.prototype.display=function(e){var k=this,d=!1,b=this.contact,h=this.token,g=this.signature,p=this.onClose;ViewManager.showView(new MessageContainer("contactGrant"),"#contactGrantMessageContainer",function(){});if(void 0!=EcIdentityManager.ids)for(var c=0;c<EcIdentityManager.ids.length;c++){var f=$("\x3coption\x3e\x3c/option\x3e");
f.attr("value",EcIdentityManager.ids[c].ppk.toPem());f.text(EcIdentityManager.ids[c].displayName);$("#contactGrantIdentity").append(f)}$("#sendContactGrant").click(function(a){a.preventDefault();a=$("#contactGrantDisplayName").val();if(void 0==a||""==a)ViewManager.getView("#contactGrantMessageContainer").displayAlert("Cannot Share Information without a Display Name");else{var c=$("#contactGrantIdentity").val();if(void 0==c||""==c)ViewManager.getView("#contactGrantMessageContainer").displayAlert("Cannot Share Information without an Identity Selected");
else{var f=new EcContactGrant;f.addOwner(b.pk);f.addOwner(EcPpk.fromPem(c).toPk());f.generateId(b.source);f.source=AppController.serverController.selectedServerUrl;f.displayName=a;f.pk=EcPpk.fromPem(c).toPk().toPem();f.responseToken=h;f.responseSignature=g;f.signWith(EcPpk.fromPem(c));a=EcEncryptedValue.toEncryptedValue(f,!1);EcRepository.save(a,function(){ModalManager.hideModal()},function(){})}}});$("#skipContactGrant").click(function(a){a.preventDefault();ModalManager.hideModal()});$(e).on("closed.zf.reveal",
function(){ModalManager.getCurrentModal()==k&!d&&p();d=!0})};return e}(ContactGrantModal),CopyResourceModal=function(e){function l(d,b){if(d instanceof Array)for(var h=0,g=0;g<d.length;g++){var e=new EcRemoteLinkedData;e.copyFrom(d[g]);e.generateId(AppController.serverController.selectedServerUrl);EcRepository.save(e,function(){h++;h==d.length&&(ModalManager.hideModal(),b())},function(){ViewManager.getView("#copyResourceMessageContainer").displayAlert("Failed to Save Copied Resource: "+e.name)})}else e=
new EcRemoteLinkedData,e.copyFrom(d),e.generateId(AppController.serverController.selectedServerUrl),void 0!=AppController.identityController.selectedIdentity&&e.addOwner(AppController.identityController.selectedIdentity.ppk.toPk()),EcRepository.save(e,function(){ModalManager.hideModal();b()},function(){ViewManager.getView("#copyResourceMessageContainer").displayAlert("Failed to Save Copied Resource: "+e.name)})}function k(d){var b=d.name;void 0!=d.getName&&(b=d.getName());$("#copyResources").append($("\x3cli\x3e"+
b+"\x3c/li\x3e"))}e.prototype.display=function(d){var b=this.data,h=this.callback;ViewManager.showView(new MessageContainer("copyResource"),"#copyResourceMessageContainer");if(b instanceof Array)for(d=0;d<b.length;d++)k(b[d]);else k(b);$("#submitCopyResources").click(function(){l(b,h)});$("#cancelCopyResources").click(function(){ModalManager.hideModal()});void 0!=AppController.identityController.selectedIdentity?(d=$(createContactSmall(AppController.identityController.selectedIdentity.ppk.toPk().toPem())),
$("#copyOwner").append(d)):$("#copyOwner").text("Public")};return e}(CopyResourceModal),CreateIdentityModal=function(e){function l(e){ViewManager.getView("#createIdentityMessageContainer").clearAlert("createFail");$("#createButton").prop("disabled",!0);$("#createIdentitySpinner").removeClass("hide");var d=$("#createIdentityName").val();AppController.identityController.generateIdentity(function(b){void 0!=ScreenManager.getCurrentScreen().refreshIdentities&&ScreenManager.getCurrentScreen().refreshIdentitie(EcIdentityManager.ids);
download(b.displayName+".pem",b.ppk.toPem());AppController.loginController.save(function(){$("#createButton").removeAttr("disabled");$("#createIdentitySpinner").addClass("hide");ModalManager.hideModal();void 0!=e&&e()},function(b){$("#createButton").removeAttr("disabled");$("#createIdentitySpinner").addClass("hide")})},d)}e.prototype.display=function(e){var d=this.success;ViewManager.showView(new MessageContainer("createIdentity"),"#createIdentityMessageContainer");$("#createForm").submit(function(b){b.preventDefault();
l(d)})};return e}(CreateIdentityModal),CreateUserModal=function(e){function l(){ViewManager.getView("#createMessageContainer").clearAlert("createFail");var e=$("#createServer").val();AppController.serverController.selectServer(e,function(){AppController.loginController.create($("#createUsername").val(),$("#createPassword").val(),e,function(){ModalManager.hideModal();ViewManager.getView(AppController.topBarContainerId).setLoggedIn();ScreenManager.changeScreen(new UserIdentityScreen);AppController.serverController.selectServer($("#createServer").val())},
function(d){void 0==d&&(d="Unable to Connect to Server to Create User");ViewManager.getView("#createMessageContainer").displayAlert(d,"createFail")})})}e.prototype.display=function(k){ViewManager.showView(new MessageContainer("createUser"),"#createMessageContainer");0<$(AppController.serverController.serverList).size()&&$("#createServer").html("");for(var d in AppController.serverController.serverList){k=AppController.serverController.serverList[d];var b=$("\x3coption\x3e\x3c/option\x3e");b.attr("value",
k);b.text(d);d==AppController.serverController.selectedServerName&&b.attr("selected","selected");$("#createServer").append(b)}$("#createAddServer").click(function(){ModalManager.showModal(new AddServerModal(function(){ModalManager.showModal(new e)}))});$("#createForm").submit(function(b){b.preventDefault();l()})};return e}(CreateUserModal),DataViewer=function(e){function l(a,b,c){if(void 0!=b){var f;if(b instanceof Array)f=b;else if(b instanceof Object){f=[];for(var g in b)f.push(b[g])}else return;
a=$("#"+a+"-sortSelect").val();b=void 0==c||void 0==c.sort||void 0==c.sort[a];"type"==a?f.sort(function(a,b){return a.type>b.type?1:b.type>a.type?-1:0}):"owner"==a||AppController.loginController.getLoggedIn()&&b?f.sort(function(a,b){return AppController.identityController.owns(a)?AppController.identityController.owns(b)?0:-1:AppController.identityController.owns(b)?1:void 0==a.owner||0==a.owner.length?-1:void 0==b.owner||0==b.owner.length?1:a.owner[0]>b.owner[0]?1:b.owner[0]>a.owner[0]?-1:0}):"timestamp"==
a||!AppController.loginController.getLoggedIn()&&b?f.sort(function(a,b){a=a.id.split("/");a=a[a.length-1];b=b.id.split("/");b=b[b.length-1];return a>b?-1:1}):void 0!=c&&void 0!=c.sort&&f.sort(c.sort[a]);return f}}function k(a,b,c,f){$("#"+a+"-sortSelect").html("");$("#"+a+"-sortSelect").off("change");var g={};if(1<window.location.hash.split("?").length){b=window.location.hash.split(/[?&]/);for(var e=1;e<b.length;e++){var h=b[e].split("\x3d");2==h.length&&(g[h[0]]=h[1])}}b=$("\x3coption value\x3d'timestamp'\x3eSort by Timestamp\x3c/option\x3e");
void 0!=g.sort||AppController.loginController.getLoggedIn()||b.attr("selected","selected");$("#"+a+"-sortSelect").append(b);b=$("\x3coption value\x3d'owner'\x3eSort by Owner\x3c/option\x3e");("owner"==g.sort||void 0==g.sort&&AppController.loginController.getLoggedIn())&&b.attr("selected","selected");$("#"+a+"-sortSelect").append(b);if(void 0!=f&&void 0!=f.sort&&f.sort instanceof Object)for(var n in f.sort)b=$("\x3coption value\x3d'"+n+"'\x3eSort by "+n+"\x3c/option\x3e"),void 0==g.sort&&f.sort[n]()&&
b.attr("selected","selected"),g.sort==n&&b.attr("selected","selected"),$("#"+a+"-sortSelect").append(b);else b=$("\x3coption value\x3d'type'\x3eSort by Type\x3c/option\x3e"),"type"==g.sort&&b.attr("selected","selected"),$("#"+a+"-sortSelect").append(b);$("#"+a+"-sortSelect").removeClass("hide");$("#"+a+"-sortSelect").on("change",function(){g.sort=$("#"+a+"-sortSelect").val();var b=!1;if(void 0!=f.sort)for(var e in f.sort)f.sort[e]()&&(b=!0,g.sort==e&&delete g.sort);b||("timestamp"!=g.sort||AppController.loginController.getLoggedIn()?
"owner"==g.sort&&AppController.loginController.getLoggedIn()&&delete g.sort:delete g.sort);ScreenManager.setScreenParameters(g);$("#"+a+"-data").find(".row").remove();d(c.dataStore,c,a,f)})}function d(c,g,d,e){if(void 0==c)f(d);else{$(".toggleSelectData").removeClass("hide");$(".toggleSelectData").text("Select All");void 0==g.dataStore&&(g.dataStore={});$("#"+d+"-none").addClass("hide");$("#"+d+"-progress").addClass("hide");$("#"+d+"-menu").removeClass("hide");$("#"+d+"-data").removeClass("hide");
k(d,c,g,e);c=l(d,c,e);if(c instanceof Array){if(0==c.length){f(d);return}if(0==$("#"+d+"-data .row").size())for(var h in g.dataStore)delete g.dataStore[h];for(var n in c){var m;m=void 0!=c[n].id?c[n].id:n;void 0==g.dataStore[m]&&b(c[n].id,c[n],d,e,g);g.dataStore[m]=c[n]}}else if(c instanceof Object){if(0==Object.keys(c).length){f(d);return}if(0==$("#"+d+"-data .row").size())for(h in g.dataStore)delete g.dataStore[h];for(h in c)g.dataStore[h]=c[h];for(m in c)b(m,c[n],d,e,g)}a(d);void 0!=e&&e.afterPopulate&&
e.afterPopulate()}}function b(a,b,c,f,d){var e;if(0==$(".row[data-id\x3d'"+a+"']").size()){e=$("\x3cdiv class\x3d'row column' style\x3d'padding:7px 2px;padding-left:40px;'\x3e\x3c/div\x3e");e.attr("data-id",a);e.attr("title",a);var h=$("\x3cinput type\x3d'checkbox' class\x3d'datum-select'\x3e\x3c/input\x3e)");e.append(h);void 0!=b.isAny&&(b.isAny((new EcEncryptedValue).getTypes())?(h=$("\x3ci class\x3d'fa fa-lock fake-a' style\x3d'position: absolute;top: 33%;left: 37px;color: #2A3A2B;'\x3e\x3c/i\x3e"),
e.append(h)):1==EcEncryptedValue.encryptOnSave(b.id)&&(h=$("\x3ci class\x3d'fa fa-unlock-alt fake-a' style\x3d'position: absolute;top: 33%;left: 37px;color: #2A3A2B;'\x3e\x3c/i\x3e"),e.append(h)));e.on("click",".datum-select",function(g){void 0!=f&&void 0!=f.clickDataSelect&&f.clickDataSelect(g,a,b,c);$(".dataView").find(".datum-select:checked").size()==$("#"+c+"-data .row").size()?$(".toggleSelectData").text("Unselect All"):$(".toggleSelectData").text("Select All");if($(g.target).is(":checked"))$(g.target).closest(".row").addClass("selected"),
AppController.identityController.owns(b)||($("#"+c+"-menu").find(".fa-group").addClass("hide"),AppController.serverController.getAdmin()||$("#"+c+"-menu").find(".fa-trash").addClass("hide"));else{$(g.target).closest(".row").removeClass("selected");var e=[];$("#"+c+"-data").find(".row.selected").each(function(a,b){e.push(d.dataStore[$(b).attr("data-id")])});if(!AppController.identityController.owns(b)){var h=!0,n;for(n in e)AppController.identityController.owns(e[n])||(h=!1);h&&($("#"+c+"-menu").find(".fa-group").removeClass("hide"),
$("#"+c+"-menu").find(".fa-trash").removeClass("hide"))}}$(g.target).closest(".dataView").find(".datum-select").is(":checked")?($(g.target).closest(".dataView").addClass("selecting"),$("#"+c+"-menu").is(":visible")||$("#"+c+"-menu").slideDown(),$(".dataViewMenu .dataViewSelected").text($(".dataView").find("[data-id] .datum-select:checked").size())):($(g.target).closest(".dataView").removeClass("selecting"),$("#"+c+"-menu").is(":visible")&&$("#"+c+"-menu").slideUp())});void 0!=f&&void 0!=f.aggregateDataRows?
f.aggregateDataRows(e,a,b):$("#"+c+"-data").append(e);void 0!=f&&void 0!=f.buildDataRow?(h=f.buildDataRow(e,a,b),h=$(h),e.append(h)):h=p(e,a,b,f);h=$("\x3cdiv class\x3d'rowToolbar'\x3e\x3c/div\x3e");void 0!=f&&void 0!=f.buildRowToolbar?h.append(f.buildRowToolbar(a,b)):h.append(g(a,b,f));e.append(h)}}function h(a,b,c){void 0!=c&&void 0!=c.clickDataDelete?c.clickDataDelete(b):ModalManager.showModal(new ConfirmModal(function(){EcRepository._delete(b,function(){ModalManager.hideModal();var b=a.closest(".row"),
c=b.siblings(".row");b.remove();0==c.size()&&(f(prefix),$(".toggleSelectData").addClass("hide"))},function(a){ModalManager.getCurrentModal().displayAlertMessage(a)})},"Are you sure you want to delete \x3cem\x3e"+(void 0!=b.name?b.name:b.id)+"\x3c/em\x3e?"))}function g(a,b,c){NaN;var f=$("\x3cdiv style\x3d'padding-top:5px;'\x3e\x3ci class\x3d'fa fa-trash dataViewBtn' title\x3d'Delete' style\x3d'margin-right:1rem;'\x3e\x3c/i\x3e\x3ci class\x3d'fa fa-group dataViewBtn' title\x3d'Manage Permissions' style\x3d'margin-right:1rem;'\x3e\x3c/i\x3e\x3ci class\x3d'fa fa-clone dataViewBtn' title\x3d'Copy Resource' style\x3d'margin-right:1rem;'\x3e\x3c/i\x3e\x3ci class\x3d'fa fa-pencil dataViewBtn' title\x3d'Edit Resource' style\x3d'margin-right:1rem;'\x3e\x3c/i\x3e");
if(void 0!=c&&c.moreRowTools){a=$("\x3ci class\x3d'fa fa-ellipsis-v dataViewBtn' title\x3d'Additional Actions' style\x3d'margin-right:1rem;'\x3e\x3c/i\x3e");var g=$("\x3cul class\x3d'contextMenu' style\x3d'list-style:none;margin:0px;'\x3e\x3c/ul\x3e"),d=c.moreRowTools(b);void 0!=d&&""!=d&&0<$(d).size()&&(f.append(a),f.find(".fa-ellipsis-v").click(function(a){a.preventDefault();g.append(d);g.css("left",a.clientX);g.css("top",a.clientY);$("body").append(g)}))}AppController.identityController.owns(b)?
(f.find(".fa-group").click(function(){ModalManager.showModal(new AdvancedPermissionsModal(b,function(a){EcRepository.save(a,function(){ModalManager.hideModal();ScreenManager.reloadCurrentScreen()},function(){ViewManager.getView("#advancedPermissionsMessageContainer").displayAlert("Error Saving Changed Permissions")})}))}),f.find(".fa-trash").click(function(){h(f,b,c)})):(f.find(".fa-group").remove(),AppController.serverController.getAdmin()?f.find(".fa-trash").click(function(){h(f,b,c)}):f.find(".fa-trash").remove());
AppController.identityController.canEdit(b)?f.find(".fa-pencil").click(function(a){a.preventDefault();void 0!=c&&void 0!=c.clickDataEdit?c.clickDataEdit(b):ScreenManager.changeScreen(new RepoViewScreen(b))}):f.find(".fa-pencil").remove();f.find(".fa-clone").click(function(a){a.preventDefault();ModalManager.showModal(new CopyResourceModal(b,function(){ScreenManager.reloadCurrentScreen()}))});return f}function p(a,b,c,f){a.append("\x3cdiv class\x3d'small-6 columns'\x3e\x3ca class\x3d'datum-name'\x3e\x3c/a\x3e\x3cspan class\x3d'datum-description'\x3e\x3c/span\x3e\x3c/div\x3e\x3cdiv class\x3d'small-2 columns datum-type'\x3e\x3c/div\x3e\x3cdiv class\x3d'small-4 columns datum-owner'\x3e\x3c/div\x3e");
var g;Array.isArray(c.name)||(c.name instanceof Object&&void 0!=c.name["@value"]&&""!=c.name["@value"]?g=c.name["@value"]:void 0!=c.name&&""!=c.name?g=c.name:(g=b,a.find(".datum-name").css("font-size","0.8rem")));a.find(".datum-name").text(g);var d;Array.isArray(c.description)||(d=c.description instanceof Object&&void 0!=c.description["@value"]&&""!=c.description["@value"]?" - "+c.description["@value"]:void 0!=c.description&&""!=c.description?" - "+c.description:"");a.find(".datum-description").text(d);
void 0!=c.type&&(g=c.type.split("/"),a.find(".datum-type").text(g[g.length-1]));if(void 0!=c.owner&&0<c.owner.length)for(var e in c.owner)g=EcRemoteLinkedData.trimVersionFromUrl(b),g=g.split("/")[g.split("/").length-1]+"-owner-"+e,d=$("\x3cspan id\x3d'"+g+"'\x3e\x3c/span\x3e"),a.find(".datum-owner").append(d),ViewManager.showView(new IdentityDisplay(c.owner[e]),"#"+g);else a.find(".datum-owner").text("Public");a.find("a.datum-name").click(function(a){a.preventDefault();void 0!=f&&void 0!=f.clickName?
f.clickName(b,c):ScreenManager.changeScreen(new RepoViewScreen(c))})}function c(b,c,g){var d=$("\x3cdiv class\x3d'row column' style\x3d'position:relative;padding:7px 2px; font-weight:500; background-color: lightgrey;'\x3e\x3cdiv class\x3d'small-3 columns'\x3e\x3cspan class\x3d'deselectData dataViewBtn'\x3e \x3ci class\x3d'fa fa-undo'\x3e\x3c/i\x3e Unselect All\x3c/span\x3e\x3c/div\x3e\x3cdiv class\x3d'small-5 columns' style\x3d'text-align:center'\x3e\x3cspan class\x3d'dataViewSelected'\x3e\x3c/span\x3e selected\x3c/div\x3e\x3cdiv class\x3d'small-3 columns' style\x3d'text-align:right;padding-top:3px;'\x3e\x3ci class\x3d'fa fa-trash dataViewBtn' title\x3d'Delete' style\x3d'margin-right:1rem;'\x3e\x3c/i\x3e\x3ci class\x3d'fa fa-group dataViewBtn' title\x3d'Manage Permissions' style\x3d'margin-right:1rem;'\x3e\x3c/i\x3e\x3ci class\x3d'fa fa-clone dataViewBtn' title\x3d'Copy Resource' style\x3d'margin-right:1rem;'\x3e\x3c/i\x3e\x3cul id\x3d'moreMenuBtns' class\x3d'dropdown menu align-right hide' style\x3d'display:inline-block;vertical-align:middle;text-align:left;' data-dropdown-menu data-disable-hover\x3d'true' data-click-open\x3d'true' data-close-on-click\x3d'true'\x3e\x3cli id\x3d'moreMenuContainer'\x3e\x3cspan class\x3d'dataViewBtn' style\x3d'padding:0px 5px; display:inline-block;'\x3e\x3ci class\x3d'fa fa-ellipsis-v'\x3e\x3c/i\x3e\x3c/span\x3e\x3c/li\x3e\x3c/ul\x3e\x3c/div\x3e\x3c/div\x3e");
d.find(".deselectData").click(function(c){a(b);$(".toggleSelectData").text("Select All")});d.find(".fa-clone").click(function(){var a=[];$("#"+b+"-data").find(".row.selected").each(function(b,f){a.push(c.dataStore[$(f).attr("data-id")])});ModalManager.showModal(new CopyResourceModal(a,function(){ScreenManager.reloadCurrentScreen()}))});d.find(".fa-trash").click(function(){var a=[];$("#"+b+"-data").find(".row.selected").each(function(b,f){a.push(c.dataStore[$(f).attr("data-id")])});void 0!=g&&void 0!=
g.clickMenuDelete?g.clickMenuDelete(a):ModalManager.showModal(new ConfirmModal(function(){var c=0,g=function(g,d){EcRepository._delete(d,function(){$("#"+b+"-data").find(".row[data-id\x3d'"+g+"']").remove();0==$("#"+b+"-data").find(".row").size()&&(f(b),$(".toggleSelectData").addClass("hide"));c++;c==a.length&&(ModalManager.hideModal(),$("#"+b+"-menu").is(":visible")&&$("#"+b+"-menu").slideUp())},function(a){ModalManager.getCurrentModal().displayAlertMessage(a)})},d;for(d in a)g(a[d].id,a[d])},"Are you sure you want to delete the selected resources?"))});
d.find(".fa-group").click(function(){var a=[];$("#"+b+"-data").find(".row.selected").each(function(b,f){a.push(c.dataStore[$(f).attr("data-id")])});1==a.length&&(a=a[0]);void 0!=g&&void 0!=g.clickMenuPermissions?g.clickMenuPermissions(a):ModalManager.showModal(new AdvancedPermissionsModal(a,function(a){a instanceof Array||(a=[a]);if(void 0!=g&&void 0!=g.permissionsChanged)g.permissionsChanged(a);else{var b=0,c;for(c in a)EcRepository.save(a[c],function(){b++;b==a.length&&(ModalManager.hideModal(),
ScreenManager.reloadCurrentScreen())},function(){ViewManager.getView("#advancedPermissionsMessageContainer").displayAlert("Error Saving Changed Permissions")})}}))});if(void 0!=g&&g.moreMenuTools){var e=$("\x3cul class\x3d'menu contextMenu'\x3e\x3c/ul\x3e");d.find("#moreMenuContainer").append(e);var h=g.moreMenuTools(b);void 0!=h&&""!=h&&0<$(h).size()&&(d.find("#moreMenuBtns").removeClass("hide"),e.append(h))}return d}function f(a){$("#"+a+"-none").removeClass("hide");$("#"+a+"-progress").addClass("hide");
$("#"+a+"-menu").addClass("hide");$("#"+a+"-data").addClass("hide");$(".selectData").addClass("hide")}function a(a){$(".dataView").find(".row").removeClass("selected");$(".dataView").removeClass("selecting");$(".dataView .datum-select").attr("checked",!1);$("#"+a+"-menu").is(":visible")&&$("#"+a+"-menu").slideUp()}function m(a,b){var c=[];$("#"+a+"-data").find(".row.selected").each(function(a,f){void 0!=b.dataStore[$(f).attr("data-id")]&&c.push(b.dataStore[$(f).attr("data-id")])});return c}e.prototype.display=
function(b){var f=this.prefix,g=this.callbacks,d=this;$(b).find("[id]").each(function(a,b){$(b).attr("id",f+"-"+$(b).attr("id"))});var e;e=void 0!=g&&void 0!=g.buildMenu?g.buildMenu():c(f,d,g);$("#"+f+"-menu").append(e);$("#"+f+"-menu").foundation();$(".toggleSelectData").click(function(){if($(".dataView").find(".datum-select:checked").size()==$("#"+f+"-data .row").size())a(f),$(".toggleSelectData").text("Select All");else{$(".dataView").find(".row").addClass("selected");$(".dataView").addClass("selecting");
$(".dataView .datum-select").prop("checked",!0);$(".dataViewMenu .dataViewSelected").text($(".dataView").find("[data-id] .datum-select:checked").size());$("#"+f+"-menu").is(":visible")||void 0==e||$("#"+f+"-menu").slideDown();$(".toggleSelectData").text("Unselect All");var b=!0,c=m(f,d),g;for(g in c)AppController.identityController.owns(c[g])||(b=!1,$("#"+f+"-menu").find(".fa-group").addClass("hide"),$("#"+f+"-menu").find(".fa-trash").addClass("hide"));b&&($("#"+f+"-menu").find(".fa-group").removeClass("hide"),
$("#"+f+"-menu").find(".fa-trash").removeClass("hide"));AppController.serverController.getAdmin()&&$("#"+f+"-menu").find(".fa-trash").removeClass("hide")}})};e.prototype.clear=function(){$("#"+this.prefix+"-data").find(".row").remove();this.dataStore={}};e.prototype.populate=function(a){var b;a instanceof Object?b=Object.keys(a).length:a instanceof Array&&(b=a.length);0<b?d(a,this,this.prefix,this.callbacks):0==$("#"+this.prefix+"-data").find(".row").size()&&f(this.prefix)};e.prototype.showNoDataMessage=
function(){f(this.prefix)};e.prototype.showProgressMessage=function(){$("#"+this.prefix+"-progress").removeClass("hide")};e.prototype.deselectAll=function(){a(this.prefix)};e.prototype.getSelected=function(){return m(this.prefix,this)};return e}(DataViewer),EditLevelModal=function(e){function l(d){void 0==d&&(d="Unable to Connect to Server to Save Level");ViewManager.getView("#editLevelError").displayAlert(d)}function k(d){void 0==d&&(d="Unable to Connect to Server to Delete Level");ViewManager.getView("#editLevelError").displayAlert(d)}
e.prototype.display=function(d){var b=this.data,h=this.closeCallback;ViewManager.showView(new MessageContainer("editLevel"),"#editLevelError",function(){void 0==AppController.identityController.selectedIdentity&&b.isAny((new EcCompetency).getTypes())&&ViewManager.getView("#editLevelError").displayWarning("You are Creating a Public Level, this level can be modified by anyone")});$("#editLevelCancel").click(function(b){b.preventDefault();ModalManager.hideModal()});if(b.isAny((new EcCompetency).getTypes()))void 0!=
AppController.identityController.selectedIdentity&&($("#editLevelOwnership").text(""),d=AppController.identityController.selectedIdentity.ppk.toPk().toPem(),ViewManager.showView(new IdentityDisplay(d),"#editLevelOwnership"),$("#editLevelAdvancedOwnership").removeClass("hide"),$("#editLevelAdvancedOwnership").click(function(c){c=new EcLevel;c.name=$("#editLevelName").val();c.title=$("#editLevelTitle").val();c.description=$("#editLevelDescription").val();c.performance=$("#editLevelPerformance").val();
for(var f=$("#editLevelOwnership").children("span").map(function(a,b){return $(b).find(".contactText").attr("title")}),a=0;a<f.length;a++)c.addOwner(EcPk.fromPem(f[a]));if(!$("#editLevelVisibilityRow").hasClass("hide"))for(EcEncryptedValue.encryptOnSave(c.id,!0),f=$("#editLevelReaders").children().map(function(a,b){return $(b).find(".contactText").attr("title")}),a=0;a<f.length;a++)c.addReader(EcPk.fromPem(f[a]));ModalManager.showModal(new AdvancedPermissionsModal(c,function(a){ModalManager.showModal(new e(b,
h),function(){$("#editLevelName").val(a.name);$("#editLevelTitle").val(a.title);$("#editLevelDescription").val(a.description);$("#editLevelPerformance").val(a.performance);if(void 0!=a.owner&&0<a.owner.length){$("#editLevelOwnership").text("");for(var b=0;b<a.owner.length;b++){0<b&&$("#editLevelOwnership").append(", ");var c=a.owner[b];$("#editLevelOwnership").append("\x3cspan id\x3d'level-owner-"+b+"'\x3e\x3c/span\x3e");ViewManager.showView(new IdentityDisplay(c),"#level-owner-"+b)}}else $("#editLevelOwnership").text("Public");
if(EcEncryptedValue.encryptOnSave(a.id))if($("#editLevelVisibilityRow").removeClass("hide"),$("#editLevelReadersRow").removeClass("hide"),void 0!=a.reader&&0<a.reader.length)for($("#editLevelReaders").text(""),$("#editLevelReaders").css("font-style","normal"),b=0;b<a.reader.length;b++)0<b&&$("#editLevelReaders").append(", "),c=a.reader[b],$("#editLevelReaders").append("\x3cspan id\x3d'level-reader-"+b+"'\x3e\x3c/span\x3e"),ViewManager.showView(new IdentityDisplay(c),"#level-reader-"+b);else $("#editLevelReaders").text("None Added Yet");
else $("#editLevelVisibilityRow").addClass("hide"),$("#editLevelReadersRow").addClass("hide")})}))})),$("#editLevelDelete").remove(),$("#editLevelSubmit").click(function(c){c.preventDefault();var f=new EcLevel;void 0!=AppController.identityController.selectedIdentity&&f.addOwner(AppController.identityController.selectedIdentity.ppk.toPk());f.generateId(AppController.serverController.selectedServerUrl);f.name=$("#editLevelName").val();f.title=$("#editLevelTitle").val();f.description=$("#editLevelDescription").val();
f.performance=$("#editLevelPerformance").val();f.competency=b.shortId();var a=$("#editLevelOwnership").children("span").map(function(a,b){return $(b).find(".contactText").attr("title")});for(c=0;c<a.length;c++)f.addOwner(EcPk.fromPem(a[c]));if(!$("#editLevelVisibilityRow").hasClass("hide"))for(EcEncryptedValue.encryptOnSave(f.id,!0),a=$("#editLevelReaders").children().map(function(a,b){return $(b).find(".contactText").attr("title")}),c=0;c<a.length;c++)f.addReader(EcPk.fromPem(a[c]));void 0==f.name||
""==f.name?ViewManager.getView("#editLevelError").displayAlert("Level Requires a Name to be Saved"):f.save(function(){void 0!=h&&h(f);ModalManager.hideModal()},l)});else if(b.isAny((new EcLevel).getTypes())){$("#editLevelDelete").removeClass("hide");$("#editLevelSubmit").text("Save");$("#editLevelName").val(b.name);$("#editLevelTitle").val(b.title);$("#editLevelDescription").val(b.description);$("#editLevelPerformance").val(b.performance);if(EcEncryptedValue.encryptOnSave(b.id))if($("#editLevelVisibilityRow").removeClass("hide"),
$("#editLevelReadersRow").removeClass("hide"),void 0!=b.reader&&0<b.reader.length){$("#editLevelReaders").text("");$("#editLevelReaders").css("font-style","normal");for(var g=0;g<b.reader.length;g++)0<g&&$("#editLevelReaders").append(", "),d=b.reader[g],$("#editLevelReaders").append("\x3cspan id\x3d'level-reader-"+g+"'\x3e\x3c/span\x3e"),ViewManager.showView(new IdentityDisplay(d),"#level-reader-"+g)}else $("#editLevelReaders").text("None Added Yet");if(void 0!=b.owner&&0<b.owner.length)for($("#editLevelOwnership").text(""),
g=0;g<b.owner.length;g++)0<g&&$("#editLevelOwnership").append(", "),d=b.owner[g],$("#editLevelOwnership").append("\x3cspan id\x3d'level-owner-"+g+"'\x3e\x3c/span\x3e"),ViewManager.showView(new IdentityDisplay(d),"#level-owner-"+g);d=!1;for(var p in EcIdentityManager.ids)g=EcIdentityManager.ids[p].ppk.toPk(),b.canEdit(g)&&(d=!0);if(void 0==b.owner||0==b.owner.length)d=!0;d?(void 0!=b.owner&&($("#editLevelAdvancedOwnership").removeClass("hide"),$("#editLevelAdvancedOwnership").click(function(c){b.name=
$("#editLevelName").val();b.title=$("#editLevelTitle").val();b.description=$("#editLevelDescription").val();b.performance=$("#editLevelPerformance").val();var f=$("#editLevelOwnership").children("span").map(function(a,b){return $(b).find(".contactText").attr("title")});for(c=0;c<f.length;c++)b.addOwner(EcPk.fromPem(f[c]));if(!$("#editLevelVisibilityRow").hasClass("hide"))for(EcEncryptedValue.encryptOnSave(b.id,!0),f=$("#editLevelReaders").children().map(function(a,b){return $(b).find(".contactText").attr("title")}),
c=0;c<f.length;c++)b.addReader(EcPk.fromPem(f[c]));ModalManager.showModal(new AdvancedPermissionsModal(b,function(a){if(EcEncryptedValue.encryptOnSave(a.id))if($("#editLevelVisibilityRow").removeClass("hide"),$("#editLevelReadersRow").removeClass("hide"),void 0!=a.reader&&0<a.reader.length){$("#editLevelReaders").text("");$("#editLevelReaders").css("font-style","normal");for(var b=0;b<a.reader.length;b++){0<b&&$("#editLevelReaders").append(", ");var c=a.reader[b];$("#editLevelReaders").append("\x3cspan id\x3d'level-reader-"+
b+"'\x3e\x3c/span\x3e");ViewManager.showView(new IdentityDisplay(c),"#level-reader-"+b)}}else $("#editLevelReaders").text("None Added Yet");else $("#editLevelVisibilityRow").addClass("hide"),$("#editLevelReadersRow").addClass("hide");ModalManager.showModal(new e(a,h))}))})),$("#editLevelModalTitle").text("Edit Level"),$("#editLevelSubmit").click(function(c){c.preventDefault();b.name=$("#editLevelName").val();b.title=$("#editLevelTitle").val();b.description=$("#editLevelDescription").val();b.performance=
$("#editLevelPerformance").val();var f=$("#editLevelOwnership").children("span").map(function(a,b){return $(b).find(".contactText").attr("title")});for(c=0;c<f.length;c++)b.addOwner(EcPk.fromPem(f[c]));if(!$("#editLevelVisibilityRow").hasClass("hide"))for(EcEncryptedValue.encryptOnSave(b.id,!0),f=$("#editLevelReaders").children().map(function(a,b){return $(b).find(".contactText").attr("title")}),c=0;c<f.length;c++)b.addReader(EcPk.fromPem(f[c]));void 0==b.name||""==b.name?ViewManager.getView("#editLevelError").displayAlert("Level Requires a Name to be Saved"):
(c=b.id.split("/"),"data"==c[c.length-4]&&(c[c.length-1]=(new Date).getTime()),b.id=c.join("/"),b.save(function(a){void 0!=h&&h(b);ModalManager.hideModal()},l))}),$("#editLevelDelete").click(function(c){c.preventDefault();EcRepository._delete(b,function(){void 0!=h&&h(null);ModalManager.hideModal()},k)})):($("#editLevelModalTitle").text("View Level"),$("#editLevelDelete").remove(),$("#editLevelSubmit").remove(),$("#editLevelCancel").remove(),$("#editLevelName").attr("disabled","disabled"),$("#editLevelTitle").attr("disabled",
"disabled"),$("#editLevelDescription").attr("disabled","disabled"),$("#editLevelPerformance").attr("disabled","disabled"))}else ViewManager.getView("#editLevelError").displayAlert("Unrecognized Context For Level Modal"),$("#editLevelName").attr("disabled","disabled"),$("#editLevelTitle").attr("disabled","disabled"),$("#editLevelDescription").attr("disabled","disabled"),$("#editLevelPerformance").attr("disabled","disabled"),$("#editLevelSubmit").click(function(b){b.preventDefault()})};return e}(EditLevelModal),
EditRollupRuleModal=function(e){function l(d){void 0==d&&(d="Unable to Connect to Server to Save RollupRule");ViewManager.getView("#editRollupRuleError").displayAlert(d)}function k(d){void 0==d&&(d="Unable to Connect to Server to Delete RollupRule");ViewManager.getView("#editRollupRuleError").displayAlert(d)}e.prototype.display=function(d){var b=this.data,h=this.closeCallback;ViewManager.showView(new MessageContainer("editRollupRule"),"#editRollupRuleError",function(){void 0==AppController.identityController.selectedIdentity&&
b.isAny((new EcCompetency).getTypes())&&ViewManager.getView("#editRollupRuleError").displayWarning("You are Creating a Public Rollup Rule, this rule can be modified by anyone")});$("#editRollupRuleCancel").click(function(b){b.preventDefault();ModalManager.hideModal()});if(b.isAny((new EcCompetency).getTypes()))void 0!=AppController.identityController.selectedIdentity&&($("#editRollupRuleOwnership").text(""),d=AppController.identityController.selectedIdentity.ppk.toPk().toPem(),$("#editRollupRuleOwnership").append("\x3cspan id\x3d'rule-owner-"+
g+"'\x3e\x3c/span\x3e"),ViewManager.showView(new IdentityDisplay(d),"#rule-owner-"+g),$("#editRollupRuleAdvancedOwnership").removeClass("hide"),$("#editRollupRuleAdvancedOwnership").click(function(c){c=new EcRollupRule;c.name=$("#editRollupRuleName").val();c.rule=$("#editRollupRuleRule").val();c.description=$("#editRollupRuleDescription").val();c.outcome=$("#editRollupRuleOutcome").val();for(var f=$("#editRollupRuleOwnership").children("span").map(function(a,b){return $(b).find(".contactText").attr("title")}),
a=0;a<f.length;a++)c.addOwner(EcPk.fromPem(f[a]));if(!$("#editRollupRuleVisibilityRow").hasClass("hide"))for(EcEncryptedValue.encryptOnSave(c.id,!0),f=$("#editRollupRuleReaders").children().map(function(a,b){return $(b).find(".contactText").attr("title")}),a=0;a<f.length;a++)c.addReader(EcPk.fromPem(f[a]));ModalManager.showModal(new AdvancedPermissionsModal(c,function(a){ModalManager.showModal(new e(b,h),function(){$("#editRollupRuleName").val(a.name);$("#editRollupRuleRule").val(a.rule);$("#editRollupRuleDescription").val(a.description);
$("#editRollupRuleOutcome").val(a.outcome);if(void 0!=a.owner&&0<a.owner.length){$("#editRollupRuleOwnership").text("");for(var b=0;b<a.owner.length;b++){0<b&&$("#editRollupRuleOwnership").append(", ");var c=a.owner[b];$("#editRollupRuleOwnership").append("\x3cspan id\x3d'rule-owner-"+b+"'\x3e\x3c/span\x3e");ViewManager.showView(new IdentityDisplay(c),"#rule-owner-"+b)}}else $("#editRollupRuleOwnership").text("Public");if(EcEncryptedValue.encryptOnSave(a.id))if($("#editRollupRuleVisibilityRow").removeClass("hide"),
$("#editRollupRuleReadersRow").removeClass("hide"),void 0!=a.reader&&0<a.reader.length)for($("#editRollupRuleReaders").text(""),$("#editRollupRuleReaders").css("font-style","normal"),b=0;b<a.reader.length;b++)0<b&&$("#editRollupRuleReaders").append(", "),c=a.reader[b],$("#editRollupRuleReaders").append("\x3cspan id\x3d'rule-reader-"+b+"'\x3e\x3c/span\x3e"),ViewManager.showView(new IdentityDisplay(c),"#rule-reader-"+b);else $("#editRollupRuleReaders").text("None Added Yet");else $("#editRollupRuleVisibilityRow").addClass("hide"),
$("#editRollupRuleReadersRow").addClass("hide")})}))})),$("#editRollupRuleDelete").remove(),$("#editRollupRuleSubmit").click(function(c){c.preventDefault();var f=new EcRollupRule;void 0!=AppController.identityController.selectedIdentity&&f.addOwner(AppController.identityController.selectedIdentity.ppk.toPk());f.generateId(AppController.serverController.selectedServerUrl);f.name=$("#editRollupRuleName").val();f.rule=$("#editRollupRuleRule").val();f.description=$("#editRollupRuleDescription").val();
f.outcome=$("#editRollupRuleOutcome").val();f.competency=b.shortId();var a=$("#editRollupRuleOwnership").children("span").map(function(a,b){return $(b).find(".contactText").attr("title")});for(c=0;c<a.length;c++)f.addOwner(EcPk.fromPem(a[c]));if(!$("#editRollupRuleVisibilityRow").hasClass("hide"))for(EcEncryptedValue.encryptOnSave(f.id,!0),a=$("#editRollupRuleReaders").children().map(function(a,b){return $(b).find(".contactText").attr("title")}),c=0;c<a.length;c++)f.addReader(EcPk.fromPem(a[c]));
void 0==f.name||""==f.name?ViewManager.getView("#editRollupRuleError").displayAlert("RollupRule Requires a Name to be Saved"):f.save(function(){void 0!=h&&h(f);ModalManager.hideModal()},l)});else if(b.isAny((new EcRollupRule).getTypes())){$("#editRollupRuleDelete").removeClass("hide");$("#editRollupRuleSubmit").text("Save");$("#editRollupRuleName").val(b.name);$("#editRollupRuleRule").val(b.rule);$("#editRollupRuleDescription").val(b.description);$("#editRollupRuleOutcome").val(b.outcome);if(1==EcEncryptedValue.encryptOnSave(b.id))if($("#editRollupRuleVisibilityRow").removeClass("hide"),
$("#editRollupRuleReadersRow").removeClass("hide"),void 0!=b.reader&&0<b.reader.length){$("#editRollupRuleReaders").text("");$("#editRollupRuleReaders").css("font-style","normal");for(var g=0;g<b.reader.length;g++)0<g&&$("#editRollupRuleReaders").append(", "),d=b.reader[g],$("#editRollupRuleReaders").append("\x3cspan id\x3d'rule-reader-"+g+"'\x3e\x3c/span\x3e"),ViewManager.showView(new IdentityDisplay(d),"#rule-reader-"+g)}else $("#editRollupRuleReaders").text("None Added Yet");if(void 0!=b.owner&&
0<b.owner.length)for($("#editRollupRuleOwnership").text(""),g=0;g<b.owner.length;g++)0<g&&$("#editRollupRuleOwnership").append(", "),d=b.owner[g],$("#editRollupRuleReaders").append("\x3cspan id\x3d'rule-owner-"+g+"'\x3e\x3c/span\x3e"),ViewManager.showView(new IdentityDisplay(d),"#rule-owner-"+g);var g=!1,p;for(p in EcIdentityManager.ids)d=EcIdentityManager.ids[p].ppk.toPk(),b.canEdit(d)&&(g=!0);if(void 0==b.owner||0==b.owner.length)g=!0;g?(void 0!=b.owner&&($("#editRollupRuleAdvancedOwnership").removeClass("hide"),
$("#editRollupRuleAdvancedOwnership").click(function(c){b.name=$("#editRollupRuleName").val();b.rule=$("#editRollupRuleRule").val();b.description=$("#editRollupRuleDescription").val();b.outcome=$("#editRollupRuleOutcome").val();var f=$("#editRollupRuleOwnership").children("span").map(function(a,b){return $(b).find(".contactText").attr("title")});for(c=0;c<f.length;c++)b.addOwner(EcPk.fromPem(f[c]));if(!$("#editRollupRuleVisibilityRow").hasClass("hide"))for(EcEncryptedValue.encryptOnSave(b.id,!0),
f=$("#editRollupRuleReaders").children().map(function(a,b){return $(b).find(".contactText").attr("title")}),c=0;c<f.length;c++)b.addReader(EcPk.fromPem(f[c]));ModalManager.showModal(new AdvancedPermissionsModal(b,function(a){if(EcEncryptedValue.encryptOnSave(a.id))if($("#editRollupRuleVisibilityRow").removeClass("hide"),$("#editRollupRuleReadersRow").removeClass("hide"),void 0!=a.reader&&0<a.reader.length){$("#editRollupRuleReaders").text("");$("#editRollupRuleReaders").css("font-style","normal");
for(var b=0;b<a.reader.length;b++){0<b&&$("#editRollupRuleReaders").append(", ");var c=a.reader[b];$("#editRollupRuleReaders").append("\x3cspan id\x3d'rule-reader-"+b+"'\x3e\x3c/span\x3e");ViewManager.showView(new IdentityDisplay(c),"#rule-reader-"+b)}}else $("#editRollupRuleReaders").text("None Added Yet");else $("#editRollupRuleVisibilityRow").addClass("hide"),$("#editRollupRuleReadersRow").addClass("hide");ModalManager.showModal(new e(a,h))}))})),$("#editRollupRuleModalTitle").text("Edit RollupRule"),
$("#editRollupRuleSubmit").click(function(c){c.preventDefault();b.name=$("#editRollupRuleName").val();b.rule=$("#editRollupRuleRule").val();b.description=$("#editRollupRuleDescription").val();b.outcome=$("#editRollupRuleOutcome").val();var f=$("#editRollupRuleOwnership").children("span").map(function(a,b){return $(b).find(".contactText").attr("title")});for(c=0;c<f.length;c++)b.addOwner(EcPk.fromPem(f[c]));if(!$("#editRollupRuleVisibilityRow").hasClass("hide"))for(EcEncryptedValue.encryptOnSave(b.id,
!0),f=$("#editRollupRuleReaders").children().map(function(a,b){return $(b).find(".contactText").attr("title")}),c=0;c<f.length;c++)b.addReader(EcPk.fromPem(f[c]));void 0==b.name||""==b.name?ViewManager.getView("#editRollupRuleError").displayAlert("RollupRule Requires a Name to be Saved"):(c=b.id.split("/"),"data"==c[c.length-4]&&(c[c.length-1]=(new Date).getTime()),b.id=c.join("/"),b.save(b,function(a){void 0!=h&&h(b);ModalManager.hideModal()},l))}),$("#editRollupRuleDelete").click(function(c){c.preventDefault();
EcRepository._delete(b,function(){void 0!=h&&h(null);ModalManager.hideModal()},k)})):($("#editRollupRuleModalTitle").text("View RollupRule"),$("#editRollupRuleDelete").remove(),$("#editRollupRuleSubmit").remove(),$("#editRollupRuleCancel").remove(),$("#editRollupRuleName").attr("disabled","disabled"),$("#editRollupRuleRule").attr("disabled","disabled"),$("#editRollupRuleDescription").attr("disabled","disabled"),$("#editRollupRuleOutcome").attr("disabled","disabled"))}else ViewManager.getView("#editRollupRuleError").displayAlert("Unrecognized Context For RollupRule Modal"),
$("#editRollupRuleName").attr("disabled","disabled"),$("#editRollupRuleRule").attr("disabled","disabled"),$("#editRollupRuleDescription").attr("disabled","disabled"),$("#editRollupRuleOutcome").attr("disabled","disabled"),$("#editRollupRuleSubmit").click(function(b){b.preventDefault()})};return e}(EditRollupRuleModal),EncryptOptionsModal=function(e){e.prototype.display=function(e){var k=this.callback;ViewManager.showView(new MessageContainer("encryptOptions"),"#encryptOptionsMessageContainer");var d=
!1,b=!1;ViewManager.showView(new Switch(function(){d=ViewManager.getView("#showName").isChecked()},!1,"showEncryptedName"),"#showName");ViewManager.showView(new Switch(function(){b=ViewManager.getView("#showType").isChecked()},!1,"showEncryptedType"),"#showType");$("#confirmBtn").click(function(e){k({type:b,name:d})});$("#cancelBtn").click(function(b){ModalManager.hideModal()})};return e}(EncryptOptionsModal),EvidenceViewModal=function(e){e.prototype.display=function(e){var k=this.evidence;ViewManager.showView(new MessageContainer("viewEvidence"),
"#viewEvidenceMessageContainer",function(){0==k.length&&ViewManager.getView("#viewEvidenceMessageContainer").displayAlert("No Evidences Available to Display")});$("#viewEvidenceCloseBtn").click(function(b){b.preventDefault();ModalManager.hideModal()});for(var d in k){e=k[d];if(e.startsWith("http")||e.startsWith("www")){var b=$("\x3ca\x3e\x3c/a\x3e");b.attr("href",e);b.text(e);var h=$("\x3cli\x3e\x3c/li\x3e");h.append(b)}else h=$("\x3cli\x3e\x3c/li\x3e"),h.text(e);$("#evidenceList").append(h)}};return e}(EvidenceViewModal);
FileManagerScreen=function(e){function l(a){void 0==a&&(a="Unable to Connect to Server for Upload");ViewManager.getView("#fileManagerMessageContainer").displayAlert(a,"uploadFail")}function k(a){void 0==a&&(a="Unable to Connect to Server for Download");ViewManager.getView("#fileManagerMessageContainer").displayAlert(a,"downloadFail")}function d(a){void 0==a&&(a="Unable to Connect to Server to Search");ViewManager.getView("#fileManagerMessageContainer").displayAlert(a,"searchFail")}function b(a){$("#fileManagerResults").html("");
for(var b in a){$("#fileManagerResults").append('\x3cdiv class\x3d"tile" tabindex\x3d"0" style\x3d"display:block"\x3e\x3cdiv class\x3d"cube app document"\x3e\x3cdiv class\x3d"front"\x3e\x3cp class\x3d"title"\x3e\x3c/p\x3e\x3c/div\x3e\x3cdiv class\x3d"back"\x3e\x3cp class\x3d"status"\x3e\x3c/p\x3e\x3cdiv class\x3d"actions"\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3ca class\x3d"hotspot finger" title\x3d""\x3e\x3c/a\x3e\x3c/div\x3e');var c=$("#fileManagerResults").children(".tile").last(),f=a[b].name;
c.find(".title").text(f);c.attr("id",a[b].id)}$("#fileManagerResults").on("click",".tile",function(){ViewManager.getView("#fileManagerMessageContainer").clearAlert("downloadFail");EcFile.get($(this).attr("id"),function(a){a.download()},k)})}function h(){var a=$("#fileManagerSearchText").val();ViewManager.getView("#fileManagerMessageContainer").clearAlert("searchFail");var c;c=m?null:{ownership:"owned"};EcFile.search(AppController.serverController.getRepoInterface(),a,b,d,c)}function g(){$("#fileManagerResults").append('\x3cdiv class\x3d"tile" tabindex\x3d"0" style\x3d"display:block"\x3e\x3cdiv class\x3d"cube app document"\x3e\x3cdiv class\x3d"front"\x3e\x3cp class\x3d"title"\x3eInitializing...\x3c/p\x3e\x3c/div\x3e\x3cdiv class\x3d"back"\x3e\x3cp class\x3d"status"\x3e\x3c/p\x3e\x3cdiv class\x3d"actions"\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3ca class\x3d"hotspot finger" title\x3d""\x3e\x3c/a\x3e\x3c/div\x3e');
0<n.length&&(a?setTimeout(function(){p(!0)},100):setTimeout(function(){p(!1)},100))}function p(a){$("#fileManagerResults").children(".tile").last().find(".title").text("Uploading...");setTimeout(function(){c(a)},100)}function c(a){var b=new FileReader;b.onload=function(b){b=EcFile.create(n[0].name,b.target.result.split(",")[1],b.target.result.split(";")[0].split(":")[1]);b.generateId(AppController.serverController.getRepoInterface().selectedServer);a&&(EcEncryptedValue.encryptOnSave(b.id,!0),b.addOwner(AppController.identityController.selectedIdentity.ppk.toPk()));
b.save(f,l)};b.readAsDataURL(n[0])}function f(){ViewManager.getView("#fileManagerMessageContainer").clearAlert("uploadFail");$("#fileManagerResults").children(".tile").last().find(".title").text("Completed.");n.shift();0!=n.length?g():h()}var a=!0,m=!0,q="2px dotted #0B85A1";$("#dragTarget");var n,r;e.prototype.display=function(b){ViewManager.showView(new MessageContainer("fileSearch"),"#fileManagerMessageContainer");h();$("#fileManagerSearchText").on("keyup",function(a){h()});$("#fileManagerSearchBtn").click(h);
$("#fileManagerEncrypted").change(function(){a=this.checked;h()});$("#fileManagerPublic").change(function(){m=this.checked;h()});$("#dragTarget").on("dragenter",function(a){a.stopPropagation();a.preventDefault();q="2px solid #0B85A1"});$("#dragTarget").on("dragover",function(a){a.stopPropagation();a.preventDefault();q="2px solid #0B85A1";$("#dragTarget").css("border",q)});$("body").on("dragover",function(a){clearTimeout(r);r=setTimeout(function(){$("#dragTarget").css("border","")},200);$("#dragTarget").css("border",
q)});$("#dragTarget").on("dragleave",function(a){a.stopPropagation();a.preventDefault();q="2px dotted #0B85A1"});$("#dragTarget").on("drop",function(b){$(this).css("border","");b.preventDefault();b=b.originalEvent.dataTransfer.files;if(a&&null==AppController.identityController.selectedIdentity)ViewManager.getView("#fileManagerMessageContainer").displayAlert("Cannot Encrypt, User Not Logged In or Identity Not Selected","noIdentity");else{ViewManager.getView("#fileManagerMessageContainer").clearAlert("noIdentity");
n=[];for(var c=0;c<b.length;c++)n.push(b[c]);$("#fileManagerResults").html("");g()}})};return e}(FileManagerScreen);
FrameworkEditScreen=function(e){function l(c){$("#frameworkEditId").val(c.id);$("#frameworkEditName").val(c.getName());$("#frameworkEditDescription").val(c.getDescription());if(void 0!=c.owner&&0!=c.owner.length){$("#frameworkEditOwner").html("");for(var g=0;g<c.owner.length;g++){var e=c.owner[g];$("#frameworkEditOwner").append("\x3cspan id\x3d'framework-owner-"+g+"'\x3e\x3c/span\x3e");ViewManager.showView(new IdentityDisplay(e),"#framework-owner-"+g);g<c.owner.length-1&&$("#frameworkEditOwner").append(", ")}$("#frameworkEditOwnerAdvanced").removeClass("hide")}else $("#frameworkEditOwner").text("Public"),
$("#frameworkEditOwnerAdvanced").addClass("hide");if(EcEncryptedValue.encryptOnSave(c.id))if("none"==$("#privateRow").css("display")&&$("#privateRow").slideDown(),void 0!=c.reader&&0!=c.reader.length)for($("#frameworkEditNoReaders").addClass("hide"),$("#frameworkEditReaders").html(""),g=0;g<c.reader.length;g++)e=c.reader[g],$("#frameworkEditReaders").append("\x3cspan id\x3d'framework-reader-"+g+"'\x3e\x3c/span\x3e"),ViewManager.showView(new IdentityDisplay(e),"#framework-reader-"+g),g<c.reader.length-
1&&$("#frameworkEditReaders").append(", ");else $("#frameworkEditNoReaders").removeClass("hide");else"none"!=$("#privateRow").css("display")&&$("#privateRow").slideUp();$("#frameworkEditCompetencies option").not("#noCompetencies").remove();for(var n in c.competency)EcCompetency.get(c.competency[n],k,f);$("#frameworkEditRelations option").not("#noRelations").remove();for(n in c.relation)EcAlignment.get(c.relation[n],d,a);$("#frameworkEditLevels option").not("#noLevels").remove();for(n in c.level)EcLevel.get(c.level[n],
function(a){b(a)},m);$("#frameworkEditRollupRules option").not("#noRollupRules").remove();for(n in c.rollupRule)EcRollupRule.get(c.rollupRule[n],function(a){h(a)},q)}function k(a){$("#frameworkEditCompetencies #noCompetencies").hide();$("#frameworkEditCompetencies").removeAttr("disabled");$("#frameworkEditCompetencies").removeClass("empty");var b=$("\x3coption\x3e\x3c/option\x3e");b.attr("title",a.id);b.attr("id",a.id);b.attr("value",a.id);b.text(a.getName()+(void 0==a.getDescription()?"":" - "+a.getDescription()));
$("#frameworkEditCompetencies").append(b)}function d(a){$("#frameworkEditRelations #noRelations").hide();$("#frameworkEditRelations").removeAttr("disabled");$("#frameworkEditRelations").removeClass("empty");var b=EcRemoteLinkedData.trimVersionFromUrl(a.source).split("/"),b=b[b.length-1]+"-relations",c=$("#frameworkEditRelations optgroup#"+b);0==c.size()&&(c=$("\x3coptgroup\x3e\x3c/optgroup\x3e"),c.attr("id",b),c.attr("label",EcCompetency.getBlocking(a.source).getName()),$("#frameworkEditRelations").append(c));
var b=a.shortId().split("/"),b=b[b.length-1],f=$("\x3coption style\x3d'font-style:italic;'\x3e\x3c/option\x3e");f.attr("id",b);f.val(a.id);f.text(a.relationType+" "+EcCompetency.getBlocking(a.target).getName());c.append(f)}function b(a){$("#frameworkEditLevels #noLevels").hide();$("#frameworkEditLevels").removeAttr("disabled");$("#frameworkEditLevels").removeClass("empty");var b=EcCompetency.getBlocking(a.competency);void 0==b&&(b=EcCompetency.getBlocking(EcRemoteLinkedData.trimVersionFromUrl(a.competency)));
var c=b.shortId().split("/"),c=c[c.length-1]+"-levels",f=$("#frameworkEditLevels optgroup#"+c);0==f.size()&&(f=$("\x3coptgroup\x3e\x3c/optgroup\x3e"),f.attr("id",c),f.attr("label",b.getName()),$("#frameworkEditLevels").append(f));b=a.shortId().split("/");b=b[b.length-1];c=$("\x3coption style\x3d'font-style:italic'\x3e\x3c/option\x3e");c.attr("id",b);c.val(a.id);c.attr("title",(void 0==a.performance?a.description:a.performance)+"'\x3e"+a.getName()+" (Title: "+a.title+")");c.text(a.getName());f.append(c)}
function h(a){$("#frameworkEditRollupRules #noRollupRules").hide();$("#frameworkEditRollupRules").removeAttr("disabled");$("#frameworkEditRollupRules").removeClass("empty");var b=EcCompetency.getBlocking(a.competency);void 0==b&&(b=EcCompetency.getBlocking(EcRemoteLinkedData.trimVersionFromUrl(a.competency)));var c=b.shortId().split("/"),c=c[c.length-1]+"-rollupRules",f=$("#frameworkEditRollupRules optgroup#"+c);0==f.size()&&(f=$("\x3coptgroup\x3e\x3c/optgroup\x3e"),f.attr("id",c),f.attr("label",
b.getName()),$("#frameworkEditRollupRules").append(f));b=a.shortId().split("/");b=b[b.length-1];c=$("\x3coption style\x3d'font-style:italic'\x3e\x3c/option\x3e");c.attr("id",b);c.val(a.id);c.attr("title",a.getDescription());c.text(a.getName());f.append(c)}function g(){$("#datum").effect("highlight",{},1500)}function p(a){void 0==a&&(a="Unable to Connect to Server to Retrieve Competency for Editing");ViewManager.getView("#frameworkEditMessageContainer").displayAlert(a)}function c(a){void 0==a&&(a=
"Unable to Connect to Server to Save Competency");ViewManager.getView("#frameworkEditMessageContainer").displayAlert(a,"saveFail")}function f(a){void 0==a&&(a="Unable to Connect to Server to Retrieve Competency");ViewManager.getView("#frameworkEditMessageContainer").displayAlert(a,"getCompetency")}function a(a){void 0==a&&(a="Unable to Connect to Server to Retrieve Relation");ViewManager.getView("#frameworkEditMessageContainer").displayAlert(a,"getRelation")}function m(a){void 0==a&&(a="Unable to Connect to Server to Retrieve Level");
ViewManager.getView("#frameworkEditMessageContainer").displayAlert(a,"getLevel")}function q(a){void 0==a&&(a="Unable to Connect to Server to Retrieve Rollup Rule");ViewManager.getView("#frameworkEditMessageContainer").displayAlert(a,"getRollupRule")}function n(a){void 0==a&&(a="Unable to Connect to Server to Search Competency");ViewManager.getView("#frameworkEditMessageContainer").displayAlert(a,"searchCompetencies")}function r(a){void 0==a&&(a="Unable to Connect to Server to Search Relations");ViewManager.getView("#frameworkEditMessageContainer").displayAlert(a,
"searchRelations")}function u(a){void 0==a&&(a="Unable to Connect to Server to Search Levels");ViewManager.getView("#frameworkEditMessageContainer").displayAlert(a,"searchLevels")}function t(a){void 0==a&&(a="Unable to Connect to Server to Search Rollup Rules");ViewManager.getView("#frameworkEditMessageContainer").displayAlert(a,"searchRollupRules")}function z(a){ViewManager.getView("#frameworkEditMessageContainer").displayAlert(a,"removeCompetency")}function y(a){$("#frameworkEditAddLevel").typeahead({hint:!1,
highlight:!0,minLength:2},{name:"levels",source:function(b,c,f){var g={},d=0;for(b=0;b<a.competency.length;b++)EcCompetency.get(a.competency[b],function(b){b.levels(AppController.serverController.getRepoInterface(),void 0,u,function(b){d++;for(var c in b)g[b[c].id]=b[c];if(d==a.competency.length){b=[];for(var e in g)(void 0==a.level||-1==a.level.indexOf(e)&&-1==a.level.indexOf(EcRemoteLinkedData.trimVersionFromUrl(e)))&&b.push(g[e]);f(b)}})})},async:!0,display:function(a){return EcCompetency.getBlocking(a.competency).getName()+
" - "+a.getName()+" (Title: "+a.title+")"},templates:{suggestion:function(a){return"\x3cdiv class\x3d'typeaheadSuggestion'\x3e"+EcCompetency.getBlocking(a.competency).getName()+" - \x3ci\x3e"+a.name+" (Title: "+a.title+") \x3cspan class\x3d'label secondary'\x3e"+a.id+"\x3c/span\x3e\x3c/i\x3e\x3c/div\x3e"}}}).bind("typeahead:selected",function(c,f){$("#frameworkEditAddLevel").typeahead("val","");a.addLevel(f.id);b(f)}).bind("typeahead:autocompleted",function(c,f){$("#frameworkEditAddLevel").typeahead("val",
"");a.addLevel(f.id);b(f)})}function x(a){$("#frameworkEditAddRollupRule").typeahead({hint:!1,highlight:!0,minLength:2},{name:"rollupRules",source:function(b,c,f){var g={},d=0;for(b=0;b<a.competency.length;b++)EcCompetency.getBlocking(a.competency[b]).rollupRules(AppController.serverController.getRepoInterface(),void 0,t,function(b){d++;for(var c in b)g[b[c].id]=b[c];if(d==a.competency.length){b=[];for(var e in g)(void 0==a.rollupRule||-1==a.rollupRule.indexOf(e)&&-1==a.rollupRule.indexOf(EcRemoteLinkedData.trimVersionFromUrl(e)))&&
b.push(g[e]);f(b)}})},async:!0,display:function(a){return EcCompetency.getBlocking(a.competency).getName()+" - "+a.name},templates:{suggestion:function(a){return"\x3cdiv class\x3d'typeaheadSuggestion'\x3e"+EcCompetency.getBlocking(a.competency).getName()+" - \x3ci\x3e"+a.name+"\x3c/i\x3e \x3cspan class\x3d'label secondary'\x3e"+a.id+"\x3c/span\x3e\x3c/div\x3e"}}}).bind("typeahead:selected",function(b,c){$("#frameworkEditAddRollupRule").typeahead("val","");a.addRollupRule(c.id);h(c)}).bind("typeahead:autocompleted",
function(b,c){$("#frameworkEditAddRollupRule").typeahead("val","");a.addRollupRule(c.id);h(c)})}function v(a){$("#frameworkEditAddRelation").typeahead({hint:!1,highlight:!0,minLength:2},{name:"relations",source:function(b,c,f){EcAlignment.searchBySources(AppController.serverController.getRepoInterface(),a.competency,function(a){f(a)},r)},async:!0,display:function(a){return EcCompetency.getBlocking(a.source).getName()+" "+AppSettings.relationTypes[a.relationType]+" "+EcCompetency.getBlocking(a.target).getName()},
templates:{suggestion:function(a){return"\x3cdiv class\x3d'typeaheadSuggestion'\x3e"+EcCompetency.getBlocking(a.source).getName()+" \x3ci\x3e"+AppSettings.relationTypes[a.relationType]+"\x3c/i\x3e "+EcCompetency.getBlocking(a.target).getName()+" \x3cspan class\x3d'label secondary'\x3e"+a.id+"\x3c/span\x3e\x3c/div\x3e"}}}).bind("typeahead:selected",function(b,c){$("#frameworkEditAddRelation").typeahead("val","");a.addRelation(c.id);d(c)}).bind("typeahead:autocompleted",function(b,c){$("#frameworkEditAddRelation").typeahead("val",
"");a.addRelation(c.id);d(c)})}function w(a){$("#frameworkEditAddCompetency").typeahead({hint:!1,highlight:!0,minLength:2},{limit:25,name:"competencies",source:function(b,c,f){EcCompetency.search(AppController.serverController.getRepoInterface(),b,function(b){var c=[],g;for(g in b)(void 0==a.competency||-1==a.competency.indexOf(b[g].id)&&-1==a.competency.indexOf(b[g].shortId()))&&c.push(b[g]);f(c)},n)},async:!0,display:function(a){return a.getName()},templates:{suggestion:function(a){return"\x3cdiv class\x3d'typeaheadSuggestion' title\x3d'"+
a.id+"'\x3e"+a.getName()+"\x3cspan class\x3d'label secondary'\x3e"+a.id+"\x3c/span\x3e\x3c/div\x3e"}}}).bind("typeahead:selected",function(b,c){$("#frameworkEditAddCompetency").typeahead("val","");a.addCompetency(c.id);k(c)}).bind("typeahead:autocompleted",function(b,c){$("#frameworkEditAddCompetency").typeahead("val","");a.addCompetency(c.id);k(c)})}e.prototype.display=function(a,b){function f(a,b){EcRepository.get(a+b,function(c){b=""==b?2:b+1;f(a,b)},function(){$("#frameworkEditId").val(a+b+"/"+
(new Date).getTime())})}var d=this.data;void 0!=d&&(void 0!=d.id?ScreenManager.setScreenParameters({id:EcRemoteLinkedData.trimVersionFromUrl(d.id)}):d=void 0);void 0==d&&(d=new EcFramework,d.generateId(AppController.serverController.getRepoInterface().selectedServer),d.name="",void 0!=AppController.identityController.selectedIdentity&&d.addOwner(AppController.identityController.selectedIdentity.ppk.toPk()),$("#frameworkEditName").focus());ViewManager.showView(new MessageContainer("frameworkEdit"),
"#frameworkEditMessageContainer",function(){""==d.name&&void 0==AppController.identityController.selectedIdentity&&ViewManager.getView("#frameworkEditMessageContainer").displayWarning("You are Creating a Public Framework, this framework can be modified by anyone")});$("#frameworkEditSearchBtn").attr("href","#"+FrameworkSearchScreen.prototype.displayName);$("#frameworkEditSearchBtn").click(function(a){a.preventDefault();""==d.name?ScreenManager.changeScreen(new FrameworkSearchScreen):ScreenManager.changeScreen(new FrameworkSearchScreen(d))});
""==d.name?$("#frameworkEditCreateCompetency").hide():($("#frameworkEditCreateCompetency").attr("href","#"+e.prototype.displayName+"?frameworkId\x3d"+EcRemoteLinkedData.trimVersionFromUrl(d.id)),$("#frameworkEditCreateCompetency").click(function(a){a.preventDefault();""!=d.name&&ModalManager.showModal(new ConfirmModal(function(){ScreenManager.changeScreen(new CompetencyEditScreen(null,d.id),function(){ModalManager.hideModal()})},"Creating a new competency will navigate away from this screen.\x3cbr/\x3e\x3cbr/\x3e Any unsaved changes will be lost"))}));
""==d.name?$("#frameworkEditViewBtn").hide():($("#frameworkEditViewBtn").attr("href","#"+FrameworkViewScreen.prototype.displayName),$("#frameworkEditViewBtn").click(function(a){a.preventDefault();ScreenManager.changeScreen(new FrameworkViewScreen(d))}));$("#frameworkEditBtn").attr("href","#"+e.prototype.displayName);$("#frameworkEditBtn").click(function(a){a.preventDefault()});$("#frameworkEditCancelBtn").click(function(a){a.preventDefault();ScreenManager.changeScreen(new FrameworkViewScreen(d))});
""==d.name?$("#frameworkEditDeleteBtn").remove():$("#frameworkEditDeleteBtn").click(function(a){a.preventDefault();ModalManager.showModal(new ConfirmModal(function(){d._delete(function(){ScreenManager.changeScreen(new FrameworkSearchScreen)},function(a){void 0==a&&(a="Unable to connect to server to delete framework");ViewManager.getView("#frameworkEditMessageContainer").displayAlert(a)});ModalManager.hideModal()},"Are you sure you want to delete this framework?"))});$("#frameworkEditSaveBtn").click(function(a){a.preventDefault();
d.setName($("#frameworkEditName").val());d.setDescription($("#frameworkEditDescription").val());d.id=$("#frameworkEditId").val();if(""!=d.name){ViewManager.getView("#frameworkEditMessageContainer").clearAlert("saveFail");ViewManager.getView("#frameworkEditMessageContainer").clearAlert("defaultName");var b=new EcFramework,f;for(f in d)b[f]=d[f];b.save(function(a){d.id=b.id;$("#frameworkEditId").val(d.id);g(a)},c)}else ViewManager.getView("#frameworkEditMessageContainer").displayAlert("Cannot Save Framework With Default Name",
"defaultName")});$("#frameworkEditSaveBtn").on("mousemove",function(){var a=$("#frameworkEditId").val().split("/");"data"==a[a.length-4]&&(a[a.length-1]=(new Date).getTime());$("#frameworkEditId").val(a.join("/"))});$("#importCompetenciesBtn").click(function(){d.setName($("#frameworkEditName").val());void 0==d.name||""==d.name.trim()?alert("Framework name cannot be empty"):(d.id=$("#frameworkEditId").val(),ModalManager.showModal(new ImportCompetenciesModal(d)))});$("#frameworkEditName").change(function(){var a=
$("#frameworkEditName").val().toLowerCase().replace(/[^a-zA-Z0-9-_]/g,"-"),b=EcRemoteLinkedData.trimVersionFromUrl($("#frameworkEditId").val()).split("/");b[b.length-1]=a;f(b.join("/"),"")});$("#frameworkEditCompetencies").focus(function(){setTimeout(function(){void 0!=$("#frameworkEditCompetencies").val()&&""!=$("#frameworkEditCompetencies").val()&&($("#frameworkEditCompetencies").css("margin-bottom","0rem"),$("#frameworkEditDeleteCompetency").slideDown())},100)});$("#frameworkEditCompetencies").blur(function(){$("#frameworkEditDeleteCompetency").slideUp(function(){$("#frameworkEditCompetencies").css("margin-bottom",
"1rem")})});$("#frameworkEditDeleteCompetency").click(function(a){a.preventDefault();a=$("#frameworkEditCompetencies").val();for(var b in a)d.removeCompetency(a[b],function(){$("#frameworkEditOwner").text("");$("#frameworkEditCompetencies").html("");$("#frameworkEditRelations").html("");$("#frameworkEditLevels").html("");$("#frameworkEditRollupRules").html("");d.setName($("#frameworkEditName").val());d.setDescription($("#frameworkEditDescription").val());l(d)},z)});$("#frameworkEditRelations").focus(function(){setTimeout(function(){void 0!=
$("#frameworkEditRelations").val()&&""!=$("#frameworkEditRelations").val()&&($("#frameworkEditRelations").css("margin-bottom","0rem"),$("#frameworkEditDeleteRelation").slideDown())},100)});$("#frameworkEditRelations").blur(function(){$("#frameworkEditDeleteRelation").slideUp(function(){$("#frameworkEditRelations").css("margin-bottom","1rem")})});$("#frameworkEditDeleteRelation").click(function(a){a.preventDefault();a=$("#frameworkEditRelations").val();for(var b in a){var c=a[b];d.removeRelation(c);
c=EcRemoteLinkedData.trimVersionFromUrl(c).split("/");c=c[c.length-1];$("#frameworkEditRelations #"+c).remove()}$("#frameworkEditRelations optgroup").each(function(a,b){0==$(b).children().size()&&$(b).remove()})});$("#frameworkEditLevels").focus(function(){setTimeout(function(){void 0!=$("#frameworkEditLevels").val()&&""!=$("#frameworkEditLevels").val()&&($("#frameworkEditLevels").css("margin-bottom","0rem"),$("#frameworkEditDeleteLevel").slideDown())},100)});$("#frameworkEditLevels").blur(function(){$("#frameworkEditDeleteLevel").slideUp(function(){$("#frameworkEditLevels").css("margin-bottom",
"1rem")})});$("#frameworkEditDeleteLevel").click(function(a){a.preventDefault();a=$("#frameworkEditLevels").val();for(var b in a){var c=a[b];d.removeLevel(c);c=EcRemoteLinkedData.trimVersionFromUrl(c).split("/");c=c[c.length-1];$("#frameworkEditLevels #"+c).remove()}$("#frameworkEditLevels optgroup").each(function(a,b){0==$(b).children().size()&&$(b).remove()})});$("#frameworkEditRollupRules").focus(function(){setTimeout(function(){void 0!=$("#frameworkEditRollupRules").val()&&""!=$("#frameworkEditRollupRules").val()&&
($("#frameworkEditRollupRules").css("margin-bottom","0rem"),$("#frameworkEditDeleteRollupRule").slideDown())},100)});$("#frameworkEditRollupRules").blur(function(){$("#frameworkEditDeleteRollupRule").slideUp(function(){$("#frameworkEditRollupRules").css("margin-bottom","1rem")})});$("#frameworkEditDeleteRollupRule").click(function(a){a.preventDefault();a=$("#frameworkEditRollupRules").val();for(var b in a){var c=a[b];d.removeRollupRule(c);c=EcRemoteLinkedData.trimVersionFromUrl(c).split("/");c=c[c.length-
1];$("#frameworkEditRollupRules #"+c).remove()}$("#frameworkEditRollupRules optgroup").each(function(a,b){0==$(b).children().size()&&$(b).remove()})});$("#frameworkEditOwnerAdvanced").click(function(a){a.preventDefault();d.setName($("#frameworkEditName").val());d.setDescription($("#frameworkEditDescription").val());var b=d.owner.slice(0),c=void 0==d.reader?void 0:d.reader.slice(0);ModalManager.showModal(new AdvancedPermissionsModal(d,function(a){if(AppController.identityController.owns(a)||confirm("Are you sure you want to remove your ownership from this framework? \n\n You will no longer be able to edit it if you do")){var f=
!1;if(void 0!=b&&void 0!=d.owner&&b.length!=d.owner.length){for(var g in b)-1==d.owner.indexOf(b[g])&&(f=!0);for(g in d.owner)-1==b.indexOf(d.owner[g])&&(f=!0)}else void 0!=b&&void 0==d.owner&&(f=!0);if(void 0==c&&void 0!=d.reader&&0<d.reader.length)f=!0;else if(void 0!=c)if(void 0==d.reader)f=!0;else if(0<c.length&&(void 0==d.reader||0==d.reader.length))f=!0;else if(0==c.length&&void 0!=d.reader&&0<d.reader.length)f=!0;else if(void 0!=d.reader&&c.length!=d.reader.length){for(g in c)-1==d.reader.indexOf(c[g])&&
(f=!0);for(g in d.reader)-1==c.indexOf(d.reader[g])&&(f=!0)}f?(d.owner=a.owner,d.reader=a.reader,l(d),ModalManager.showModal(new PermissionPropagationModal(d,function(){l(d)}))):ModalManager.hideModal()}else d.owner=b,d.reader=c,ModalManager.hideModal()}))});""==d.name?(l(d),w(d),v(d),y(d),x(d)):EcFramework.get(d.id,function(a){d=a;l(d);w(d);v(d);y(d);x(d)},p)};e.prototype.addCompetency=function(a){k(a)};e.prototype.addRelation=function(a){d(a)};e.prototype.showSave=function(){g()};e.prototype.errorSaving=
function(a){c(a)};e.prototype.displaySuccess=function(a){void 0!=a&&ViewManager.getView("#frameworkEditMessageContainer").displaySuccess(a)};return e}(FrameworkEditScreen);
var FrameworkList=function(e){function l(g,e,c){if(void 0!=g){$("#competencyList").html("");if(void 0!=g.competency){7<g.competency.length&&$("#frameworkContentSearch").removeClass("hide");for(var f=0;f<g.competency.length;f++)(function(a){timeout(function(){EcCompetency.get(g.competency[a],function(a){k(a,e,c)},function(a){})})})(f)}if(void 0!=g.relation)for(f=0;f<g.relation.length;f++)(function(a){timeout(function(){var b;EcAlignment.get(g.relation[a],function(a){(b=function(){0<$(".competency[data-id\x3d'"+
a.source+"']").size()?d(a,g):setTimeout(b,100)})()},function(a){})})})(f);if(void 0!=g.level)for(f=0;f<g.level.length;f++)(function(a){timeout(function(){var c;EcLevel.get(g.level[a],function(a){(c=function(){0<$(".competency[data-id\x3d'"+a.competency+"']").size()?b(a):setTimeout(c,100)})()},function(a){})})})(f);if(void 0!=g.rollupRule)for(f=0;f<g.rollupRule.length;f++)(function(a){timeout(function(){var b;EcRollupRule.get(g.rollupRule[a],function(a){(b=function(){0<$(".competency[data-id\x3d'"+
a.competency+"']").size()?h(a):setTimeout(b,100)})()},function(a){})})})(f)}}function k(b,d,c){var f=$("\x3cli class\x3d'competency' style\x3d'margin-top: 0.5rem; cursor: pointer; padding: 0.25rem;'\x3e\x3cdiv class\x3d'competencyDetails'\x3e\x3ch6 class\x3d'competencyName' style\x3d'margin-bottom: 0px;'\x3e\x3ca\x3e\x3c/a\x3e\x3cbr\x3e \x3csmall class\x3d'competencyId'\x3e\x3c/small\x3e\x3c/h6\x3e\x3csmall class\x3d'competencyDescription' style\x3d'font-size: 0.75rem; margin-left: .5rem;'\x3e\x3c/small\x3e\x3cdiv class\x3d'levelContainer hide' style\x3d'margin-left:1.25rem;'\x3e\x3csmall\x3e\x3cstrong\x3eLevels:\x3c/strong\x3e \x3cspan class\x3d'levelCount' style\x3d'font-size:0.7rem;'\x3e\x3c/span\x3e\x3c/small\x3e\x3cul class\x3d'competencyLevels' style\x3d'list-style: none; display:none;'\x3e\x3c/ul\x3e\x3c/div\x3e\x3cdiv class\x3d'ruleContainer hide' style\x3d'margin-left:1.25rem;'\x3e\x3csmall\x3e\x3cstrong\x3eRules:\x3c/strong\x3e \x3cspan class\x3d'ruleCount' style\x3d'font-size:0.7rem;'\x3e\x3c/span\x3e\x3c/small\x3e\x3cul class\x3d'rollupRules' style\x3d'list-style: none; display:none;'\x3e\x3c/ul\x3e\x3c/div\x3e\x3cul class\x3d'competencyRelations' style\x3d'list-style: none; '\x3e\x3c/ul\x3e\x3c/div\x3e\x3c/li\x3e");
f.attr("data-id",b.shortId());void 0!=b.getName?f.find(".competencyName a").text(b.getName()):void 0!=datum.name?f.find(".competencyName a").text(b.name):f.find(".competencyName a").html("\x3ci\x3eUnknown Competency Name\x3c/i\x3e");f.find(".competencyDescription").text(b.description);f.find(".competencyId").text(b.shortId());f.attr("data-comp-id",b.shortId());f.find(".competencyName a").click(function(a){a.preventDefault();ScreenManager.changeScreen(new CompetencyViewScreen(b));return!1});f.find(".ruleCount").click(function(a){f.find(".rollupRules").slideToggle()});
f.find(".levelCount").click(function(a){f.find(".competencyLevels").slideToggle()});f.click(function(a){$(a.target).hasClass("fake-a")||$(a.target).is("a")||(f.toggleClass("selected"),$(d+" .competency").not(f).removeClass("selected"),void 0!=c&&void 0!=c.selected&&c.selected(b.shortId()))});$("#frameworkList").append(f)}function d(b,d){var c=$("\x3cli class\x3d'relation'\x3e\x3csmall\x3e\x3ci class\x3d'source'\x3e\x3c/i\x3e \x3cspan class\x3d'relationType'\x3e\x3c/span\x3e \x3ci class\x3d'target'\x3e\x3c/i\x3e\x3c/small\x3e\x3c/li\x3e"),
f=AppSettings.relationTypes[b.relationType];void 0==f&&(f=" has a relationship with ");c.find(".relationType").text(f);c.find(".source").attr("data-id",b.source);c.find(".source").attr("data-id",b.target);var a=c.clone();EcCompetency.get(b.source,function(f){c.find(".source").text(f.getName());a.find(".source").text(f.getName());-1==d.competency.indexOf(b.source)&&c.find("small").append(" \x3ci class\x3d'fa fa-small fa-external-link' style\x3d'font-size:0.65rem'\x3e\x3c/i\x3e ")});EcCompetency.get(b.target,
function(f){c.find(".target").text(f.getName());a.find(".target").text(f.getName());-1==d.competency.indexOf(b.target)&&c.find("small").append(" \x3ci class\x3d'fa fa-small fa-external-link' style\x3d'font-size:0.65rem'\x3e\x3c/i\x3e ")});c.find(".target").addClass("fake-a");a.find(".source").addClass("fake-a");$("[data-id\x3d'"+b.source+"'] .competencyRelations").append(c);$("[data-id\x3d'"+b.target+"'] .competencyRelations").append(a)}function b(b){var d=$("\x3cli class\x3d'level'\x3e\x3ca class\x3d'levelName'\x3e\x3c/a\x3e \x3csmall class\x3d'levelTitle'\x3e\x3c/small\x3e\x3cp class\x3d'levelDescription' style\x3d'font-size: .65rem; margin-left: .4rem; margin-bottom:0.65rem; line-height:0.5rem;'\x3e\x3c/p\x3e\x3c/li\x3e");
d.find(".levelName").text(b.name);d.find(".levelTitle").text("("+b.title+")");void 0!=b.description&&""!=b.description?d.find(".levelDescription").text(b.description):d.find(".levelDescription").hide();d.find(".levelName").click(function(){ModalManager.showModal(new EditLevelModal(b))});$("[data-id\x3d'"+b.competency+"'] .levelContainer").removeClass("hide");$("[data-id\x3d'"+b.competency+"'] .competencyLevels").append(d);d=$("[data-id\x3d'"+b.competency+"'] .competencyLevels").find(".level").size();
$("[data-id\x3d'"+b.competency+"'] .levelCount").text("( "+d+" )")}function h(b){var d=$("\x3cli class\x3d'rollupRule'\x3e\x3ca class\x3d'ruleName'\x3e\x3c/a\x3e \x3cp class\x3d'ruleDescription' style\x3d'font-size: .65rem; margin-left: .4rem; margin-bottom:0.65rem; line-height:0.5rem;'\x3e\x3c/p\x3e\x3c/li\x3e");d.find(".ruleName").text(b.name);void 0!=b.description&&""!=b.description?d.find(".ruleDescription").text(b.description):d.find(".ruleDescription").hide();d.find(".ruleName").click(function(){ModalManager.showModal(new EditRollupRuleModal(b))});
$("[data-id\x3d'"+b.competency+"'] .ruleContainer").removeClass("hide");$("[data-id\x3d'"+b.competency+"'] .rollupRules").append(d);d=$("[data-id\x3d'"+b.competency+"'] .rollupRules").find(".rollupRule").size();$("[data-id\x3d'"+b.competency+"'] .ruleCount").text("( "+d+" )")}e.prototype.display=function(b){l(this.data,b,this.callbacks);$("#frameworkContentSearch").keyup(function(b){var c=$("#frameworkContentSearch").val().toLowerCase();3<c.length?$("#frameworkList .competency").each(function(b,a){0==
$(a).find(".competencyName").text().toLowerCase().indexOf(c)?($(a).remove(),b=$("#frameworkList .competency").first(),0==b.text().toLowerCase().indexOf(c)?b.find(".competencyRelations .relation").size()>=$(a).find(".competencyRelations .relation").size()?b.after(a):$("#frameworkList").prepend(a):$("#frameworkList").prepend(a),$(a).show()):-1==$(a).text().toLowerCase().indexOf(c)?$(a).hide():$(a).show()}):$("#frameworkList .competency").show()})};e.prototype.setSelected=function(b){var d=this.callbacks;
$(".competency").removeClass("selected");var c=$(".competency[data-id\x3d'"+b+"']");c.addClass("selected");var f=c.parent();c.remove();f.prepend(c);c.click(function(a){$(a.target).hasClass("fake-a")||$(a.target).is("a")||(c.toggleClass("selected"),$(".competency").not(c).removeClass("selected"),void 0!=d&&void 0!=d.selected&&d.selected(b))});$(".competency").not(c).each(function(a,f){0<$(f).find("[data-id\x3d'"+b+"']").size()&&($(f).parent(),$(f).remove(),c.after(f),$(f).click(function(a){$(a.target).hasClass("fake-a")||
$(a.target).is("a")||($(f).toggleClass("selected"),$(".competency").not(f).removeClass("selected"),void 0!=d&&void 0!=d.selected&&d.selected($(f).attr("data-id")))}))})};e.prototype.deselectAll=function(){$(".competency").removeClass("selected")};return e}(FrameworkList);
FrameworkSearchScreen=function(e){function l(g){var e=$("#frameworkSearchText").val();if(null==e||""==e)e="*";null!=h&&clearTimeout(h);var c=$("#frameworkSearchOwnership").val(),c=1==c?"public":3==c?"owned":4==c?"me":"all",f;f=void 0==g?k:d;h=setTimeout(function(){var a={};if(1<window.location.hash.split("?").length)for(var d=window.location.hash.split(/[?&]/),h=1;h<d.length;h++){var n=d[h].split("\x3d");2==n.length&&(a[n[0]]=n[1])}"*"!=e&&(a.query=e);"all"!=c&&(a.ownership=c);0<Object.keys(a).length?
(ScreenManager.setScreenParameters(a),ScreenManager.getCurrentScreen().setParams(a)):(ScreenManager.setScreenParameters(null),ScreenManager.getCurrentScreen().clearParams());ViewManager.getView("#frameworkSearchMessageContainer").clearAlert("searchFail");ViewManager.getView("#frameworkSearchResults").deselectAll();a={};a.ownership=c;a.size=24;a.start=g;EcFramework.search(AppController.serverController.getRepoInterface(),e,f,b,a)},100)}function k(b){ViewManager.getView("#frameworkSearchResults").clear();
d(b)}function d(b){ViewManager.getView("#menuContainer").showSortBasic();ViewManager.getView("#frameworkSearchResults").populate(b);0==b.length&&0==$("#frameworkResults-data").first().children().size()?ViewManager.getView("#frameworkSearchResults").showNoDataMessage():24>b.length?$("#moreSearchResults").addClass("hide"):($("#getMoreResults").click(function(){$("#getMoreResults").addClass("hide");$("#loadingMoreResults").removeClass("hide");l($("#frameworkResults-data").first().children().size())}),
$("#getMoreResults").removeClass("hide"),$("#moreSearchResults").removeClass("hide"),$("#loadingMoreResults").addClass("hide"));h=null}function b(b){void 0==b&&(b="Unable to Connect to Server for Competency Search");ViewManager.getView("#frameworkSearchMessageContainer").displayAlert(b,"searchFail");ViewManager.getView("#frameworkSearchResults").showNoDataMessage()}var h=null;e.prototype.display=function(b){b=this.query;var d=this.ownership;ViewManager.showView(new MessageContainer("frameworkSearch"),
"#frameworkSearchMessageContainer");ViewManager.showView(new DataViewer("frameworkResults",{sort:{},clickDataEdit:function(b){ScreenManager.changeScreen(new FrameworkEditScreen(b))},moreMenuTools:function(){var b=$("\x3cdiv\x3e\x3c/div\x3e");el=$("\x3cli\x3e\x3cspan\x3e\x3ci class\x3d'fa fa-download'\x3e\x3c/i\x3e Export\x3c/span\x3e\x3c/li\x3e");el.click(function(){var b=ViewManager.getView("#frameworkSearchResults").getSelected();ModalManager.showModal(new RepoExportModal(b))});b.append(el);return b.contents()},
buildDataRow:function(b,f,a){var c=void 0==a.competency?0:a.competency.length,d=void 0==a.relation?0:a.relation.length;b.append("\x3cdiv class\x3d'small-4 columns'\x3e\x3ca class\x3d'datum-name'\x3e\x3c/a\x3e\x3c/div\x3e\x3cdiv class\x3d'small-2 columns'\x3e"+c+(1==c?" Competency":" Competencies")+"\x3c/div\x3e\x3cdiv class\x3d'small-2 columns'\x3e"+d+(1==d?" Relationship":" Relationships")+"\x3c/div\x3e\x3cdiv class\x3d'small-4 columns datum-owner'\x3e\x3c/div\x3e");void 0!=a.getName&&""!=a.getName()?
b.find(".datum-name").text(a.getName()):void 0!=a.name&&""!=a.name?b.find(".datum-name").text(a.name):b.find(".datum-name").html("\x3ci\x3eNo Name\x3c/i\x3e");if(void 0!=a.owner&&0<a.owner.length)for(var g in a.owner)c=EcRemoteLinkedData.trimVersionFromUrl(f),c=c.split("/")[c.split("/").length-1]+"-owner-"+g,d=$("\x3cspan id\x3d'"+c+"'\x3e\x3c/span\x3e"),b.find(".datum-owner").append(d),ViewManager.showView(new IdentityDisplay(a.owner[g]),"#"+c);else b.find(".datum-owner").text("Public");b.find(".datum-name").click(function(b){b.preventDefault();
ScreenManager.changeScreen(new FrameworkViewScreen(a))})}}),"#frameworkSearchResults");$("#frameworkSearchSubmit").click(function(b){b.preventDefault();l()});$("#frameworkSearchOwnership").change(function(b){b.preventDefault();l()});$("#frameworkSearchText").keypress(function(b){13==b.which&&l()});null!=b&&$("#frameworkSearchText").val(b);AppController.loginController.getLoggedIn()?($("#frameworkSearchOwnership").attr("max",4),$("#frameworkSearchOwnershipLoggedIn").removeClass("hide"),$("#frameworkSearchOwnershipPublic").addClass("hide")):
($("#frameworkSearchOwnershipLoggedIn").addClass("hide"),$("#frameworkSearchOwnershipPublic").removeClass("hide"));null!=d&&("public"==d?d=1:"owned"==d?d=3:"me"==d&&(d=4),$("#frameworkSearchOwnership").val(d));l();ViewManager.getView("#menuContainer").showSortBasic()};e.prototype.onClose=function(){ViewManager.getView("#menuContainer").hideSort()};e.prototype.sortByTimestamp=function(){$("#frameworkResults-sortSelect").val("timestamp");$("#frameworkResults-sortSelect").trigger("change")};e.prototype.sortByOwner=
function(){$("#frameworkResults-sortSelect").val("owner");$("#frameworkResults-sortSelect").trigger("change")};e.prototype.filterPublic=function(){$("#frameworkSearchOwnership").val(1);l()};e.prototype.filterAll=function(){$("#frameworkSearchOwnership").val(2);l()};e.prototype.filterOwned=function(){$("#frameworkSearchOwnership").val(3);l()};e.prototype.filterOwnedByMe=function(){AppController.loginController.getLoggedIn()&&($("#frameworkSearchOwnership").val(4),l())};e.prototype.setParams=function(b){void 0==
b?this.clearParams():(this.query=b.query,this.ownership=b.ownership)};e.prototype.clearParams=function(){this.ownership=this.query=void 0};return e}(FrameworkSearchScreen);
FrameworkViewScreen=function(e){function l(b){void 0!=b.getName?$("#frameworkViewerName").text(b.getName()):void 0!=b.name?$("#frameworkViewerName").text(b.name):$("#frameworkViewerName").html("\x3ci\x3eUnnamed Framework\x3c/i\x3e");$("#frameworkViewerId").text(b.id);void 0!=b.getDescription?$("#frameworkViewerDescription").text(b.getDescription()):void 0!=b.description&&$("#frameworkViewerDescription").text(b.description);k(b)}function k(b,a){void 0!=b.competency&&0<b.competency.length?($("#frameworkViewerContents").removeClass("hide"),
$("#frameworkEmpty").addClass("hide"),$("#frameworkLoading").removeClass("hide"),AppController.serverController.getRepoInterface().precache(b.competency,function(){AppController.serverController.getRepoInterface().precache(b.relation,function(){AppController.serverController.getRepoInterface().precache(b.level,function(){$("#frameworkLoading").addClass("hide");var a=d(b);ViewManager.showView(new FrameworkList(b,{selected:a}),"#frameworkContentsList")})})})):($("#frameworkViewerContents").addClass("hide"),
$("#frameworkEmpty").removeClass("hide"))}function d(b){var a=$("#frameworkViewCanvas").get(0);a.getContext("2d");var f=new Springy.Graph,d={};a.width=$("#frameworkViewCanvas").parent().innerWidth()-60;jQuery(function(){var a=window.springy=$("#frameworkViewCanvas").springy({graph:f,nodeSelected:function(a){console.log("Node selected: "+JSON.stringify(a.data));ViewManager.getView("#frameworkContentsList").setSelected(EcRemoteLinkedData.trimVersionFromUrl(a.data.id))},noNodeSelected:function(){ViewManager.getView("#frameworkContentsList").deselectAll()},
stiffness:500,minEnergyThreshold:.1});p[b.shortId()]=a});var g=0;if(void 0!=b.competency)for(a=0;a<b.competency.length;a++)g++,function(a){EcCompetency.get(b.competency[a],function(a){g--;var e=a.getName();d[a.shortId()]=f.newNode({id:a.id,name:e,font:c.node,mass:2});d[a.shortId()].gravity=0;d[a.shortId()].fixed=!0;100<b.competency.length?d[a.shortId()].alwaysShowText=!1:20>b.competency.length&&(d[a.shortId()].alwaysShowText=!0);if(0==g&&($("#frameworkViewCanvas").removeClass("hide"),void 0!=b.relation))for(a=
0;a<b.relation.length;a++)(function(a){EcAlignment.get(b.relation[a],function(a){var g=new EcAlignment;g.copyFrom(a);if(void 0!==g.source){a=EcRemoteLinkedData.trimVersionFromUrl(g.source);var e=EcRemoteLinkedData.trimVersionFromUrl(g.target);null!=d[a]&&null!=d[e]&&(void 0===d[a].alwaysShowText&&(d[a].alwaysShowText=!1),g.font=c.edge,"requires"==g.relationType&&(100>b.competency.length&&(d[a].alwaysShowText=!0),d[e].fixed=!1,d[e].gravity+=1,g.color="#880000",f.newEdge(d[a],d[e],g)),"narrows"==g.relationType&&
(100>b.competency.length&&(d[e].alwaysShowText=!0),d[a].fixed=!1,d[a].gravity+=1,g.color="#008800",f.newEdge(d[e],d[a],g)))}},function(){})})(a)},function(){})}(a);return function(a){window.springy.layout.eachNode(function(b,c){EcRemoteLinkedData.trimVersionFromUrl(b.data.id)==a&&(window.springy.layout.selected={node:b,point:c,distance:0})})}}function b(b){ModalManager.showModal(new ConfirmModal(function(){b._delete(function(a){ScreenManager.changeScreen(new FrameworkSearchScreen)},function(a){null==
a&&(a="Unable to connect to server to delete framework");ViewManager.getView("#frameworkViewMessageContainer").displayAlert(a)});ModalManager.hideModal()},"Are you sure you want to delete this framework?"))}function h(b){void 0==b&&(b="Unable to Connect to Server to Retrieve Framework");ViewManager.getView("#frameworkViewMessageContainer").displayAlert(b,"getFramework")}function g(b,a){try{new Blob;var c=new Blob([b],{type:"text/plain;charset\x3dutf-8"});saveAs(c,a)}catch(q){ViewManager.getView("#frameworkViewMessageContainer").displayAlert("Your browser doesn't support file downloads",
"downloadFile")}}EcRepository.caching=!0;var p={},c={node:"bold 12px Arial",edge:"bold 12px Arial"};e.prototype.onClose=function(){if(window.springy!=p[this.data.shortId()])return!0;null!=window.springy&&void 0!==window.springy&&window.springy.layout.stop();window.springy=null;return!0};e.prototype.display=function(c,a){var f=this.data;null!=f.id&&ScreenManager.setScreenParameters({id:f.id});ViewManager.showView(new MessageContainer("frameworkView"),"#frameworkViewMessageContainer");EcEncryptedValue.encryptOnSave(f.id)?
$("#frameworkViewerPrivateSymbol").removeClass("hide"):$("#frameworkViewerPrivateSymbol").addClass("hide");if(void 0!=f.owner&&0<f.owner.length)for($("#frameworkViewOwner").text(""),c=0;c<f.owner.length;c++)0<c&&$("#frameworkViewOwner").append(", "),$("#frameworkViewOwner").append("\x3cspan id\x3d'framework-owner-"+c+"'\x3e\x3c/span\x3e"),ViewManager.showView(new IdentityDisplay(f.owner[c]),"#framework-owner-"+c);else $("#frameworkViewOwner").text("Public");$("#frameworkViewSearchBtn").attr("href",
"#"+FrameworkSearchScreen.prototype.displayName);$("#frameworkViewSearchBtn").click(function(a){a.preventDefault();ScreenManager.changeScreen(new FrameworkSearchScreen(f))});$("#frameworkViewBtn").attr("href","#"+e.prototype.displayName);$("#frameworkViewBtn").click(function(a){a.preventDefault()});AppController.identityController.canEdit(f)?$("#editFrameworkBtn").click(function(a){a.preventDefault();ScreenManager.changeScreen(new FrameworkEditScreen(f))}):$("#editFrameworkBtn").hide();AppController.identityController.owns(f)||
AppController.serverController.getAdmin()?$("#frameworkViewDeleteBtn").click(function(){b()}):$("#frameworkViewDeleteBtn").remove();$("#jsonLdDownload").click(function(){g(f.toJson(),f.getGuid()+".jsonld")});$("#rdfDownload").click(function(){f.asRdfXml(function(a){g(a,f.getGuid()+".xml")})});$("#ttlDownload").click(function(){f.asTurtle(function(a){g(a,f.getGuid()+".ttl")})});$("#nQuadsDownload").click(function(){f.asNQuads(function(a){g(a,f.getGuid()+".n4")})});$("#asnJsonDownload").click(function(){f.asAsnJson(function(a){g(a,
f.getGuid()+".json")},function(a){ViewManager.getView("#frameworkViewMessageContainer").displayAlert("Cannot find ASN endpoint: "+a,"downloadFile")},AppController.serverController.selectedServerUrl)});$("#csvDownload").click(function(){CSVExport.exportFramework(f.id,function(){},function(){})});EcFramework.get(f.id,function(a){f=a;AppController.storageController.addRecent(EcFramework.myType,f.shortId());ViewManager.getView(AppController.topBarContainerId).buildRecentFrameworkList(AppController.storageController.getRecent(EcFramework.myType));
l(f)},function(a){EcFramework.get(EcRemoteLinkedData.trimVersionFromUrl(f.id),function(a){f=a;AppController.storageController.addRecent(EcFramework.myType,f.shortId());ViewManager.getView(AppController.topBarContainerId).buildRecentFrameworkList(AppController.storageController.getRecent(EcFramework.myType));l(f)},h)})};return e}(FrameworkViewScreen);
var IdentityDisplay=function(e){function l(e,d){var b=AppController.identityController.lookup(e),h=$(d).find(".identityDisplay").first();h.attr("data-pk",e);h.find(".identityText").text(b.displayName);h.find(".qrcodeCanvas:empty").html("").qrcode({width:256,height:256,text:e.replaceAll(/[\r\n]/g,"").trim()});h.off("click.qr").on("click.qr",null,null,function(b){$(b.target).parents().hasClass("popout")||$(b.target).hasClass("popout")||(copyTextToClipboard(e),alert("Public key copied to clipboard."))});
h.on("mouseenter",function(){h.find(".popout").removeClass("hide");h.find(".qrcodeCanvas").addClass("hide");h.find(".connectContainer").addClass("hide");h.find(".identifyContainer").addClass("hide");h.find(".renameContainer").addClass("hide")});h.on("mouseleave",function(){h.find(".popout").addClass("hide")});h.find(".qrBtn").click(function(b){b.preventDefault();h.find(".identifyContainer").addClass("hide");h.find(".connectContainer").addClass("hide");h.find(".renameContainer").addClass("hide");h.find(".qrcodeCanvas").toggleClass("hide")});
b==IdentityController.unknownContact?(h.find(".knownIdentityContainer").addClass("hide"),h.find(".unknownIdentityContainer").removeClass("hide")):(h.find(".unknownIdentityContainer").addClass("hide"),h.find(".knownIdentityContainer").removeClass("hide"));h.find(".identifyBtn").click(function(b){b.preventDefault();h.find(".qrcodeCanvas").addClass("hide");h.find(".connectContainer").addClass("hide");h.find(".identifyContainer").toggleClass("hide");h.find(".identifyInput").focus()});h.find(".connectBtn").click(function(b){b.preventDefault();
h.find(".qrcodeCanvas").addClass("hide");h.find(".identifyContainer").addClass("hide");h.find(".connectContainer").toggleClass("hide");h.find(".connectInput").focus()});h.find(".saveIdentifyBtn").click(function(b){b.preventDefault();b=h.find(".identifyInput").val();AppController.identityController.addContact(e,b);$("[data-pk\x3d'"+e+"'] .identityText").text(b);$("[data-pk\x3d'"+e+"'] .unknownIdentityContainer").addClass("hide");$("[data-pk\x3d'"+e+"'] .knownIdentityContainer").removeClass("hide");
h.find(".identifyInput").val("");h.find(".popout").addClass("hide")});h.find(".sendConnectBtn").click(function(b){b.preventDefault();h.find(".connectInput").val("");h.find(".popout").addClass("hide")});h.find(".renameBtn").click(function(b){b.preventDefault();h.find(".qrcodeCanvas").addClass("hide");h.find(".renameContainer").toggleClass("hide")});h.find(".saveRenameBtn").click(function(b){b.preventDefault();b=h.find(".renameInput").val();AppController.identityController.isCurrentUser(e)?AppController.identityController.addKey(e,
b):AppController.identityController.addContact(e,b);$("[data-pk\x3d'"+e+"'] .identityText").text(b);h.find(".renameInput").val("");h.find(".popout").addClass("hide")})}e.prototype.display=function(e){l(this.data,e)};return e}(IdentityDisplay),ImportCompetenciesModal=function(e){function l(a){var b=a.shortId().split("/"),b=b[b.length-1];$("#noLocation").text("No Specific Framework");var c=$("\x3coption\x3e\x3c/option\x3e");c.attr("value",b);void 0==a.owner||0==a.owner.length?(c.text(a.name+" (Public)"),
$("#importLocationSelect").append(c)):(c.text(a.name),c.insertAfter("#noLocation"))}function k(a){for(var b=0;b<a.length;b++){var c=a[b],f=c.shortId().split("/"),f=f[f.length-1];l(c);u[f]=c}0==a.length&&$("#noLocation").text("No Specific Framework")}function d(a){for(var b=0;b<a.length;b++){var c=a[b],f=c.shortId().split("/"),f=f[f.length-1];if(f!=$("#importLocationSelect").val()){var d=c,g=d.shortId().split("/"),g=g[g.length-1],e=$("\x3coption\x3e\x3c/option\x3e");e.attr("value",g);void 0==d.owner||
0==d.owner.length?(e.text(d.name+" (Public)"),$("#importSourceSelect").append(e)):(e.text(d.name),e.insertAfter("#noSource"))}u[f]=c}}function b(a){void 0==a&&(a="Unable to Connect to Server to Find Frameworks");ViewManager.getView("#importCompetenciesMessageContainer").displayAlert(a,"getFramework")}function h(a){void 0==a&&(a="CSV could not be parsed");ViewManager.getView("#importCompetenciesMessageContainer").displayAlert(a,"parseCSV")}function g(a){void 0==a&&(a="Could not connect to server to save framework");
ViewManager.getView("#importCompetenciesMessageContainer").displayAlert(a,"saveFramework")}function p(a){var b=$("#importCsvFile")[0].files[0];CSVImport.analyzeFile(b,function(b){if(void 0===b.length||0==b.length)ViewManager.getView("#importCompetenciesMessageContainer").displayAlert("CSV could not be parsed","parseCSV"),$("#submitImportCsv").attr("disabled","disabled"),$("#submitImportCsv").off("click"),$(".importCsvRelation").addClass("hide");else{$("#submitImportCsv").removeAttr("disabled");ViewManager.getView("#importCompetenciesMessageContainer").clearAlert("parseCSV");
$("#importCsvColumnName").html("\x3coption index\x3d'-1'\x3eN/A\x3c/option\x3e");$("#importCsvColumnDescription").html("\x3coption index\x3d'-1'\x3eN/A\x3c/option\x3e");$("#importCsvColumnScope").html("\x3coption index\x3d'-1'\x3eN/A\x3c/option\x3e");$("#importCsvColumnId").html("\x3coption index\x3d'-1'\x3eN/A\x3c/option\x3e");for(var c=0;c<b[0].length;c++)$("#importCsvColumnName").append("\x3coption/\x3e").children().last().text(b[0][c]).attr("index",c),$("#importCsvColumnDescription").append("\x3coption/\x3e").children().last().text(b[0][c]).attr("index",
c),$("#importCsvColumnScope").append("\x3coption/\x3e").children().last().text(b[0][c]).attr("index",c),$("#importCsvColumnId").append("\x3coption/\x3e").children().last().text(b[0][c]).attr("index",c),b[0][c].toLowerCase().includes("name")?($("#importCsvColumnName [index\x3d"+c+"]").attr("selected","selected"),ViewManager.getView("#importCompetenciesMessageContainer").displayPrimary("CSV column names atuomatically determined based off of name","csvGuess")):b[0][c].toLowerCase().includes("description")?
($("#importCsvColumnDescription [index\x3d"+c+"]").attr("selected","selected"),ViewManager.getView("#importCompetenciesMessageContainer").displayPrimary("CSV column names atuomatically determined based off of name","csvGuess")):b[0][c].toLowerCase().includes("scope")?($("#importCsvColumnScope [index\x3d"+c+"]").attr("selected","selected"),ViewManager.getView("#importCompetenciesMessageContainer").displayPrimary("CSV column names atuomatically determined based off of name","csvGuess")):b[0][c].toLowerCase().includes("id")&&
($("#importCsvColumnId [index\x3d"+c+"]").attr("selected","selected"),ViewManager.getView("#importCompetenciesMessageContainer").displayPrimary("CSV column names atuomatically determined based off of name","csvGuess"),$(".importCsvRelation").removeClass("hide"));$("#importCsvColumnId").change(function(){void 0!=$("#importCsvColumnId").val()&&-1!=$("#importCsvColumnId").val()&&$(".importCsvRelation").removeClass("hide")});$("#submitImportCsv").on("click",function(b){b.preventDefault();$("#submitImportCsv").attr("disabled",
"disabled");$("#submitImportCsv").find(".fa-spin").removeClass("hide");setTimeout(function(){f(a)},100)})}},h)}function c(){var a=$("#importCsvRelation")[0].files[0];CSVImport.analyzeFile(a,function(a){if(void 0===a.length||0==a.length)ViewManager.getView("#importCompetenciesMessageContainer").displayAlert("CSV could not be parsed","parseCSV"),$("#submitImportCsv").attr("disabled","disabled"),$("#submitImportCsv").off("click");else{$("#submitImportCsv").removeAttr("disabled");ViewManager.getView("#importCompetenciesMessageContainer").clearAlert("parseCSV");
$("#importCsvColumnSource").html("\x3coption index\x3d'-1'\x3eN/A\x3c/option\x3e");$("#importCsvColumnRelationType").html("\x3coption index\x3d'-1'\x3eN/A\x3c/option\x3e");$("#importCsvColumnTarget").html("\x3coption index\x3d'-1'\x3eN/A\x3c/option\x3e");for(var b=0;b<a[0].length;b++)$("#importCsvColumnSource").append("\x3coption/\x3e").children().last().text(a[0][b]).attr("index",b),$("#importCsvColumnRelationType").append("\x3coption/\x3e").children().last().text(a[0][b]).attr("index",b),$("#importCsvColumnTarget").append("\x3coption/\x3e").children().last().text(a[0][b]).attr("index",
b),a[0][b].toLowerCase().includes("source")?($("#importCsvColumnSource [index\x3d"+b+"]").attr("selected","selected"),ViewManager.getView("#importCompetenciesMessageContainer").displayPrimary("CSV column names atuomatically determined based off of name","csvGuess")):a[0][b].toLowerCase().includes("relationtype")?($("#importCsvColumnRelationType [index\x3d"+b+"]").attr("selected","selected"),ViewManager.getView("#importCompetenciesMessageContainer").displayPrimary("CSV column names atuomatically determined based off of name",
"csvGuess")):a[0][b].toLowerCase().includes("target")&&($("#importCsvColumnTarget [index\x3d"+b+"]").attr("selected","selected"),ViewManager.getView("#importCompetenciesMessageContainer").displayPrimary("CSV column names atuomatically determined based off of name","csvGuess"))}},h)}function f(a){var b=!0;void 0==a&&(b=!1,a=u[$("#importLocationSelect").val()]);var c=$("#importCsvFile")[0].files[0],f=$("#importCsvRelation")[0].files[0],d=parseInt($("#importCsvColumnName option:selected").attr("index")),
e=parseInt($("#importCsvColumnDescription option:selected").attr("index")),h=parseInt($("#importCsvColumnScope option:selected").attr("index")),n=parseInt($("#importCsvColumnId option:selected").attr("index")),k=parseInt($("#importCsvColumnSource option:selected").attr("index")),r=parseInt($("#importCsvColumnRelationType option:selected").attr("index")),m=parseInt($("#importCsvColumnTarget option:selected").attr("index"));-1==d?(ViewManager.getView("#importCompetenciesMessageContainer").displayAlert("Must select a column that contains competency names",
"selectName"),$("#submitImportCsv").addClass("alert"),$("#submitImportCsv").attr("disabled","disabled"),$("#importCsvColumnName").change(function(){$("#submitImportCsv").removeClass("alert");$("#submitImportCsv").removeAttr("disabled","disabled")})):(ViewManager.getView("#importCompetenciesMessageContainer").clearAlert("selectName"),CSVImport.importCompetencies(c,AppController.serverController.repoInterface,AppController.identityController.selectedIdentity,d,e,h,n,f,k,r,m,function(c,f){for(var d=
"",e=0;e<c.length;e++){var h=c[e];void 0!=a?a.addCompetency(h.id):(h=h.shortId().split("/"),h=h[h.length-1],0<e&&(d+=" OR "),d+=h)}for(e=0;e<f.length;e++)h=f[e],void 0!=a?a.addRelation(h.id):(h=h.shortId().split("/"),h=h[h.length-1],0<e&&(d+=" OR "),d+=h);if(void 0!=a)if(b){for(e=0;e<c.length;e++)ScreenManager.getCurrentScreen().addCompetency(c[e]);for(e=0;e<f.length;e++)ScreenManager.getCurrentScreen().addRelation(f[e]);ModalManager.showModal(new ConfirmModal(function(){var b=new EcFramework;b.copyFrom(a);
b.save(function(){ScreenManager.getCurrentScreen().showSave();ModalManager.hideModal()},function(a){ScreenManager.getCurrentScreen().errorSaving(a);ModalManager.hideModal()})},"Would you like to save the framework now?","Competencies Added!"))}else a.save(function(){ScreenManager.changeScreen(new FrameworkViewScreen(a));ModalManager.hideModal()},g);else ScreenManager.changeScreen(new CompetencySearchScreen(null,d)),ModalManager.hideModal()},function(a){ViewManager.getView("#csvImportProgressMessageContainer").clearSuccess();
ViewManager.getView("#csvImportProgressMessageContainer").displayAlert(a)},function(a){void 0!=a&&void 0!=a.competencies&&(void 0==a.relations?ViewManager.getView("#csvImportProgressMessageContainer").displaySuccess("Sucessfully imported "+a.competencies+" competencies","competenciesImported"):ViewManager.getView("#csvImportProgressMessageContainer").displaySuccess("Sucessfully imported "+a.relations+" relations","relationsImported"))}))}function a(a){var b=!0;void 0==a&&(b=!1,a=u[$("#importLocationSelect").val()]);
if(void 0==a)ViewManager.getView("#importCompetenciesMessageContainer").displayAlert("Problem finding framework to import to","missingLocationFramework");else{ViewManager.getView("#importCompetenciesMessageContainer").clearAlert("missingLocationFramework");var c=u[$("#importSourceSelect").val()];if(void 0==c)ViewManager.getView("#importCompetenciesMessageContainer").displayAlert("Problem finding framework to import from","missingSourceFramework");else if(ViewManager.getView("#importCompetenciesMessageContainer").clearAlert("missingSourceFramework"),
void 0==c.competency||0==c.competency.length)ViewManager.getView("#importCompetenciesMessageContainer").displayAlert(c.name+" contains no competencies","missingSourceFrameworkCompetencies"),$("#submitImportFramework").addClass("alert"),$("#submitImportFramework").attr("disabled","disabled"),$("#importLocationSelect").change(function(){$("#submitImportFramework").removeClass("alert");$("#submitImportFramework").removeAttr("disabled","disabled")});else{ViewManager.getView("#importCompetenciesMessageContainer").clearAlert("missingSourceFrameworkCompetencies");
var f=$("#copySwitch").is(":checked");FrameworkImport.importCompetencies(c,a,f,AppController.serverController.selectedServerUrl,AppController.identityController.selectedIdentity,function(c,f){if(b){for(var d=0;d<c.length;d++)ScreenManager.getCurrentScreen().addCompetency(c[d]);for(d=0;d<f.length;d++)ScreenManager.getCurrentScreen().addRelation(f[d])}else ScreenManager.changeScreen(new FrameworkViewScreen(a));ModalManager.hideModal()},function(a){ViewManager.getView("#importCompetenciesMessageContainer").displayAlert(a)})}}}
function m(a){var b=function(){$("#submitImportMedbiq").attr("disabled","disabled");$("#submitImportMedbiq").find(".fa-spin").removeClass("hide");setTimeout(function(){q(a)},100)},c=$("#importMedbiqFile")[0].files[0];$("#medbiqImportProgress").text("");$("#medbiqAnalyzeProgress").removeClass("hide");MedbiqImport.analyzeFile(c,function(a){$("#medbiqAnalyzeProgress").addClass("hide");0==a.length?(ViewManager.getView("#importCompetenciesMessageContainer").displayAlert("No Competencies Found to Import",
"noCompetencies"),$("#submitImportMedbiq").addAttr("disabled"),$("#submitImportMedbiq").off("click",b)):(ViewManager.getView("#importCompetenciesMessageContainer").clearAlert("noCompetencies"),$("#medbiqImportProgress").text(Object.keys(a).length+" competencies detected. Press import to finish."),$("#submitImportMedbiq").removeAttr("disabled"),$("#submitImportMedbiq").on("click",b))},function(a){ViewManager.getView("#importCompetenciesMessageContainer").displayAlert(a)})}function q(a){var b=!0;void 0==
a&&(b=!1,a=u[$("#importLocationSelect").val()]);MedbiqImport.importCompetencies(AppController.serverController.selectedServerUrl,AppController.identityController.selectedIdentity,function(c){for(var f="",d=0;d<c.length;d++)if(null!=a)a.addCompetency(c[d].id);else{var e=c[d].shortId().split("/"),e=e[e.length-1];0<d&&(f+=" OR ");f+=e}if(null!=a)if(b)for(d=0;d<c.length;d++)ScreenManager.getCurrentScreen().addCompetency(c[d]);else a.save(function(){ScreenManager.changeScreen(new FrameworkViewScreen(a))},
g);else ScreenManager.changeScreen(new CompetencySearchScreen(null,f));ModalManager.hideModal()},function(a){ViewManager.getView("#importCompetenciesMessageContainer").displayAlert(a);ViewManager.getView("#importCompetenciesMessageContainer").clearSuccess()},function(a){void 0!=a&&void 0!=a.competencies&&ViewManager.getView("#importCompetenciesMessageContainer").displaySuccess("Sucessfully imported "+a.competencies+" competencies","competenciesImported")})}function n(a){var b=function(){$("#submitImportASN").attr("disabled",
"disabled");$("#submitImportASN").find(".fa-spin").removeClass("hide");setTimeout(function(){r(a)},100)},c=$("#importASNFile")[0].files[0];$("#asnImportProgress").text("");$("#asnAnalyzeProgress").removeClass("hide");ASNImport.analyzeFile(c,function(a){$("#asnAnalyzeProgress").addClass("hide");0==a.length?(ViewManager.getView("#importCompetenciesMessageContainer").displayAlert("No Competencies Found to Import","noCompetencies"),$("#submitImportASN").addAttr("disabled"),$("#submitImportASN").off("click",
b)):(ViewManager.getView("#importCompetenciesMessageContainer").clearAlert("noCompetencies"),$("#asnImportProgress").text(Object.keys(a).length+" competencies detected. Press import to finish."),$("#submitImportASN").removeAttr("disabled"),$("#submitImportASN").on("click",b))},function(a){ViewManager.getView("#importCompetenciesMessageContainer").displayAlert(a)})}function r(a){var b=!0;void 0==a&&(b=!1,a=u[$("#importLocationSelect").val()]);var c=$("#createFrameworkSwitch").is(":checked");ASNImport.importCompetencies(AppController.serverController.selectedServerUrl,
AppController.identityController.selectedIdentity,c,function(c,f){for(var d="",e=0;e<c.length;e++)if(null!=a)a.addCompetency(c[e].id);else{var h=c[e].shortId().split("/"),h=h[h.length-1];0<e&&(d+=" OR ");d+=h}if(null!=a)if(b)for(e=0;e<c.length;e++)ScreenManager.getCurrentScreen().addCompetency(c[e]);else a.save(function(){ScreenManager.changeScreen(new FrameworkViewScreen(a))},g);else null!=f?ScreenManager.changeScreen(new FrameworkViewScreen(f)):ScreenManager.changeScreen(new CompetencySearchScreen(null,
d));ModalManager.hideModal()},function(a){ViewManager.getView("#importCompetenciesMessageContainer").displayAlert(a);ViewManager.getView("#importCompetenciesMessageContainer").clearSuccess()},function(a){void 0!=a&&void 0!=a.competencies&&(void 0==a.relations?ViewManager.getView("#importCompetenciesMessageContainer").displaySuccess("Sucessfully imported "+a.competencies+" competencies","competenciesImported"):ViewManager.getView("#importCompetenciesMessageContainer").displaySuccess("Sucessfully imported "+
a.relations+" relations","relationsImported"))})}var u={};e.prototype.display=function(f){var g=this.data;ViewManager.showView(new MessageContainer("csvImportProgress"),"#csvImportProgressMessageContainer");ViewManager.showView(new MessageContainer("importCompetencies"),"#importCompetenciesMessageContainer",function(){void 0==AppController.identityController.selectedIdentity&&ViewManager.getView("#importCompetenciesMessageContainer").displayWarning("Competencies that are imported will be Public and can be modified by anyone",
"noOwner");void 0==g&&ViewManager.getView("#importCompetenciesMessageContainer").displayWarning("No Framework Specified, Competencies will not be attached to any frameworks when imported","noFrameworkSelected")});void 0==g?(EcFramework.search(AppController.serverController.getRepoInterface(),"*",k,b,{ownership:"public"}),EcFramework.search(AppController.serverController.getRepoInterface(),"*",k,b,{ownership:"me"})):($("#selectFramework").removeClass("hide"),l(g),$("#noLocation").removeAttr("selected"),
f=g.shortId().split("/"),f=f[f.length-1],$("#importLocationSelect option[value\x3d"+f+"]").attr("selected","selected"),$("#importLocationSelect").attr("disabled","disabled"));$("#importLocationSelect").change(function(a){""==$("#importLocationSelect").val()?($("#selectFramework").addClass("hide"),$("#frameworkSourceRow").addClass("hide"),ViewManager.getView("#importCompetenciesMessageContainer").displayWarning("No Framework Specified, Competencies will not be attached to any frameworks when imported",
"noFrameworkSelected")):($("#selectFramework").removeClass("hide"),ViewManager.getView("#importCompetenciesMessageContainer").clearWarning("noFrameworkSelected"))});$("#selectCSV").click(function(a){a.preventDefault();$(".sourceRow").addClass("hide");$("#csvSourceRow").removeClass("hide");$("#csvOwnerRow").removeClass("hide");$("#csvActionRow").removeClass("hide");$("#modalContainer").foundation("open")});$("#importCsvRelation").change(function(a){a.preventDefault();0<$("#importCsvFile")[0].files.length?
$("#csvRelationRow").removeClass("hide"):$("#csvRelationRow").addClass("hide")});$("#selectMedbiq").click(function(a){a.preventDefault();$(".sourceRow").addClass("hide");$("#medbiqSourceRow").removeClass("hide");$("#modalContainer").foundation("open")});$("#selectFramework").click(function(c){c.preventDefault();$(".sourceRow").addClass("hide");$("#frameworkSourceRow").removeClass("hide");$("#modalContainer").foundation("open");EcFramework.search(AppController.serverController.getRepoInterface(),"*",
d,b);ViewManager.getView("#importCompetenciesMessageContainer").clearWarning("noOwner");$("#copySwitch").change(function(){$("#copySwitch").is(":checked")?($("#importFrameworkOwner").fadeIn(),void 0==AppController.identityController.selectedIdentity&&ViewManager.getView("#importCompetenciesMessageContainer").displayWarning("Competencies that are copied will be Public and can be modified by anyone","noOwner")):($("#importFrameworkOwner").fadeOut(),ViewManager.getView("#importCompetenciesMessageContainer").clearWarning("noOwner"))});
$("#importSourceSelect").change(function(b){$("#submitImportFramework").removeAttr("disabled");$("#submitImportFramework").click(function(b){b.preventDefault();$("#submitImportFramework").attr("disabled","disabled");$("#submitImportFramework").find(".fa-spin").removeClass("hide");setTimeout(function(){a(g)},100)})})});$("#selectASN").click(function(a){a.preventDefault();$(".sourceRow").addClass("hide");$("#asnSourceRow").removeClass("hide");$("#modalContainer").foundation("open");if(void 0==g){$("#createFrameworkInputs").removeClass("hide");
$("#noCreateFrameworkInputs").addClass("hide");var b=$("\x3coption selected\x3eNew ASN Framework\x3c/option\x3e");$("#createFrameworkSwitch").change(function(){$("#createFrameworkSwitch").is(":checked")?($("#importLocationSelect").attr("disabled","disabled"),$("#importLocationSelect").append(b)):($("#importLocationSelect").removeAttr("disabled"),b.remove())})}else $("#createFrameworkInputs").addClass("hide"),$("#noCreateFrameworkInputs").removeClass("hide")});$("#importASNFile").change(function(){n(g)});
$("#importCsvFile").change(function(){p(g)});$("#importCsvRelation").change(function(){c(g)});$("#importMedbiqFile").change(function(){m(g)});$(".cancelImport").click(function(a){a.preventDefault();ModalManager.hideModal()});$("#newFramework").click(function(){ScreenManager.changeScreen(new FrameworkEditScreen);ModalManager.hideModal()});void 0!=AppController.identityController.selectedIdentity&&(f=AppController.identityController.selectedIdentity.ppk.toPk().toPem(),ViewManager.showView(new IdentityDisplay(f),
"#importCsvCompetenciesOwner"),ViewManager.showView(new IdentityDisplay(f),"#importMedbiqCompetenciesOwner"),ViewManager.showView(new IdentityDisplay(f),"#importAsnCompetenciesOwner"),ViewManager.showView(new IdentityDisplay(f),"#importAsnCompetenciesCreateFrameworkOwner"),ViewManager.showView(new IdentityDisplay(f),"#importFrameworkCompetenciesOwner"))};return e}(ImportCompetenciesModal);
LevelSearchScreen=function(e){function l(g){var e=$("#levelSearchText").val();if(null==e||""==e)e="*";null!=h&&clearTimeout(h);var c=$("#levelSearchOwnership").val(),c=1==c?"public":3==c?"owned":4==c?"me":"all",f;f=void 0==g?k:d;h=setTimeout(function(){var a={};if(1<window.location.hash.split("?").length)for(var d=window.location.hash.split(/[?&]/),h=1;h<d.length;h++){var n=d[h].split("\x3d");2==n.length&&(a[n[0]]=n[1])}"*"!=e&&(a.query=e);"all"!=c&&(a.ownership=c);0<Object.keys(a).length?(ScreenManager.setScreenParameters(a),
ScreenManager.getCurrentScreen().setParams(a)):(ScreenManager.setScreenParameters(null),ScreenManager.getCurrentScreen().clearParams());ViewManager.getView("#levelSearchMessageContainer").clearAlert("searchFail");ViewManager.getView("#levelSearchResults").deselectAll();a={};a.ownership=c;a.size=24;a.start=g;EcLevel.search(AppController.serverController.getRepoInterface(),e,f,b,a)},100)}function k(b){ViewManager.getView("#levelSearchResults").clear();d(b)}function d(b){ViewManager.getView("#menuContainer").showSortBasic();
ViewManager.getView("#menuContainer").showSortByCompetency();ViewManager.getView("#levelSearchResults").populate(b);0==b.length&&0==$("#levelResults-data").first().children().size()?ViewManager.getView("#levelSearchResults").showNoDataMessage():24>b.length?$("#moreSearchResults").addClass("hide"):($("#getMoreResults").click(function(){$("#getMoreResults").addClass("hide");$("#loadingMoreResults").removeClass("hide");runRelationshipSearch($("#levelResults-data .row[data-id]").size())}),$("#getMoreResults").removeClass("hide"),
$("#moreSearchResults").removeClass("hide"),$("#loadingMoreResults").addClass("hide"));h=null}function b(b){void 0==b&&(b="Unable to Connect to Server for Competency Search");ViewManager.getView("#levelSearchMessageContainer").displayAlert(b,"searchFail");ViewManager.getView("#levelSearchResults").showNoDataMessage()}var h=null;e.prototype.display=function(b){b=this.query;var d=this.ownership;ViewManager.showView(new MessageContainer("levelSearch"),"#levelSearchMessageContainer");ViewManager.showView(new DataViewer("levelResults",
{sort:{Competency:function(b,f){if(void 0==b)return!0;b=EcRemoteLinkedData.trimVersionFromUrl(b.competency).split("/");b=b[b.length-1];f=EcRemoteLinkedData.trimVersionFromUrl(f.competency).split("/");f=f[f.length-1];return b>f?-1:1}},clickDataEdit:function(b){ScreenManager.changeScreen(new CompetencyViewScreen({id:b.competency}),function(){ModalManager.showModal(new EditLevelModal(b,function(){ScreenManager.reloadCurrentScreen()}))})},clickDataSelect:function(b,f,a,d){f=$(b.target).closest(".row");
a=f.attr("data-aggregateId");void 0!=a&&(d=f.siblings("[data-aggregateId\x3d'"+a+"']"),$(b.target).is(":checked")?d.find(".datum-select:checked").size()==d.size()?(f.siblings("[data-competencyId\x3d'"+a+"']").find(".datum-select").prop("checked","checked"),f.siblings("[data-competencyId\x3d'"+a+"']").find(".datum-select").prop("indeterminate",!1)):f.siblings("[data-competencyId\x3d'"+a+"']").find(".datum-select").prop("indeterminate",!0):0==d.find(".datum-select:checked").size()?(f.siblings("[data-competencyId\x3d'"+
a+"']").find(".datum-select").removeAttr("checked"),f.siblings("[data-competencyId\x3d'"+a+"']").find(".datum-select").prop("indeterminate",!1)):f.siblings("[data-competencyId\x3d'"+a+"']").find(".datum-select").prop("indeterminate",!0))},moreMenuTools:function(){var b=$("\x3cdiv\x3e\x3c/div\x3e");el=$("\x3cli\x3e\x3cspan\x3e\x3ci class\x3d'fa fa-download'\x3e\x3c/i\x3e Export\x3c/span\x3e\x3c/li\x3e");el.click(function(){var b=ViewManager.getView("#levelSearchResults").getSelected();ModalManager.showModal(new RepoExportModal(b))});
b.append(el);return b.contents()},aggregateDataRows:function(b,f,a){var c;"Competency"==$("#levelSearchResults #levelResults-sortSelect").val()&&void 0!=a.competency?(c=a.competency,EcCompetency.get(c,function(a){var f;c==a.shortId()?f="":(f=c.split("/"),f=f[f.length-1]);var d=a.shortId().split("/"),d=d[d.length-1];""!=f&&(d+="-"+f);b.attr("data-aggregateId",d);var e;0==$("#levelSearchResults .competencyAggregateRow[data-competencyId\x3d"+d+"]").size()?($("#levelSearchResults #levelResults-data").append("\x3cdiv class\x3d'row column competencyAggregateRow' data-competencyId\x3d'"+
d+"'\x3e\x3c/div\x3e"),e=$("#levelSearchResults .competencyAggregateRow[data-competencyId\x3d'"+d+"']"),e.append($("\x3cinput type\x3d'checkbox' class\x3d'datum-select'\x3e\x3c/input\x3e)")),e.on("click",".datum-select",function(a){$(".dataView").find(".datum-select:checked").size()==$("#levelResults-data .row").size()?$(".toggleSelectData").text("Unselect All"):$(".toggleSelectData").text("Select All");if($(a.target).is(":checked")){var b=e.siblings("[data-aggregateId\x3d'"+d+"']");b.addClass("selected");
b.find(".datum-select").prop("checked","checked");var b=ViewManager.getView("#levelSearchResults").getSelected(),c=!0,f;for(f in b){var g=b[f];AppController.identityController.owns(g)||(c=!1)}c?($("#levelResults-menu").find(".fa-group").removeClass("hide"),$("#levelResults-menu").find(".fa-trash").removeClass("hide")):($("#levelResults-menu").find(".fa-group").addClass("hide"),AppController.serverController.getAdmin()||$("#levelResults-menu").find(".fa-trash").addClass("hide"))}else{b=e.siblings("[data-aggregateId\x3d'"+
d+"']");b.removeClass("selected");b.find(".datum-select").removeAttr("checked");b=ViewManager.getView("#levelSearchResults").getSelected();c=!0;for(f in b)g=b[f],AppController.identityController.owns(g)||(c=!1);c&&($("#levelResults-menu").find(".fa-group").removeClass("hide"),$("#levelResults-menu").find(".fa-trash").removeClass("hide"))}$(a.target).closest(".dataView").find(".datum-select").is(":checked")?($(a.target).closest(".dataView").addClass("selecting"),$("#levelResults-menu").is(":visible")||
$("#levelResults-menu").slideDown(),$(".dataViewMenu .dataViewSelected").text($(".dataView").find("[data-id] .datum-select:checked").size())):($(a.target).closest(".dataView").removeClass("selecting"),$("#levelResults-menu").is(":visible")&&$("#levelResults-menu").slideUp())}),e.attr("style","padding:7px 2px;padding-left:30px;background-color:#f3f3f3;cursor:default;"),e.append("\x3cdiv class\x3d'small-9 columns'\x3e\x3c/div\x3e"),e.find(".small-9").append(a.name),""!=f&&e.find(".small-9").append("\x3csmall\x3e(Version:"+
f+")\x3c/small\x3e"),e.append("\x3cdiv class\x3d'small-3 columns'\x3e\x3cdiv class\x3d'rowToolbar'\x3e\x3cspan class\x3d'fa-stack fa-lg dataViewBtn' style\x3d'font-size: 0.45rem;margin-right:.8rem;' title\x3d'Load All Relationships'\x3e\x3ci class\x3d'fa fa-refresh fa-stack-2x' style\x3d'font-size: 3em;top: -4px;'\x3e\x3c/i\x3e\x3ci class\x3d'fa fa-plus fa-stack-1x' style\x3d'top: -2px;'\x3e\x3c/i\x3e\x3c/span\x3e \x3ca style\x3d'color:inherit;'\x3e\x3ci title\x3d'View Competency' class\x3d'fa fa-external-link dataViewBtn' style\x3d'margin-right:1rem;'\x3e\x3c/a\x3e\x3c/i\x3e\x3c/div\x3e\x3c/div\x3e"),
e.find(".fa-stack").click(function(b){b.preventDefault();$(this).find(".fa-plus").hasClass("hide")||($(this).find(".fa-plus").addClass("hide"),$(this).find(".fa-refresh").addClass("fa-spin"),a.levels(AppController.serverController.getRepoInterface(),null,function(a){ViewManager.getView("#levelSearchMessageContainer").displayAlert("Error getting all levels: "+a);e.find(".fa-refresh").removeClass("fa-spin");e.find(".fa-plus").removeClass("hide")},function(a){e.nextAll(".competencyAggregateRow").first().before("\x3cdiv class\x3d'row column loadingRow' style\x3d'text-align:center;padding:7px 2px;font-style:italic;'\x3eLoading...\x3c/div\x3e");
ViewManager.getView("#levelSearchResults").populate(a);e.find(".fa-stack").remove();e.nextAll(".loadingRow").first().remove();e.find(".rowToolbar").css("padding-top","5px")}))}),e.find("a").attr("href","#"+CompetencyViewScreen.prototype.getDisplayName()+"?id\x3d"+c),e.find("a").click(function(b){b.preventDefault();ScreenManager.changeScreen(new CompetencyViewScreen(a));return!1})):e=$("#levelSearchResults .competencyAggregateRow[data-competencyId\x3d'"+d+"']");0<e.nextAll(".competencyAggregateRow").size()?
e.nextAll(".competencyAggregateRow").first().before(b):0<e.nextAll(".row").size()?e.nextAll(".row").last().after(b):e.after(b)},function(a){ViewManager.getView("#levelSearchMessageContainer").displayAlert("Error Retrieving Aggregate Competency: "+a);var c;0==$("#levelSearchResults .competencyAggregateRow[data-competencyId\x3dunknown]").size()?($("#levelSearchResults #levelResults-data").prepend("\x3cdiv class\x3d'row column competencyAggregateRow' data-competencyId\x3d'unknown'\x3e\x3c/div\x3e"),
c=$("#levelSearchResults .competencyAggregateRow[data-competencyId\x3d'unknown']"),c.append($("\x3cinput type\x3d'checkbox' class\x3d'datum-select'\x3e\x3c/input\x3e)")),c.on("click",".datum-select",function(a){$(".dataView").find(".datum-select:checked").size()==$("#levelResults-data .row").size()?$(".toggleSelectData").text("Unselect All"):$(".toggleSelectData").text("Select All");if($(a.target).is(":checked")){var b=c.siblings("[data-aggregateId\x3d'"+shortCompId+"']");b.addClass("selected");b.find(".datum-select").prop("checked",
"checked");var b=ViewManager.getView("#levelSearchResults").getSelected(),f=!0,d;for(d in b){var e=b[d];AppController.identityController.owns(e)||(f=!1)}f?($("#levelResults-menu").find(".fa-group").removeClass("hide"),$("#levelResults-menu").find(".fa-trash").removeClass("hide")):($("#levelResults-menu").find(".fa-group").addClass("hide"),AppController.serverController.getAdmin()||$("#levelResults-menu").find(".fa-trash").addClass("hide"))}else{b=c.siblings("[data-aggregateId\x3d'"+shortCompId+"']");
b.removeClass("selected");b.find(".datum-select").removeAttr("checked");b=ViewManager.getView("#levelSearchResults").getSelected();f=!0;for(d in b)e=b[d],AppController.identityController.owns(e)||(f=!1);f&&($("#levelResults-menu").find(".fa-group").removeClass("hide"),$("#levelResults-menu").find(".fa-trash").removeClass("hide"))}$(a.target).closest(".dataView").find(".datum-select").is(":checked")?($(a.target).closest(".dataView").addClass("selecting"),$("#levelResults-menu").is(":visible")||$("#levelResults-menu").slideDown(),
$(".dataViewMenu .dataViewSelected").text($(".dataView").find("[data-id] .datum-select:checked").size())):($(a.target).closest(".dataView").removeClass("selecting"),$("#levelResults-menu").is(":visible")&&$("#levelResults-menu").slideUp())}),c.attr("style","padding:7px 2px;padding-left:30px;background-color:#f3f3f3;cursor:default;color:#f74646;font-weight:500;"),c.append("\x3cdiv class\x3d'small-12 columns'\x3e\x3c/div\x3e"),c.find(".small-12").append("Unknown Competency")):c=$("#levelSearchResults .competencyAggregateRow[data-competencyId\x3d'unknown']");
0<c.nextAll(".competencyAggregateRow").size()?c.nextAll(".competencyAggregateRow").first().before(b):0<c.nextAll(".row").size()?c.nextAll(".row").last().after(b):c.after(b)})):$("#levelSearchResults #levelResults-data").append(b)},buildDataRow:function(b,f,a){"Competency"==$("#levelSearchResults #levelResults-sortSelect").val()&&void 0!=a.competency?b.append("\x3ca\x3e\x3cdiv class\x3d'small-3 columns datum-title'\x3e\x3c/div\x3e\x3c/a\x3e\x3cdiv class\x3d'small-6 columns datum-description'\x3e\x3c/div\x3e\x3cdiv class\x3d'small-3 columns datum-owner'\x3e\x3c/div\x3e"):
b.append("\x3ca\x3e\x3cdiv class\x3d'small-2 columns end datum-title'\x3e\x3c/div\x3e\x3c/a\x3e\x3cdiv class\x3d'small-4 columns datum-description'\x3e\x3c/div\x3e\x3cdiv class\x3d'small-3 columns datum-competency'\x3e\x3c/div\x3e\x3cdiv class\x3d'small-3 columns datum-owner'\x3e\x3c/div\x3e");if(void 0==a.owner||0==a.owner.length)b.find(".datum-owner").html("Public");else for(var c in a.owner){var d=EcRemoteLinkedData.trimVersionFromUrl(f),e=d.split("/")[d.split("/").length-1]+"-owner-"+c,d=$("\x3cspan id\x3d'"+
e+"'\x3e\x3c/span\x3e");b.find(".datum-owner").append(d);var g=function(){0<$("#"+e).size()?ViewManager.showView(new IdentityDisplay(a.owner[c]),"#"+e):setTimeout(g,500)};setTimeout(g,500)}0<b.find(".datum-competency").size()&&(EcCompetency.get(a.competency,function(a){b.find(".datum-competency").html("on \x3cspan style\x3d'font-style:italic;'\x3e\x3c/span\x3e");b.find(".datum-competency span").text(a.getName())},function(){b.find(".datum-competency").text("Unknown Competency")}),b.find(".datum-competency").text("Loading.."));
void 0!=a.title&&""!=a.title&&b.find(".datum-title").text(a.title);void 0!=a.description&&""!=a.description&&b.find(".datum-description").text(a.description);b.find("a").click(function(b){b.preventDefault();ScreenManager.changeScreen(new CompetencyViewScreen({id:a.competency}),function(){ModalManager.showModal(new EditLevelModal(a,function(){ScreenManager.reloadCurrentScreen()}))})})}}),"#levelSearchResults");$("#levelSearchSubmit").click(function(b){b.preventDefault();l()});$("#levelSearchOwnership").change(function(b){b.preventDefault();
l()});$("#levelSearchText").keypress(function(b){13==b.which&&l()});null!=b&&$("#levelSearchText").val(b);AppController.loginController.getLoggedIn()?($("#levelSearchOwnership").attr("max",4),$("#levelSearchOwnershipLoggedIn").removeClass("hide"),$("#levelSearchOwnershipPublic").addClass("hide")):($("#levelSearchOwnershipLoggedIn").addClass("hide"),$("#levelSearchOwnershipPublic").removeClass("hide"));null!=d&&("public"==d?d=1:"owned"==d?d=3:"me"==d&&(d=4),$("#levelSearchOwnership").val(d));l();ViewManager.getView("#menuContainer").showSortBasic();
ViewManager.getView("#menuContainer").showSortByCompetency()};e.prototype.onClose=function(){ViewManager.getView("#menuContainer").hideSort()};e.prototype.sortByTimestamp=function(){$("#levelResults-sortSelect").val("timestamp");$("#levelResults-sortSelect").trigger("change")};e.prototype.sortByOwner=function(){$("#levelResults-sortSelect").val("owner");$("#levelResults-sortSelect").trigger("change")};e.prototype.filterPublic=function(){$("#levelSearchOwnership").val(1);l()};e.prototype.filterAll=
function(){$("#levelSearchOwnership").val(2);l()};e.prototype.filterOwned=function(){$("#levelSearchOwnership").val(3);l()};e.prototype.filterOwnedByMe=function(){AppController.loginController.getLoggedIn()&&($("#levelSearchOwnership").val(4),runRepoSearch())};e.prototype.setParams=function(b){void 0==b?this.clearParams():(this.query=b.query,this.ownership=b.ownership)};e.prototype.clearParams=function(){this.ownership=this.query=void 0};return e}(LevelSearchScreen);
var LoginModal=function(e){e.prototype.display=function(l){var k=this,d=this.warning;ViewManager.showView(new MessageContainer("login"),"#loginMessageContainer",function(){void 0!=d&&ViewManager.getView("#loginMessageContainer").displayWarning(d)});0<$(AppController.serverController.serverList).size()&&$("#loginServer").html("");for(var b in AppController.serverController.serverList){l=AppController.serverController.serverList[b];var h=$("\x3coption\x3e\x3c/option\x3e");h.attr("value",l);h.text(b);
b==AppController.serverController.selectedServerName&&h.attr("selected","selected");$("#loginServer").append(h)}$("#loginAddServer").click(function(){ModalManager.showModal(new AddServerModal(function(){ModalManager.showModal(new e)}))});$("#loginCreateAccount").click(function(){ModalManager.showModal(new CreateUserModal)});$("#loginForm").submit(function(b){b.preventDefault();b=$("#loginServer").val();var d=$("#loginUserId").val(),c=$("#loginPassword").val();k.submitLogin(d,c,b)});$("#loginCancel").click(function(b){b.preventDefault();
ModalManager.hideModal()});$("#loginOauth2Google").click(function(b){b.preventDefault();k.submitOauth2("google")});new OAuth2FileBasedRemoteIdentityManager(function(){$("#oauth").show()})};return e}(LoginModal),MessageContainer=function(e){function l(b,d,e){var g=$(e);g.attr("style","");g.removeClass("hide");d=void 0!=d?d:b;e=$(e+"Messages");e.find("[data-msg\x3d'"+d+"']").remove();g=$("\x3cdiv\x3e\x3c/div\x3e");g.attr("data-msg",d);g.text(b);e.append(g)}function k(b,e){var g=$(b+"Messages");void 0==
e||1==g.find("[data-msg]").size()&&1==g.find("[data-msg\x3d'"+e+"']").size()?d(b,function(){g.html("")}):g.find("[data-msg\x3d'"+e+"']").remove()}function d(b,d){var e=$(b);e.fadeOut({complete:function(){e.addClass("hide");e.attr("style","");void 0!=d&&d()}})}e.prototype.display=function(b){var e=this.prefix,g=this.closeMessageCallback;$(b).find("[id]").each(function(b,c){$(c).attr("id",e+"-"+$(c).attr("id"))});$(b).find(".messageContainer").each(function(b,c){$(c).find("button").click(function(){d("#"+
$(c).attr("id"),g)})})};e.prototype.displayAlert=function(b,d){l(b,d,"#"+this.prefix+"-alertbox")};e.prototype.displayWarning=function(b,d){l(b,d,"#"+this.prefix+"-warningbox")};e.prototype.displaySuccess=function(b,d){l(b,d,"#"+this.prefix+"-successbox")};e.prototype.displayPrimary=function(b,d){l(b,d,"#"+this.prefix+"-primarybox")};e.prototype.displaySecondary=function(b,d){l(b,d,"#"+this.prefix+"-secondarybox")};e.prototype.clearAlert=function(b){k("#"+this.prefix+"-alertbox",b)};e.prototype.clearWarning=
function(b){k("#"+this.prefix+"-warningbox",b)};e.prototype.clearSuccess=function(b){k("#"+this.prefix+"-successbox",b)};e.prototype.clearPrimary=function(b){k("#"+this.prefix+"-primarybox",b)};e.prototype.clearSecondary=function(b){k("#"+this.prefix+"-secondarybox",b)};e.prototype.hideAlert=function(){d("#"+this.prefix+"-alertbox")};e.prototype.hideWarning=function(b,e){d("#"+this.prefix+"-warningbox")};e.prototype.hideSuccess=function(b,e){d("#"+this.prefix+"-successbox")};e.prototype.hidePrimary=
function(b,e){d("#"+this.prefix+"-primarybox")};e.prototype.hideSecondary=function(b,e){d("#"+this.prefix+"-secondarybox")};return e}(MessageContainer),MessageModal=function(e){e.prototype.display=function(e){var k=this.okCallback;$("#messageHeader").html(this.header);$("#messageText").html(this.message);if(""==this.message||void 0==this.message)$("#messageText").css("margin-bottom","0px"),$("#okBtn").css("margin-top","0px");$("#okBtn").click(function(d){void 0!=k&&k();ModalManager.hideModal()})};
return e}(MessageModal),PermissionPropagationModal=function(e){function l(b){var e=!0,g=$("\x3cdiv class\x3d'row columns'\x3e\x3c/div\x3e");g.append("\x3cdiv id\x3d'resultsList' class\x3d'row' style\x3d'border: 1px solid lightgrey; overflow-y:scroll;padding:0.3rem;height:8rem;'\x3e\x3c/div\x3e");$("#propagateResultsDisplay").append(g);if(void 0!=b.competency&&0<b.competency.length){$("#resultsList").append("\x3cdiv id\x3d'competencyOptGroup' class\x3d'small-12 columns'\x3e\x3cspan class\x3d'prefix'\x3eCompetencies\x3c/span\x3e\x3c/div\x3e");
for(var k in b.competency)e=!1,EcCompetency.get(b.competency[k],function(b){var c=$("\x3cdiv class\x3d'row'\x3e\x3c/div\x3e"),a=$("\x3cdiv class\x3d'small-1 columns'\x3e\x3c/div\x3e");AppController.identityController.owns(b)?(a.prepend("\x3ci class\x3d'fa fa-check' style\x3d'color:lightgreen;margin-top:0.25rem;'\x3e\x3c/i\x3e"),c.attr("title","Permissions will be changed to match")):AppController.identityController.canEdit(b)?(a.prepend("\x3ci class\x3d'fa fa-minus' style\x3d'color:lightblue;margin-top:0.25rem;'\x3e\x3c/i\x3e"),
c.attr("title","Publicly owned, permissions will remain unchanged, but still editable by anyone"),ViewManager.getView("#propagateMessageContainer").displayPrimary("One or more of the objects contained is publicly owned and permissions will not be affected","publicObject")):(a.prepend("\x3ci class\x3d'fa fa-times' style\x3d'color:red;margin-top:0.25rem;'\x3e\x3c/i\x3e"),c.attr("title","Not owned by you, cannot change permissions"),ViewManager.getView("#propagateMessageContainer").displayAlert("You are not allowed to modify the permissions on one or more of the objects contained",
"noPropagation"));c.append(a);a=$("\x3cdiv class\x3d'small-11 columns'\x3e\x3c/div\x3e");a.text(b.name);c.append(a);$("#competencyOptGroup").append(c)},function(b){d(b)})}if(void 0!=b.relation&&0<b.relation.length)for(k in $("#resultsList").append("\x3cdiv id\x3d'relationsOptGroup' class\x3d'small-12 columns'\x3e\x3cspan class\x3d'prefix'\x3eRelationships\x3c/span\x3e\x3c/div\x3e"),b.relation)e=!1,EcAlignment.get(b.relation[k],function(b){EcCompetency.get(b.source,function(c){EcCompetency.get(b.target,
function(a){var f=$("\x3cdiv class\x3d'row'\x3e\x3c/div\x3e"),d=$("\x3cdiv class\x3d'small-1 columns'\x3e\x3c/div\x3e");AppController.identityController.owns(b)?(d.prepend("\x3ci class\x3d'fa fa-check' style\x3d'color:lightgreen;margin-top:0.25rem;'\x3e\x3c/i\x3e"),f.attr("title","Permissions will be changed to match")):AppController.identityController.canEdit(b)?(d.prepend("\x3ci class\x3d'fa fa-minus' style\x3d'color:lightblue;margin-top:0.25rem;'\x3e\x3c/i\x3e"),f.attr("title","Publicly owned, permissions will remain unchanged, but still editable by anyone"),
ViewManager.getView("#propagateMessageContainer").displayPrimary("One or more of the objects contained is publicly owned and permissions will not be affected","publicObject")):(d.prepend("\x3ci class\x3d'fa fa-times' style\x3d'color:red;margin-top:0.25rem;'\x3e\x3c/i\x3e"),f.attr("title","Not owned by you, cannot change permissions"),ViewManager.getView("#propagateMessageContainer").displayAlert("You are not allowed to modify the permissions on one or more of the objects contained","noPropagation"));
f.append(d);d=AppSettings.relationTypes[b.relationType];void 0==d&&(d=b.relationType.split(/(?=[A-Z])/).join(" "));var e=$("\x3cdiv class\x3d'small-11 columns'\x3e\x3c/div\x3e");e.text(c.name+" "+d+" "+a.name);f.append(e);$("#relationsOptGroup").append(f)},function(a){d(a)})},function(b){d(b)})},function(b){d(b)});if(void 0!=b.level&&0<b.level.length)for(k in $("#resultsList").append("\x3cdiv id\x3d'levelsOptGroup' class\x3d'small-12 columns'\x3e\x3cspan class\x3d'prefix'\x3eLevels\x3c/span\x3e\x3c/div\x3e"),
b.level)e=!1,EcLevel.get(b.level[k],function(b){EcCompetency.get(b.competency,function(c){var a=$("\x3cdiv class\x3d'row'\x3e\x3c/div\x3e"),f=$("\x3cdiv class\x3d'small-1 columns'\x3e\x3c/div\x3e");AppController.identityController.owns(b)?(f.prepend("\x3ci class\x3d'fa fa-check' style\x3d'color:lightgreen;margin-top:0.25rem;'\x3e\x3c/i\x3e"),a.attr("title","Permissions will be changed to match")):AppController.identityController.canEdit(b)?(f.prepend("\x3ci class\x3d'fa fa-minus' style\x3d'color:lightblue;margin-top:0.25rem;'\x3e\x3c/i\x3e"),
a.attr("title","Publicly owned, permissions will remain unchanged, but still editable by anyone"),ViewManager.getView("#propagateMessageContainer").displayPrimary("One or more of the objects contained is publicly owned and permissions will not be affected","publicObject")):(f.prepend("\x3ci class\x3d'fa fa-times' style\x3d'color:red;margin-top:0.25rem;'\x3e\x3c/i\x3e"),a.attr("title","Not owned by you, cannot change permissions"),ViewManager.getView("#propagateMessageContainer").displayAlert("You are not allowed to modify the permissions on one or more of the objects contained",
"noPropagation"));a.append(f);f=$("\x3cdiv class\x3d'small-11 columns'\x3e\x3c/div\x3e");f.text(c.name+" : "+b.name);a.append(f);$("#levelsOptGroup").append(a)},function(b){d(b)})},function(b){d(b)});if(void 0!=b.rollupRule&&0<b.rollupRule.length)for(k in $("#resultsList").append("\x3cdiv id\x3d'rulesOptGroup' class\x3d'small-12 columns'\x3e\x3cspan class\x3d'prefix'\x3eRollup Rules\x3c/span\x3e\x3c/div\x3e"),b.rollupRule)e=!1,EcRollupRule.get(b.rollupRule[k],function(b){EcCompetency.get(b.competency,
function(c){var a=$("\x3cdiv class\x3d'row'\x3e\x3c/div\x3e"),f=$("\x3cdiv class\x3d'small-1 columns'\x3e\x3c/div\x3e");AppController.identityController.owns(b)?(f.prepend("\x3ci class\x3d'fa fa-check' style\x3d'color:lightgreen;margin-top:0.25rem;'\x3e\x3c/i\x3e"),a.attr("title","Permissions will be changed to match")):AppController.identityController.canEdit(b)?(f.prepend("\x3ci class\x3d'fa fa-minus' style\x3d'color:lightblue;margin-top:0.25rem;'\x3e\x3c/i\x3e"),a.attr("title","Publicly owned, permissions will remain unchanged, but still editable by anyone"),
ViewManager.getView("#propagateMessageContainer").displayPrimary("One or more of the objects contained is publicly owned and permissions will not be affected","publicObject")):(f.prepend("\x3ci class\x3d'fa fa-times' style\x3d'color:red;margin-top:0.25rem;'\x3e\x3c/i\x3e"),a.attr("title","Not owned by you, cannot change permissions"),ViewManager.getView("#propagateMessageContainer").displayAlert("You are not allowed to modify the permissions on one or more of the objects contained","noPropagation"));
a.append(f);f=$("\x3cdiv class\x3d'small-11 columns'\x3e\x3c/div\x3e");f.text(c.name+" : "+b.name);a.append(f);$("#rulesOptGroup").append(a)},function(b){d(b)})},function(b){d(b)});e&&setTimeout(function(){ModalManager.hideModal()},100)}function k(b){var d=0,e={},k={},c=0;if(void 0!=b.competency&&0<b.competency.length){var d=d+b.competency.length,f;for(f in b.competency)EcCompetency.get(b.competency[f],function(a){if(AppController.identityController.owns(a)){var f=new EcRemoteLinkedData;f.copyFrom(a);
k[a.id]=EcEncryptedValue.encryptOnSave(a.id);a.owner=b.owner;EcEncryptedValue.encryptOnSave(a.id,EcEncryptedValue.encryptOnSave(b.id));a.reader=b.reader;0==c&&a.save(function(){if(0==c)e[a.id]=f,Object.keys(e).length==d?(ModalManager.hideModal(),ScreenManager.getCurrentScreen().displaySuccess("Successfully propagated changes to referenced objects")):ViewManager.getView("#propagateProgressMessageContainer").displaySuccess(d+" objects saved","saved");else{a.owner=f.owner;a.reader=f.reader;EcEncryptedValue.encryptOnSave(a.id,
k[a.id]);a.save(function(){delete e[a.id];Object.keys(e)},function(){delete e[a.id];Object.keys(e)});for(var b in e);}},function(){c++;ViewManager.getView("#propagateProgressMessageContainer").displaySuccess(d+" objects failed","failed")})}else d--})}if(void 0!=b.relation&&0<b.relation.length)for(f in d+=b.relation.length,b.relation)EcAlignment.get(b.relation[f],function(a){if(AppController.identityController.owns(a)){var f=new EcRemoteLinkedData;f.copyFrom(a);k[a.id]=EcEncryptedValue.encryptOnSave(a.id);
a.owner=b.owner;EcEncryptedValue.encryptOnSave(a.id,EcEncryptedValue.encryptOnSave(b.id));a.reader=b.reader;0==c&&a.save(function(){if(0==c)e[a.id]=f,Object.keys(e).length==d?(ModalManager.hideModal(),ScreenManager.getCurrentScreen().displaySuccess("Successfully propagated changes to referenced objects")):ViewManager.getView("#propagateProgressMessageContainer").displaySuccess(d+" objects saved","saved");else{a.owner=f.owner;a.reader=f.reader;EcEncryptedValue.encryptOnSave(a.id,k[a.id]);a.save(function(){delete e[a.id];
Object.keys(e)},function(){delete e[a.id];Object.keys(e)});for(var b in e);}},function(){c++;ViewManager.getView("#propagateProgressMessageContainer").displaySuccess(d+" objects failed","failed")})}else d--});if(void 0!=b.level&&0<b.level.length)for(f in d+=b.level.length,b.level)EcLevel.get(b.level[f],function(a){if(AppController.identityController.owns(a)){var f=new EcRemoteLinkedData;f.copyFrom(a);k[a.id]=EcEncryptedValue.encryptOnSave(a.id);a.owner=b.owner;EcEncryptedValue.encryptOnSave(a.id,
EcEncryptedValue.encryptOnSave(b.id));a.reader=b.reader;0==c&&a.save(function(){if(0==c)e[a.id]=f,Object.keys(e).length==d?(ModalManager.hideModal(),ScreenManager.getCurrentScreen().displaySuccess("Successfully propagated changes to referenced objects")):ViewManager.getView("#propagateProgressMessageContainer").displaySuccess(d+" objects saved","saved");else{a.owner=f.owner;a.reader=f.reader;EcEncryptedValue.encryptOnSave(a.id,k[a.id]);a.save(function(){delete e[a.id];Object.keys(e)},function(){delete e[a.id];
Object.keys(e)});for(var b in e);}},function(){c++;ViewManager.getView("#propagateProgressMessageContainer").displaySuccess(d+" objects failed","failed")})}else d--});if(void 0!=b.rollupRule&&0<b.rollupRule.length)for(f in d+=b.rollupRule.length,b.rollupRule)EcRollupRule.get(b.rollupRule[f],function(a){if(AppController.identityController.owns(a)){var f=new EcRemoteLinkedData;f.copyFrom(a);k[a.id]=EcEncryptedValue.encryptOnSave(a.id);a.owner=b.owner;EcEncryptedValue.encryptOnSave(a.id,EcEncryptedValue.encryptOnSave(b.id));
a.reader=b.reader;0==c&&a.save(function(){if(0==c)e[a.id]=f,Object.keys(e).length==d?(ModalManager.hideModal(),ScreenManager.getCurrentScreen().displaySuccess("Successfully propagated changes to referenced objects")):ViewManager.getView("#propagateProgressMessageContainer").displaySuccess(d+" objects saved","saved");else{ViewManager.getView("#propagateMessageContainer").displayAlert("Failed to Propagate. Tried rolling back changes..","rollback");a.owner=f[a.id].owner;a.reader=f[a.id].reader;EcEncryptedValue.encryptOnSave(a.id,
k[a.id]);a.save(function(){},function(){ViewManager.getView("#propagateMessageContainer").displayAlert("Failed to Propagate. Failed to roll back.","rollback")});for(var b in e)EcRepository.get(b,function(a){a.owner=f[a.id].owner;a.reader=f[a.id].reader;EcEncryptedValue.encryptOnSave(a.id,k[a.id]);a.save(function(){delete e[a.id];0==Object.keys(e).length&&ViewManager.getView("#propagateMessageContainer").displaySuccess("Successfully rolled back propagation")},function(){delete e[a.id];0==Object.keys(e).length&&
ViewManager.getView("#propagateMessageContainer").displaySuccess("Successfully rolled back propagation")})},function(){ViewManager.getView("#propagateMessageContainer").displayAlert("Failed to Propagate. Failed to roll back.","rollback")})}},function(){c++;ViewManager.getView("#propagateProgressMessageContainer").displaySuccess(d+" objects failed","failed")})}else d--})}function d(b){ViewManager.getView("#propagateMessageContainer").displayAlert(b)}e.prototype.display=function(b){var d=this.data,
e=this.onCancel;ViewManager.showView(new MessageContainer("propagate"),"#propagateMessageContainer");ViewManager.showView(new MessageContainer("propagateProgress"),"#propagateProgressMessageContainer");$("#propagateConfirmBtn").click(function(b){b=!0;null==d.owner||0==d.owner.length?b=confirm("Are you sure that you would like to make all of these objects public?"):AppController.identityController.owns(d)||(b=confirm("Are you sure that you would like to remove your ownership from all of these objects?"));
b&&d.isAny((new EcFramework).getTypes())&&k(d)});$("#propagateCancelBtn").click(function(b){ModalManager.hideModal();void 0!=e&&e()});this.data.isAny((new EcFramework).getTypes())&&l(this.data)};return e}(PermissionPropagationModal);
RelationshipEditScreen=function(e){function l(a){$("#relationEditSource").html("\x3coption selected disabled\x3d'disabled' class\x3d'hide'\x3eSelect Source Competency\x3c/option\x3e");$("#relationEditTarget").html("\x3coption selected disabled\x3d'disabled' class\x3d'hide'\x3eSelect Target Competency\x3c/option\x3e");for(var b=0;b<a.length;b++){var c=a[b];$("#relationEditSource").append("\x3coption/\x3e");$("#relationEditSource").children("option").last().attr("value",EcRemoteLinkedData.trimVersionFromUrl(c.id)).text(c.getName());
$("#relationEditTarget").append("\x3coption/\x3e");$("#relationEditTarget").children("option").last().attr("value",EcRemoteLinkedData.trimVersionFromUrl(c.id)).text(c.getName());null!=q&&(c.isId(q.source)&&($("#relationEditSource").children("option").last().attr("selected",!0),k()),c.isId(q.target)&&($("#relationEditTarget").children("option").last().attr("selected",!0),d()))}}function k(){ViewManager.getView("#relationshipEditMessageContainer").clearAlert("populateFail");EcCompetency.get($("#relationEditSource option:selected").attr("value"),
b,c)}function d(){ViewManager.getView("#relationshipEditMessageContainer").clearAlert("populateFail");EcCompetency.get($("#relationEditTarget option:selected").attr("value"),h,c)}function b(a){$("#relationEditSourceId").val(a.shortId());$("#relationEditSourceName").val(a.getName());$("#relationEditSourceDescription").val(a.getDescription());$("#relationEditSourceScope").val(a.scope)}function h(a){$("#relationEditTargetId").val(a.shortId());$("#relationEditTargetName").val(a.getName());$("#relationEditTargetDescription").val(a.getDescription());
$("#relationEditTargetScope").val(a.scope)}function g(a){$(".topLevel").hide();q=a;for(var b in AppSettings.relationTypes)$("#relationEditType").append("\x3coption value\x3d'"+b+"'\x3e"+AppSettings.relationTypes[b]+"\x3c/option\x3e");null!=a&&null!=a.relationType&&""!=a.relationType&&(b=$("#relationEditType option[value\x3d'"+a.relationType+"']"),0<b.size()?b.attr("selected","selected"):(b=a.relationType.split(/(?=[A-Z])/).join(" "),$("#relationEditType").append("\x3coption value\x3d'"+a.relationType+
"'\x3e"+b+"\x3c/option\x3e")));$("#relationEditId").val(a.id);$("#relationEditName").val(a.name);$("#relationEditDescription").val(a.description);$("#relationEditor").show();p();if(void 0!=a.owner&&0<a.owner.length)for($("#relationEditOwner").html(""),b=0;b<a.owner.length;b++){0<b&&$("#relationEditOwner").append(", ");var c=a.owner[b];$("#relationEditOwner").append("\x3cspan id\x3d'relation-owner-"+b+"'\x3e\x3c/span\x3e");ViewManager.showView(new IdentityDisplay(c),"#relation-owner-"+b)}else $("#relationEditOwner").text("Public"),
$("#relationEditOwnerAdvanced").hide();if(EcEncryptedValue.encryptOnSave(a.id))if("none"==$("#privateRow").css("display")&&$("#privateRow").slideDown(),void 0!=a.reader&&0!=a.reader.length)for($("#relationEditNoReaders").addClass("hide"),$("#relationEditReaders").html(""),b=0;b<a.reader.length;b++)c=a.reader[b],$("#relationEditReaders").append("\x3cspan id\x3d'relation-reader-'"+b+"\x3e\x3c/span\x3e"),ViewManager.showView(new IdentityDisplay(c),"#relation-reader-"+b),b<a.reader.length-1&&$("#relationEditReaders").append(", ");
else $("#relationEditNoReaders").removeClass("hide");else"none"!=$("#privateRow").css("display")&&$("#privateRow").slideUp()}function p(){ViewManager.getView("#relationshipEditMessageContainer").clearAlert("competencyFindFail");EcCompetency.search(AppController.serverController.getRepoInterface(),"*",l,f)}function c(a){void 0==a&&(a="Unable to Connect to Server to Populate Competency Details");ViewManager.getView("#relationshipEditMessageContainer").displayAlert(a,"populateFail")}function f(a){void 0==
a&&(a="Unable to Connect to Server to Retrieve List of Competencies");ViewManager.getView("#relationshipEditMessageContainer").displayAlert(a,"competencyFindFail")}function a(a){void 0==a&&(a="Unable to Connect to Server to Save Relationship");ViewManager.getView("#relationshipEditMessageContainer").displayAlert(a,"saveFail")}function m(a){void 0==a&&(a="Unable to Connect to Server to Retrieve Relationship");ViewManager.getView("#relationshipEditMessageContainer").displayAlert(a)}var q=null;e.prototype.display=
function(b){var c=this.data;void 0!=c&&void 0!=c.id?ScreenManager.setScreenParameters({id:c.id}):void 0!=c&&void 0!=c.source?ScreenManager.setScreenParameters({source:c.source}):void 0!=c&&void 0!=c.target&&ScreenManager.setScreenParameters({target:c.target});ViewManager.showView(new MessageContainer("relationshipEdit"),"#relationshipEditMessageContainer",function(){"_New Relation"==c.name&&void 0==AppController.identityController.selectedIdentity&&ViewManager.getView("#relationshipEditMessageContainer").displayWarning("You are Creating a Public Relationship, this relationship can be modified by anyone")});
void 0!=c&&void 0!=c.id?EcAlignment.get(c.id,function(a){c=a;g(c)},m):(void 0!=c&&void 0!=c.source?(b=c.source,c=new EcAlignment,c.generateId(AppController.serverController.getRepoInterface().selectedServer),c.name="",c.source=b):void 0!=c&&void 0!=c.target?(b=c.target,c=new EcAlignment,c.generateId(AppController.serverController.getRepoInterface().selectedServer),c.name="",c.target=b):(c=new EcAlignment,c.generateId(AppController.serverController.getRepoInterface().selectedServer),c.name=""),void 0!=
AppController.identityController.selectedIdentity&&c.addOwner(AppController.identityController.selectedIdentity.ppk.toPk()),g(c));p();$("#relationEditSource").change(k);$("#relationEditTarget").change(d);$("#relationshipEditCancelBtn").click(function(a){a.preventDefault();ScreenManager.changeScreen(new RelationshipViewScreen(c))});""==c.name?$("#relationshipEditDeleteBtn").remove():$("#relationshipEditDeleteBtn").click(function(a){a.preventDefault();ModalManager.showModal(new ConfirmModal(function(){c._delete(function(){ScreenManager.changeScreen(new RelationshipSearchScreen)},
function(a){void 0==a&&(a="Unable to connect to server to delete relationship");ViewManager.getView("#relationshipEditMessageContainer").displayAlert(a)});ModalManager.hideModal()},"Are you sure you want to delete this relationship?"))});$("#relationshipEditSaveBtn").click(function(b){b.preventDefault();b=$("#relationEditName").val();c.source=$("#relationEditSource option:selected").val();""==c.source?ViewManager.getView("#relationshipEditMessageContainer").displayAlert("Cannot Create Relation without Source Competency Specified"):
(c.target=$("#relationEditTarget option:selected").val(),""==c.target?ViewManager.getView("#relationshipEditMessageContainer").displayAlert("Cannot Create Relation without Target Competency Specified"):(c.name=b,c.description=$("#relationEditDescription").val(),c.relationType=$("#relationEditType option:selected").attr("value"),ViewManager.getView("#relationshipEditMessageContainer").clearAlert("saveFail"),q.save(function(){EcCompetency.get(c.source,function(a){ScreenManager.changeScreen(new RelationshipViewScreen(q))})},
a)))});$("#relationEditOwnerAdvanced").click(function(a){a.preventDefault();c.name=$("#relationEditName").val();c.description=$("#relationEditDescription").val();ModalManager.showModal(new AdvancedPermissionsModal(c,function(a){c.owner=a.owner;c.reader=a.reader;g(c);ModalManager.hideModal()}))})};return e}(RelationshipEditScreen);
RelationshipSearchScreen=function(e){function l(e){var c=$("#relationshipSearchText").val();if(null==c||""==c)c="*";null!=g&&clearTimeout(g);var f=$("#relationshipSearchOwnership").val(),f=1==f?"public":3==f?"owned":4==f?"me":"all",a;a=void 0==e?k:d;g=setTimeout(function(){var d={};if(1<window.location.hash.split("?").length)for(var g=window.location.hash.split(/[?&]/),h=1;h<g.length;h++){var k=g[h].split("\x3d");2==k.length&&(d[k[0]]=k[1])}"*"!=c&&(d.query=c);"all"!=f&&(d.ownership=f);0<Object.keys(d).length?
(ScreenManager.setScreenParameters(d),ScreenManager.getCurrentScreen().setParams(d)):(ScreenManager.setScreenParameters(null),ScreenManager.getCurrentScreen().clearParams());ViewManager.getView("#relationshipSearchMessageContainer").clearAlert("searchFail");ViewManager.getView("#relationshipSearchResults").deselectAll();d={};d.ownership=f;d.size=24;d.start=e;EcAlignment.search(AppController.serverController.getRepoInterface(),c,a,b,d)},100)}function k(b){ViewManager.getView("#relationshipSearchResults").clear();
d(b)}function d(b){ViewManager.getView("#menuContainer").showSortBasic();ViewManager.getView("#menuContainer").showSortRelations();ViewManager.getView("#relationshipSearchResults").populate(b);0==b.length&&0==$("#relationshipResults-data").first().children().size()?ViewManager.getView("#relationshipSearchResults").showNoDataMessage():24>b.length?$("#moreSearchResults").addClass("hide"):($("#getMoreResults").click(function(){$("#getMoreResults").addClass("hide");$("#loadingMoreResults").removeClass("hide");
l($("#relationshipResults-data .row[data-id]").size())}),$("#getMoreResults").removeClass("hide"),$("#moreSearchResults").removeClass("hide"),$("#loadingMoreResults").addClass("hide"));g=null}function b(b){void 0==b&&(b="Unable to Connect to Server for Competency Search");ViewManager.getView("#relationshipSearchMessageContainer").displayAlert(b,"searchFail");ViewManager.getView("#relationshipSearchResults").showNoDataMessage()}var h={isEnabledBy:"Enables",requires:"is Required By",desires:"is Desired By",
narrows:"is Narrowed By",isRelatedTo:"is Related To",isEquivalentTo:"is Equivalent To"},g=null;e.prototype.display=function(b){b=this.query;var c=this.ownership;ViewManager.showView(new MessageContainer("relationshipSearch"),"#relationshipSearchMessageContainer");ViewManager.showView(new DataViewer("relationshipResults",{sort:{Source:function(b,a){if(void 0==b)return!0;b=EcRemoteLinkedData.trimVersionFromUrl(b.source).split("/");b=b[b.length-1];a=EcRemoteLinkedData.trimVersionFromUrl(a.source).split("/");
a=a[a.length-1];return b>a?-1:1},Target:function(b,a){if(void 0==b)return!1;b=EcRemoteLinkedData.trimVersionFromUrl(b.target).split("/");b=b[b.length-1];a=EcRemoteLinkedData.trimVersionFromUrl(a.target).split("/");a=a[a.length-1];return b>a?-1:1}},clickDataEdit:function(b){ScreenManager.changeScreen(new RelationshipEditScreen(b))},moreMenuTools:function(){var b=$("\x3cdiv\x3e\x3c/div\x3e"),a=$("\x3cli\x3e\x3cspan\x3e\x3ci class\x3d'fa fa-sitemap'\x3e\x3c/i\x3e Add to Framework\x3c/span\x3e\x3c/li\x3e");
a.click(function(){var a=ViewManager.getView("#relationshipSearchResults").getSelected();ModalManager.showModal(new AddToFrameworkModal(a))});b.append(a);a=$("\x3cli\x3e\x3cspan\x3e\x3ci class\x3d'fa fa-download'\x3e\x3c/i\x3e Export\x3c/span\x3e\x3c/li\x3e");a.click(function(){var a=ViewManager.getView("#relationshipSearchResults").getSelected();ModalManager.showModal(new RepoExportModal(a))});b.append(a);return b.contents()},clickDataSelect:function(b,a,c,d){a=$(b.target).closest(".row");c=a.attr("data-aggregateId");
void 0!=c&&(d=a.siblings("[data-aggregateId\x3d'"+c+"']"),$(b.target).is(":checked")?d.find(".datum-select:checked").size()==d.size()?(a.siblings("[data-competencyId\x3d'"+c+"']").find(".datum-select").prop("checked","checked"),a.siblings("[data-competencyId\x3d'"+c+"']").find(".datum-select").prop("indeterminate",!1)):a.siblings("[data-competencyId\x3d'"+c+"']").find(".datum-select").prop("indeterminate",!0):0==d.find(".datum-select:checked").size()?(a.siblings("[data-competencyId\x3d'"+c+"']").find(".datum-select").removeAttr("checked"),
a.siblings("[data-competencyId\x3d'"+c+"']").find(".datum-select").prop("indeterminate",!1)):a.siblings("[data-competencyId\x3d'"+c+"']").find(".datum-select").prop("indeterminate",!0))},aggregateDataRows:function(b,a,c){var f;if("Source"==$("#relationshipSearchResults #relationshipResults-sortSelect").val()&&void 0!=c.source)f=c.source;else if("Target"==$("#relationshipSearchResults #relationshipResults-sortSelect").val()&&void 0!=c.target)f=c.target;else{$("#relationshipSearchResults #relationshipResults-data").append(b);
return}EcCompetency.get(f,function(a){var c;f==a.shortId()?c="":(c=f.split("/"),c=c[c.length-1]);var d=a.shortId().split("/"),d=d[d.length-1];""!=c&&(d+="-"+c);b.attr("data-aggregateId",d);var e;0==$("#relationshipSearchResults .competencyAggregateRow[data-competencyId\x3d"+d+"]").size()?($("#relationshipSearchResults #relationshipResults-data").append("\x3cdiv class\x3d'row column competencyAggregateRow' data-competencyId\x3d'"+d+"'\x3e\x3c/div\x3e"),e=$("#relationshipSearchResults .competencyAggregateRow[data-competencyId\x3d'"+
d+"']"),e.append($("\x3cinput type\x3d'checkbox' class\x3d'datum-select'\x3e\x3c/input\x3e)")),e.on("click",".datum-select",function(a){$(".dataView").find(".datum-select:checked").size()==$("#relationshipResults-data .row").size()?$(".toggleSelectData").text("Unselect All"):$(".toggleSelectData").text("Select All");if($(a.target).is(":checked")){var b=e.siblings("[data-aggregateId\x3d'"+d+"']");b.addClass("selected");b.find(".datum-select").prop("checked","checked");var b=ViewManager.getView("#relationshipSearchResults").getSelected(),
c=!0,f;for(f in b){var g=b[f];AppController.identityController.owns(g)||(c=!1)}c?($("#relationshipResults-menu").find(".fa-group").removeClass("hide"),$("#relationshipResults-menu").find(".fa-trash").removeClass("hide")):($("#relationshipResults-menu").find(".fa-group").addClass("hide"),AppController.serverController.getAdmin()||$("#relationshipResults-menu").find(".fa-trash").addClass("hide"))}else{b=e.siblings("[data-aggregateId\x3d'"+d+"']");b.removeClass("selected");b.find(".datum-select").removeAttr("checked");
b=ViewManager.getView("#relationshipSearchResults").getSelected();c=!0;for(f in b)g=b[f],AppController.identityController.owns(g)||(c=!1);c&&($("#relationshipResults-menu").find(".fa-group").removeClass("hide"),$("#relationshipResults-menu").find(".fa-trash").removeClass("hide"))}$(a.target).closest(".dataView").find(".datum-select").is(":checked")?($(a.target).closest(".dataView").addClass("selecting"),$("#relationshipResults-menu").is(":visible")||$("#relationshipResults-menu").slideDown(),$(".dataViewMenu .dataViewSelected").text($(".dataView").find("[data-id] .datum-select:checked").size())):
($(a.target).closest(".dataView").removeClass("selecting"),$("#relationshipResults-menu").is(":visible")&&$("#relationshipResults-menu").slideUp())}),e.attr("style","padding:7px 2px;padding-left:30px;background-color:#f3f3f3;cursor:default;"),e.append("\x3cdiv class\x3d'small-9 columns'\x3e\x3c/div\x3e"),e.find(".small-9").append(a.getName()),""!=c&&e.find(".small-9").append("\x3csmall\x3e(Version:"+c+")\x3c/small\x3e"),e.append("\x3cdiv class\x3d'small-3 columns'\x3e\x3cdiv class\x3d'rowToolbar'\x3e\x3cspan class\x3d'fa-stack fa-lg dataViewBtn' style\x3d'font-size: 0.45rem;margin-right:.8rem;' title\x3d'Load All Relationships'\x3e\x3ci class\x3d'fa fa-refresh fa-stack-2x' style\x3d'font-size: 3em;top: -4px;'\x3e\x3c/i\x3e\x3ci class\x3d'fa fa-plus fa-stack-1x' style\x3d'top: -2px;'\x3e\x3c/i\x3e\x3c/span\x3e \x3ca style\x3d'color:inherit;'\x3e\x3ci title\x3d'View Competency' class\x3d'fa fa-external-link dataViewBtn' style\x3d'margin-right:1rem;'\x3e\x3c/a\x3e\x3c/i\x3e\x3c/div\x3e\x3c/div\x3e"),
e.find(".fa-stack").click(function(b){b.preventDefault();$(this).find(".fa-plus").hasClass("hide")||($(this).find(".fa-plus").addClass("hide"),$(this).find(".fa-refresh").addClass("fa-spin"),a.relations(AppController.serverController.getRepoInterface(),null,function(a){ViewManager.getView("#relationshipSearchMessageContainer").displayAlert("Error getting all relationship: "+a);e.find(".fa-refresh").removeClass("fa-spin");e.find(".fa-plus").removeClass("hide")},function(a){e.nextAll(".competencyAggregateRow").first().before("\x3cdiv class\x3d'row column loadingRow' style\x3d'text-align:center;padding:7px 2px;font-style:italic;'\x3eLoading...\x3c/div\x3e");
ViewManager.getView("#relationshipSearchResults").populate(a);e.find(".fa-stack").remove();e.nextAll(".loadingRow").first().remove();e.find(".rowToolbar").css("padding-top","5px")}))}),e.find("a").attr("href","#"+CompetencyViewScreen.prototype.getDisplayName()+"?id\x3d"+f),e.find("a").click(function(b){b.preventDefault();ScreenManager.changeScreen(new CompetencyViewScreen(a));return!1})):e=$("#relationshipSearchResults .competencyAggregateRow[data-competencyId\x3d'"+d+"']");0<e.nextAll(".competencyAggregateRow").size()?
e.nextAll(".competencyAggregateRow").first().before(b):0<e.nextAll(".row").size()?e.nextAll(".row").last().after(b):e.after(b)},function(a){ViewManager.getView("#relationshipSearchMessageContainer").displayAlert("Error Retrieving Aggregate Competency: "+a);var c;0==$("#relationshipSearchResults .competencyAggregateRow[data-competencyId\x3dunknown]").size()?($("#relationshipSearchResults #relationshipResults-data").prepend("\x3cdiv class\x3d'row column competencyAggregateRow' data-competencyId\x3d'unknown'\x3e\x3c/div\x3e"),
c=$("#relationshipSearchResults .competencyAggregateRow[data-competencyId\x3d'unknown']"),c.append($("\x3cinput type\x3d'checkbox' class\x3d'datum-select'\x3e\x3c/input\x3e)")),c.on("click",".datum-select",function(a){$(".dataView").find(".datum-select:checked").size()==$("#relationshipResults-data .row").size()?$(".toggleSelectData").text("Unselect All"):$(".toggleSelectData").text("Select All");if($(a.target).is(":checked")){var b=c.siblings("[data-aggregateId\x3d'"+shortCompId+"']");b.addClass("selected");
b.find(".datum-select").prop("checked","checked");var b=ViewManager.getView("#relationshipSearchResults").getSelected(),f=!0,d;for(d in b){var e=b[d];AppController.identityController.owns(e)||(f=!1)}f?($("#relationshipResults-menu").find(".fa-group").removeClass("hide"),$("#relationshipResults-menu").find(".fa-trash").removeClass("hide")):($("#relationshipResults-menu").find(".fa-group").addClass("hide"),AppController.serverController.getAdmin()||$("#relationshipResults-menu").find(".fa-trash").addClass("hide"))}else{b=
c.siblings("[data-aggregateId\x3d'"+shortCompId+"']");b.removeClass("selected");b.find(".datum-select").removeAttr("checked");b=ViewManager.getView("#relationshipSearchResults").getSelected();f=!0;for(d in b)e=b[d],AppController.identityController.owns(e)||(f=!1);f&&($("#relationshipResults-menu").find(".fa-group").removeClass("hide"),$("#relationshipResults-menu").find(".fa-trash").removeClass("hide"))}$(a.target).closest(".dataView").find(".datum-select").is(":checked")?($(a.target).closest(".dataView").addClass("selecting"),
$("#relationshipResults-menu").is(":visible")||$("#relationshipResults-menu").slideDown(),$(".dataViewMenu .dataViewSelected").text($(".dataView").find("[data-id] .datum-select:checked").size())):($(a.target).closest(".dataView").removeClass("selecting"),$("#relationshipResults-menu").is(":visible")&&$("#relationshipResults-menu").slideUp())}),c.attr("style","padding:7px 2px;padding-left:30px;background-color:#f3f3f3;cursor:default;color:#f74646;font-weight:500;"),c.append("\x3cdiv class\x3d'small-12 columns'\x3e\x3c/div\x3e"),
c.find(".small-12").append("Unknown Competency")):c=$("#relationshipSearchResults .competencyAggregateRow[data-competencyId\x3d'unknown']");0<c.nextAll(".competencyAggregateRow").size()?c.nextAll(".competencyAggregateRow").first().before(b):0<c.nextAll(".row").size()?c.nextAll(".row").last().after(b):c.after(b)})},buildDataRow:function(b,a,c){"Source"==$("#relationshipSearchResults #relationshipResults-sortSelect").val()&&void 0!=c.source?b.append("\x3ca\x3e\x3cdiv class\x3d'small-2 columns datum-type' style\x3d'font-style:italic'\x3e\x3c/div\x3e\x3cdiv class\x3d'small-6 columns end datum-target'\x3e\x3c/div\x3e\x3c/a\x3e\x3cdiv class\x3d'small-4 columns datum-owner'\x3e\x3c/div\x3e"):
"Target"==$("#relationshipSearchResults #relationshipResults-sortSelect").val()&&void 0!=c.target?b.append("\x3ca\x3e\x3cdiv class\x3d'small-2 columns datum-type' style\x3d'font-style:italic'\x3e\x3c/div\x3e\x3cdiv class\x3d'small-6 columns end datum-source'\x3e\x3c/div\x3e\x3c/a\x3e\x3cdiv class\x3d'small-4 columns datum-owner'\x3e\x3c/div\x3e"):b.append("\x3ca\x3e\x3cdiv class\x3d'small-3 columns end datum-source'\x3e\x3c/div\x3e\x3cdiv class\x3d'small-2 columns datum-type' style\x3d'font-style:italic'\x3e\x3c/div\x3e\x3cdiv class\x3d'small-3 columns end datum-target'\x3e\x3c/div\x3e\x3c/a\x3e\x3cdiv class\x3d'small-4 columns datum-owner'\x3e\x3c/div\x3e");
if(void 0==c.owner||0==c.owner.length)b.find(".datum-owner").html("Public");else for(var f in c.owner){var d=EcRemoteLinkedData.trimVersionFromUrl(a),e=d.split("/")[d.split("/").length-1]+"-owner-"+f,d=$("\x3cspan id\x3d'"+e+"'\x3e\x3c/span\x3e");b.find(".datum-owner").append(d);var g=function(){0<$("#"+e).size()?ViewManager.showView(new IdentityDisplay(c.owner[f]),"#"+e):setTimeout(g,500)};setTimeout(g,500)}0<b.find(".datum-source").size()&&(EcCompetency.get(c.source,function(a){b.find(".datum-source").text(a.getName())},
function(){b.find(".datum-source").text("Unknown Competency")}),b.find(".datum-source").text("Loading.."));0<b.find(".datum-target").size()&&(EcCompetency.get(c.target,function(a){b.find(".datum-target").text(a.getName())},function(){b.find(".datum-target").text("Unknown Competency")}),b.find(".datum-target").text("Loading.."));a=0==b.find(".datum-target").size()?h:AppSettings.relationTypes;void 0!=a[c.relationType]?b.find(".datum-type").text(a[c.relationType]):b.find(".datum-type").text("has a relationship with");
b.find("a").click(function(a){a.preventDefault();ScreenManager.changeScreen(new RelationshipViewScreen(c))})}}),"#relationshipSearchResults");$("#relationshipSearchSubmit").click(function(b){b.preventDefault();l()});$("#relationshipSearchOwnership").change(function(b){b.preventDefault();l()});$("#relationshipSearchText").keypress(function(b){13==b.which&&l()});null!=b&&$("#relationshipSearchText").val(b);AppController.loginController.getLoggedIn()?($("#relationshipSearchOwnership").attr("max",4),
$("#relationshipSearchOwnershipLoggedIn").removeClass("hide"),$("#relationshipSearchOwnershipPublic").addClass("hide")):($("#relationshipSearchOwnershipLoggedIn").addClass("hide"),$("#relationshipSearchOwnershipPublic").removeClass("hide"));null!=c&&("public"==c?c=1:"owned"==c?c=3:"me"==c&&(c=4),$("#relationshipSearchOwnership").val(c));l();ViewManager.getView("#menuContainer").showSortBasic();ViewManager.getView("#menuContainer").showSortRelations()};e.prototype.onClose=function(){ViewManager.getView("#menuContainer").hideSort()};
e.prototype.sortByTimestamp=function(){$("#relationshipResults-sortSelect").val("timestamp");$("#relationshipResults-sortSelect").trigger("change")};e.prototype.sortByOwner=function(){$("#relationshipResults-sortSelect").val("owner");$("#relationshipResults-sortSelect").trigger("change")};e.prototype.filterPublic=function(){$("#relationshipSearchOwnership").val(1);l()};e.prototype.filterAll=function(){$("#relationshipSearchOwnership").val(2);l()};e.prototype.filterOwned=function(){$("#relationshipSearchOwnership").val(3);
l()};e.prototype.filterOwnedByMe=function(){AppController.loginController.getLoggedIn()&&($("#relationshipSearchOwnership").val(4),l())};e.prototype.setParams=function(b){void 0==b?this.clearParams():(this.query=b.query,this.ownership=b.ownership)};e.prototype.clearParams=function(){this.ownership=this.query=void 0};return e}(RelationshipSearchScreen);
RelationshipViewScreen=function(e){function l(d){EcEncryptedValue.encryptOnSave(d.id)?$("#relationshipViewerPrivateSymbol").removeClass("hide"):$("#relationshipViewerPrivateSymbol").addClass("hide");void 0!=d.source&&EcCompetency.get(d.source,function(b){var d=$("\x3ca\x3e\x3c/a\x3e");d.attr("href","#"+CompetencyViewScreen.displayName);d.text(b.getName());$("#relationshipViewerSource").html(d);$("#relationshipViewerSource").click(function(c){c.preventDefault();ScreenManager.changeScreen(new CompetencyViewScreen(b))})},
function(b){try{var d=JSON.parse(b);void 0==d.msg&&void 0==d.message&&($("#relationshipViewerSource").text("Unknown Competency"),$("#relationshipViewerSource").css("font-style","italic"))}catch(c){void 0==b&&(b="Unable to Connect to Server to Retrieve Source Competency"),ViewManager.getView("#relationshipViewMessageContainer").displayAlert(b,"getSource")}});void 0!=d.target&&EcCompetency.get(d.target,function(b){var d=$("\x3ca\x3e\x3c/a\x3e");d.attr("href","#"+CompetencyViewScreen.displayName);d.text(b.getName());
$("#relationshipViewerTarget").html(d);$("#relationshipViewerTarget").click(function(c){c.preventDefault();ScreenManager.changeScreen(new CompetencyViewScreen(b))})},function(b){try{var d=JSON.parse(b);void 0==d.msg&&void 0==d.message&&($("#relationshipViewerTarget").text("Unknown Competency"),$("#relationshipViewerTarget").css("font-style","italic"))}catch(c){void 0==b&&(b="Unable to Connect to Server to Retrieve Target Competency"),ViewManager.getView("#relationshipViewMessageContainer").displayAlert(b,
"getTarget")}});void 0!=d.relationType&&void 0!=AppSettings.relationTypes[d.relationType]?$("#relationshipViewerType").text(AppSettings.relationTypes[d.relationType]):$("#relationshipViewerType").text("has a relationship with");$("#relationshipViewerId").text(d.id);null==d.name||void 0==d.name?$(".relationshipViewerName").text("Relation"):$(".relationshipViewerName").text(d.name);$("#relationshipViewerDescription").text(d.description);if(void 0!=d.owner&&0<d.owner.length){$("#relationshipViewerOwner").text("");
for(var b=0;b<d.owner.length;b++){0<b&&$("#relationshipViewerOwner").append(", ");var e=d.owner[b];$("#relationshipViewerOwner").append("\x3cspan id\x3d'relation-owner-"+b+"'\x3e\x3c/span\x3e");ViewManager.showView(new IdentityDisplay(e),"#relation-owner-"+b)}}else $("#relationshipViewerOwner").text("Public")}function k(d){void 0==d&&(d="Unable to Connect to Server to Retrieve Relation");ViewManager.getView("#relationshipViewMessageContainer").displayAlert(d,"getRelation")}e.prototype.display=function(d,
b){var h=this.data;null!=h.id&&ScreenManager.setScreenParameters({id:h.id});ViewManager.showView(new MessageContainer("relationshipView"),"#relationshipViewMessageContainer");$("#relationshipViewSearchBtn").attr("href","#"+RelationshipSearchScreen.prototype.displayName);$("#relationshipViewSearchBtn").click(function(b){b.preventDefault();ScreenManager.changeScreen(new RelationshipSearchScreen(h))});$("#relationshipViewBtn").attr("href","#"+e.prototype.displayName);$("#relationshipViewBtn").click(function(b){b.preventDefault()});
AppController.identityController.canEdit(h)?$("#editRelationshipBtn").click(function(b){b.preventDefault();ScreenManager.changeScreen(new RelationshipEditScreen(h))}):$("#editRelationshipBtn").remove();AppController.identityController.owns(h)||AppController.serverController.getAdmin()?$("#relationshipViewDeleteBtn").click(function(){ModalManager.showModal(new ConfirmModal(function(){h._delete(function(){ScreenManager.changeScreen(new RelationshipSearchScreen)},function(b){void 0==b&&(b="Unable to connect to server to delete relationship");
ViewManager.getView("#relationshipViewMessageContainer").displayAlert(b)});ModalManager.hideModal()},"Are you sure you want to delete this relationship?"))}):$("#relationshipViewDeleteBtn").remove();EcAlignment.get(h.id,function(b){h=b;l(b)},k)};return e}(RelationshipViewScreen);
RepoCreateScreen=function(e){e.prototype.display=function(e){var k=this.data;if(void 0==k||0==Object.keys(k).length)e=new Thing,e.generateId(AppController.serverController.getRepoInterface().selectedServer),e.name="New Object",void 0!=AppController.identityController.selectedIdentity&&e.addOwner(AppController.identityController.selectedIdentity.ppk.toPk()),k=e;void 0==k.hasOwner&&void 0==k["@owner"]&&void 0!=AppController.identityController.selectedIdentity&&(k["@owner"]=[],k["@owner"][0]=AppController.identityController.selectedIdentity.ppk.toPk().toPem());
ViewManager.showView(new RepoEdit(k,"#repoCreateSaveBtn","#repoCreateMessageContainer"),"#repoCreateData",function(){"New Object"==k.name&&void 0==AppController.identityController.selectedIdentity&&ViewManager.getView("#repoCreateMessageContainer").displayWarning("You are Creating a Public Repository Item, this item can be modified by anyone","warning")})};return e}(RepoCreateScreen);
var RepoEdit=function(e){function l(a,b){$("#datum").remove();0==$("#datum").length&&$(".dataRecepticle").append("\x3cdiv id\x3d'datum'\x3e\x3c/div\x3e");d($("#datum"),a);$("#datum").children("div").css("overflow-x","inherit");$("#datum").on("click",".label:contains('Encrypt')",function(){var a=$(this).parents("[field]").first();"datum"==a.attr("id")?ModalManager.showModal(new EncryptOptionsModal(function(b){k(a,c(a),b.type,b.name);ModalManager.hideModal()})):k(a,c(a))});$("#datum").on("click",".label:contains('Add')",
function(){var a=$(this).parent().parent().parent();ModalManager.showModal(new AddOwnerModal(a,b))});$("#datum").on("click",".label:contains('Decrypt')",function(){var a=$(this).parents("[field]").first();if(a.find("[field\x3d'@type']").children("p").text()==(new EcEncryptedValue).type){a.find("[field\x3d'@id']").children("p").text();a.attr("field");var b=new EcEncryptedValue;b.copyFrom(JSON.parse(c(a)));var f=b.decryptIntoObject();null!=f?d(a,f):f=b.decryptIntoString();null!=f&&d(a,f)}});$("#datum").on("click",
".label:contains('+')",function(){var a=$(this).parents("[field]").first();ModalManager.showModal(new AddFieldModal(a,b))});$("#datum").on("click",".label:contains('X')",function(){var a=$(this).parents("[field]").first();a.attr("id");a.remove()});$("#datum").on("click",".label:contains('Copy')",function(){$("#datum").find("[field\x3d'@id']").each(function(a,b){var f=$(b).children("p").text().split("/");"data"==f[f.length-4]&&(f[f.length-2]=guid());$(b).children("p").text(f.join("/"));a==$("#datum").find("[field\x3d'@id']").size()-
1&&(a=JSON.parse(c($("#datum"))),b=new EcRemoteLinkedData,b.copyFrom(a),delete b["@owner"],delete b["@signature"],ScreenManager.changeScreen(new RepoCreateScreen(b)))})});$("#datum").on("click",".label:contains('Change')",function(){var a=$(this).parent().parent().parent();ModalManager.showModal(new ChangeTypeModal(a,b))});$("#datum").on("click",".label:contains('Verify')",function(){var a=$(this).parents("[field]").first();if(void 0!=a.find("[field\x3d'@signature']").children("p").text()&&void 0!=
a.find("[field\x3d'@owner']").children("p").text()){var a=JSON.parse(c(a)),b=new EcRemoteLinkedData;b.copyFrom(a);b.verify()?ModalManager.showModal(new MessageModal("Verified!","","tiny")):ViewManager.getView(q).displayAlert("Unable to Verify","verify")}})}function k(a,b,c,f){if(null==AppController.identityController.selectedIdentity)alert("Select a key.","You have no keys available to encrypt with.");else{a.attr("field");var e=$("[field\x3d'@id']").children("p").text();if(null!=AppController.identityController.selectedIdentity){var g=
void 0,h=void 0;c&&(g=JSON.parse(b)["@type"]);f&&(h=JSON.parse(b).name);b=EcEncryptedValue.encryptValueOld(b,e,AppController.identityController.selectedIdentity.ppk.toPk());void 0!=g&&(b.encryptedType=g);void 0!=h&&(b.name=h);null!=b&&(0<a.find("[field\x3d'@id']").length&&(b["@id"]=a.find("[field\x3d'@id']").children("p").text()),d(a,b))}}}function d(a,c,f){"datum"==a.attr("id")&&(m=0);m++;a.children("section").remove();a.children("p").remove();a.children("div").remove();a.children("ul").remove();
a.children("span").remove();var d;try{d=JSON.parse(c.toJson())}catch(x){try{d=JSON.parse(c)}catch(v){d=void 0}}if(isObject(d)||isObject(c)){void 0==d&&(d=c);void 0==a.attr("field")&&a.attr("field","dataObject");a.append("\x3cdiv style\x3d'margin-left:20px;'\x3e\x3c/div\x3e");for(var e in d)isFunction(d[e])||void 0==d[e]||b(a,e,d[e]);f=a.children("div").children("div").get();f.sort(function(a,b){return $(a).attr("field")<$(b).attr("field")?-1:$(a).attr("field")>$(b).attr("field")?1:0});$.each(f,function(b,
c){c.remove();a.children("div").append(c)})}else if(isArray(c)){a.append("\x3cul style\x3d'margin-left:30px;'\x3e\x3c/ul\x3e");for(var g in c)b(a,f,c[g])}else"@owner"==a.children("label").text()||"@owner"==a.parent().parent().children("label").text()?(f="node-"+m+"-owner-"+a.siblings("li").size(),a.append("\x3cspan id\x3d'"+f+"' style\x3d'display:block;'\x3e\x3c/span\x3e"),ViewManager.showView(new IdentityDisplay(c),"#"+f)):a.append("\x3cp style\x3d'text-overflow: ellipsis;margin-bottom:0px;overflow:hidden;'\x3e"+
c+"\x3c/p\x3e");h(a,a.children("label").text(),c);p(a,d);a.effect("highlight",{},1500)}function b(a,b,c){if(0<a.children("div").length)a.children("div").append('\x3cdiv field\x3d"'+b+'"\x3e\x3c/div\x3e'),a.children("div").children("[field\x3d'"+b+"']").append('\x3clabel class\x3d"repoEdit-label" style\x3d"font-weight:500;text-decoration:underline;"\x3e'+b+"\x3c/label\x3e"),d(a.children("div").children("[field\x3d'"+b+"']"),c,b);else if(0<a.children("ul").length){var f=a.children("ul").children("li").length;
a.children("ul").append('\x3cli field\x3d"'+b+"["+f+']"\x3e\x3c/li\x3e');d(a.children("ul").children("li").last(),c,b)}}function h(a,b,c){a.children("a").remove();if(-1==b.indexOf("@")&&"payload"!=b&&"secret"!=b&&0<a.children("div").length){var f="\x3csection class\x3d'clearfix";c instanceof EcRemoteLinkedData||(f+=" float-right");f+="'\x3e";if(""!=b||null!=c.owner&&null!=c.owner.length&&0<c.owner.length&&AppController.identityController.canEdit(c))f+=g("X","Deletes this field.");void 0!=c&&void 0!=
c.signature&&(f+=g("Verify","Verifies the object using the @signature to ensure it has not been changed by anyone but the @owner."));void 0!=c&&void 0==c.owner?f+=g("+","Add a new field to the object."):AppController.identityController.owns(c)&&(f+=g("+","Add a new field to the object."),f=c.isAny((new EcEncryptedValue).getTypes())?f+g("Decrypt","Decrypts the field so that it is no longer private."):f+g("Encrypt","Encrypts the field so nobody but you and the people you authorize can see the data."));
a.prepend(f+"\x3c/section\x3e");a.children("p").attr("contenteditable","true")}-1==b.indexOf("@")&&"payload"!=b&&"secret"!=b&&0<a.children("ul").length&&a.prepend(g("+","Add a new entry to the list."));-1==b.indexOf("@")&&"payload"!=b&&"secret"!=b&&0==a.children("div").length&&(f=g("X","Deletes this field."),a.prepend(f),a.children("p").attr("contenteditable","true"));"@id"==b&&a.prepend(g("Copy","Changes the ID, causing the next save to write to a new object."));"@type"==b&&a.prepend(g("Change",
"Changes the type of the object."));if("@owner"==b&&null!=c&&null!=c.length&&0<c.length){b=!1;for(f=0;f<EcIdentityManager.ids.length;f++)for(var d=0;d<c.length;d++)EcIdentityManager.ids[f].ppk.toPk().toPem()==c[d]&&(b=!0);b&&a.prepend(g("Add","Adds an owner by public key."))}}function g(a,b){return'\x3ca style\x3d"margin-right:2px;" class\x3d"float-right label fieldBtn" title\x3d"'+b+'"\x3e'+a+"\x3c/a\x3e"}function p(a,b){a.children(".label:contains('decrypt')").text("encrypt");a.children(".label:contains('verify')").hide();
isObject(b)&&(void 0!=b["@context"]&&void 0!=b["@type"]&&b["@context"]==Ebac.context&&b["@type"]==EbacEncryptedValue.type&&a.children().first().children(".label:contains('encrypt')").text("decrypt"),void 0!=b["@signature"]&&void 0!=b["@type"]&&a.children().first().children(".label:contains('verify')").show())}function c(a,b){if(1==a.children(".ownershipDisplay").size())return a.children(".ownershipDisplay").attr("pk");if(1==a.children("span").children(".identityDisplay").size())return a.find(".identityDisplay").attr("data-pk");
if(1==a.children("span").length)return a.find("input[type\x3d'checkbox']").prop("checked");if(1==a.children("p").length)return a.children("p").text();if(0<a.children("div").length){var f={};a=a.children("div").children("[field!\x3d'']");for(var d in a)f[a.eq(d).attr("field")]=c(a.eq(d),!0);return b?f:JSON.stringify(f)}if(0<a.children("ul").length){f=[];a=a.children("ul").children("li");for(d in a){var e=c(a.eq(d),!0);null!=e&&void 0!==e&&f.push(e)}return b?f:JSON.stringify(f)}}function f(){$("#datum").effect("highlight",
{},1500)}function a(a){void 0==a&&(a="Unable to Connect to Server to Save");ViewManager.getView(q).displayAlert(a)}var m,q;e.prototype.display=function(b){var d=this.data;this.containerId=b;q=this.messageContainerId;ViewManager.showView(new MessageContainer("repoEdit"),this.messageContainerId);$(this.saveButtonId).click(function(){var b=c($("#datum"));if(void 0!=b){var e=new EcRemoteLinkedData(null,null);e.copyFrom(JSON.parse(b));EcRepository.save(e,f,a)}else void 0!=d&&EcRepository._delete(d,f,a)});
$(this.saveButtonId).on("mousemove",function(){$("#datum").first().children("div").find("[field\x3d'@id']").each(function(a,b){a=$(b).children("p").text().split("/");"data"==a[a.length-4]&&(a[a.length-1]=(new Date).getTime());$(b).children("p").text(a.join("/"))})});l(d,b)};e.prototype.addField=function(a,c,f){b(a,c,f)};e.prototype.changeObject=function(a){l(a,this.containerId)};e.prototype.changeType=function(a,b,c){a.children("div").children("[field\x3d'@context']").each(function(a,c){$(c).children("p").text(b)});
a.children("div").children("[field\x3d'@type']").each(function(a,f){$(f).children("p").text(c);var d=(c.startsWith(b)?c:b+"."+c).split(/\/|\./);for(a=d.length-1;0<=a;a--)""!=d[a]&&"http:"!=d[a]&&"https:"!=d[a]&&"www"!=d[a]||d.splice(a,1);a=$(f).parent().children("[field\x3d'@id']").children("p").text().split("/");"data"==a[a.length-4]&&(a[a.length-3]=d.join("."));$(f).parent().children("[field\x3d'@id']").children("p").text(a.join("/"))})};e.prototype.addOwner=function(a,c){b(a.children("div").children("[field\x3d'@owner']"),
"@owner",c)};return e}(RepoEdit),RepoExportModal=function(e){e.prototype.display=function(e){var k=this.data;ViewManager.showView(new MessageContainer("repoExport"),"#repoExportMessageContainer",function(){void 0!=k&&null!=k||ViewManager.getView("#repoExportMessageContainer").displayAlert("Error getting objects to export")});var d="";void 0==k||null==k?d="Error":k instanceof Array?d=k.length+" CASS Objects":(d=void 0!=k.name?k.name:void 0!=k.id?k.id:"1 CASS Object",e=[],e.push(k),k=e);$("#exportName").text(d);
$("#submitExport").click(function(){var b=new CSVExport.CSVExportProcess;b.buildExport(k);var e=$("#nameInput").val();void 0!=e&&""!=e&&(d=e);e=new Date;b.downloadCSV(d+"-"+e.getYear()+e.getMonth()+e.getDay());ModalManager.hideModal()});$("#cancelExport").click(function(){ModalManager.hideModal()})};return e}(RepoExportModal),RepoImportModal=function(e){function l(){var d=$("#generalImportFile")[0].files[0];CSVImport.analyzeFile(d,function(b){if(void 0===b.length||0==b.length)ViewManager.getView("#generalImportMessageContainer").displayAlert("CSV could not be parsed",
"parseCSV"),$("#submitGeneralImport").attr("disabled","disabled"),$("#submitGeneralImport").off("click");else{$("#submitGeneralImport").removeAttr("disabled");ViewManager.getView("#generalImportMessageContainer").clearAlert("parseCSV");$("#generalImportColumnId").html("\x3coption index\x3d'-1'\x3eN/A\x3c/option\x3e");for(var d=0;d<b[0].length;d++)$("#generalImportColumnId").append("\x3coption/\x3e").children().last().text(b[0][d]).attr("index",d),b[0][d].toLowerCase().includes("id")&&($("#generalImportColumnId [index\x3d"+
d+"]").attr("selected","selected"),ViewManager.getView("#generalImportMessageContainer").displayPrimary("CSV column names atuomatically determined based off of name","csvGuess"));$("#generalImportColumnId").change(function(){void 0!=$("#generalImportColumnId").val()&&-1!=$("#generalImportColumnId").val()||ViewManager.getView("#generalImportMessageContainer").displayWarning("If ID Column not set, imported data cannot be linked","noID")});$("#submitGeneralImport").on("click",function(b){b.preventDefault();
$("#submitGeneralImport").attr("disabled","disabled");$("#submitGeneralImport").find(".fa-spin").removeClass("hide");setTimeout(function(){k()},100)})}},function(b){ViewManager.getView("#generalImportMessageContainer").clearSuccess();ViewManager.getView("#generalImportMessageContainer").displayAlert(b)})}function k(){var d=$("#generalImportFile")[0].files[0],b=parseInt($("#generalImportColumnId option:selected").attr("index"));ViewManager.getView("#generalImportMessageContainer").clearAlert("selectName");
CSVImport.importData(d,AppController.serverController.selectedServerUrl,AppController.identityController.selectedIdentity,function(b){for(var d="",e=0;e<b.length;e++){var c=b[e].shortId().split("/"),c=c[c.length-1];0<e&&(d+=" OR ");d+=c}ScreenManager.changeScreen(new RepoSearchScreen(null,d));ModalManager.hideModal()},function(b){ViewManager.getView("#generalImportProgressMessageContainer").clearSuccess();ViewManager.getView("#generalImportProgressMessageContainer").displayAlert(b)},function(b){ViewManager.getView("#generalImportProgressMessageContainer").displaySuccess("Sucessfully imported "+
b+" objects","progress")},b)}e.prototype.display=function(d){ViewManager.showView(new MessageContainer("generalImportProgress"),"#generalImportProgressMessageContainer");ViewManager.showView(new MessageContainer("importCompetencies"),"#generalImportMessageContainer",function(){void 0==AppController.identityController.selectedIdentity&&ViewManager.getView("#generalImportMessageContainer").displayWarning("Objects that are imported will be Public and can be modified by anyone","noOwner")});$("#generalImportFile").change(function(){l()});
$(".cancelImport").click(function(b){b.preventDefault();ModalManager.hideModal()});void 0!=AppController.identityController.selectedIdentity&&(d=AppController.identityController.selectedIdentity.ppk.toPk().toPem(),ViewManager.showView(new IdentityDisplay(d),"#generalImportOwner"))};return e}(RepoImportModal);
RepoSearchScreen=function(e){function l(b){if(void 0==b||0>=b)ViewManager.getView("#repoSearchResults").clear(),$("#moreSearchResults").addClass("hide");var a=$("#repoSearchText").val();if(null==a||""==a)a="*";var f=$("#repoSearchOwnership").val(),f=1==f?"public":3==f?"owned":4==f?"me":"all",e=void 0,e=$("#repoSearchTypes input:checkbox:checked").size()!=$("#repoSearchTypes input:checkbox").size()?$("#repoSearchTypes input:checkbox:checked").map(function(){return $(this).parent().attr("title")}).get():
0==$("#repoSearchTypes input:checkbox:checked").size()&&void 0!=c?c:void 0;null!=p&&clearTimeout(p);var g;g=void 0==b?k:d;setTimeout(function(){if(null==p){var c={};if(1<window.location.hash.split("?").length)for(var d=window.location.hash.split(/[?&]/),k=1;k<d.length;k++){var l=d[k].split("\x3d");2==l.length&&(c[l[0]]=l[1])}void 0!=e?c.types=e:void 0!=c.types&&delete c.types;"*"!=a?c.query=a:void 0!=c.query&&delete c.query;"all"!=f?c.ownership=f:void 0!=c.ownership&&delete c.ownership;0<Object.keys(c).length?
(ScreenManager.setScreenParameters(c),ScreenManager.getCurrentScreen().setParams(c)):(ScreenManager.setScreenParameters(null),ScreenManager.getCurrentScreen().clearParams());p=!0;ViewManager.getView("#repoSearchMessageContainer").clearAlert("repoSearchFail");ViewManager.getView("#repoSearchResults").deselectAll();0==$("#repoResults-data").first().children().size()&&ViewManager.getView("#repoSearchResults").showProgressMessage();c={size:24};c.start=b;c.ownership=f;c.types=e;AppController.serverController.getRepoInterface().searchWithParams(a,
c,null,g,h)}},100)}function k(b){ViewManager.getView("#repoSearchResults").clear();d(b)}function d(b){ViewManager.getView("#menuContainer").showSortBasic();ViewManager.getView("#repoSearchResults").populate(b);$("#repoResults-data").first().children();0==b.length?ViewManager.getView("#repoSearchResults").showNoDataMessage():24>b.length?$("#moreSearchResults").addClass("hide"):($("#getMoreResults").click(function(){$("#getMoreResults").addClass("hide");$("#loadingMoreResults").removeClass("hide");
l($("#repoResults-data").first().children().size())}),$("#getMoreResults").removeClass("hide"),$("#moreSearchResults").removeClass("hide"),$("#loadingMoreResults").addClass("hide"));p=null}function b(b){if(void 0==b||""==b)b="Unable to retrieve type list";ViewManager.getView("#repoSearchMessageContainer").displayAlert(b,"repoTypesFail");$("#repoSearchTypeContainer").addClass("hide")}function h(b){if(void 0==b||""==b)b="Unable to connect to server to retrieve search results";ViewManager.getView("#repoSearchMessageContainer").displayAlert(b,
"repoSearchFail");p=null}function g(d){0==$(d).size()&&b("No Types Returned");$("#repoSearchTypes li.type").remove();for(var a in d){var f=d[a],e=f.key,f=f.doc_count,g=e.split("/"),g=g[g.length-1],g=g.slice(0,1).toUpperCase()+g.slice(1,g.length),h;void 0==c?(h=$("\x3cli class\x3d'type'\x3e\x3clabel\x3e\x3c/label\x3e\x3c/li\x3e"),h.find("label").attr("title",e),h.find("label").text(g+" ("+f+")"),h.find("label").prepend("\x3cinput type\x3d'checkbox' style\x3d'margin-bottom:0.5rem;' checked\x3d'checked'/\x3e")):
(h=$("\x3cli class\x3d'type'\x3e\x3clabel\x3e\x3c/label\x3e\x3c/li\x3e"),h.find("label").attr("title",e),h.find("label").text(g+" ("+f+")"),h.find("label").prepend("\x3cinput type\x3d'checkbox' style\x3d'margin-bottom:0.5rem;'/\x3e"),-1!=$.inArray(e,c)&&h.find("input").attr("checked","checked"),1==c.length&&-1!=$.inArray(e,c)&&$("#repoSearchTypesText").text(g+" ("+f+")"));$("#repoSearchTypes").prepend(h)}void 0!=c&&1<c.length&&($("#repoSearchTypesText").text(c.length+" Types Selected"),$("#repoSearchTypesText").css("font-size",
"small"));var k=$("#repoSearchSelectAllToggle");k.click(function(){-1==k.text().indexOf("Deselect")?($("#repoSearchTypes input:checkbox").prop("checked",!0),k.text("Deselect All"),$("#repoSearchTypes input:checkbox").trigger("change")):($("#repoSearchTypes input:checkbox").prop("checked",!1),k.text("Select All"))});var p=!1;$("#repoSearchTypes input:checkbox").change(function(){p=!0});h=new Foundation.Dropdown($("#repoSearchTypes"));$(h.$element).bind("hide.zf.dropdown",function(a){a=$("#repoSearchTypes input:checked");
0==a.size()||a.size()==$("#repoSearchTypes input").size()?(a="All",$("#repoSearchTypes input:checkbox").prop("checked",!0),k.text("Deselect All"),$("#repoSearchTypesText").css("font-size","normal")):1==a.size()?(a=a.closest("label").text(),$("#repoSearchTypesText").css("font-size","normal")):(a=a.size()+" Types Selected",$("#repoSearchTypesText").css("font-size","small"));$("#repoSearchTypesText").text(a);p&&(p=!1,l())})}var p=null,c;e.prototype.display=function(d,a){p=null;d=this.query;a=this.ownership;
c=this.types;ViewManager.showView(new MessageContainer("repoSearch"),"#repoSearchMessageContainer");ViewManager.showView(new DataViewer("repoResults",{moreMenuTools:function(){var a=$("\x3cdiv\x3e\x3c/div\x3e");el=$("\x3cli\x3e\x3cspan\x3e\x3ci class\x3d'fa fa-download'\x3e\x3c/i\x3e Export\x3c/span\x3e\x3c/li\x3e");el.click(function(){var a=ViewManager.getView("#repoSearchResults").getSelected();ModalManager.showModal(new RepoExportModal(a))});a.append(el);return a.contents()}}),"#repoSearchResults");
$("#repoSearchBtn").click(function(a){a.preventDefault();l()});$("#repoSearchOwnership").change(function(a){a.preventDefault();l()});$("#repoSearchText").keypress(function(a){13==a.which&&l()});null!=d&&$("#repoSearchText").val(d);AppController.loginController.getLoggedIn()?($("#repoSearchOwnership").attr("max",4),$("#repoSearchOwnershipLoggedIn").removeClass("hide"),$("#repoSearchOwnershipPublic").addClass("hide")):($("#repoSearchOwnershipLoggedIn").addClass("hide"),$("#repoSearchOwnershipPublic").removeClass("hide"));
null!=a&&("public"==a?a=1:"owned"==a?a=3:"me"==a&&(a=4),$("#repoSearchOwnership").val(a));AppController.serverController.getRepoInterface().listTypes(g,b);l();ViewManager.getView("#menuContainer").showSortBasic()};e.prototype.onClose=function(){ViewManager.getView("#menuContainer").hideSort()};e.prototype.sortByTimestamp=function(){$("#repoResults-sortSelect").val("timestamp");$("#repoResults-sortSelect").trigger("change")};e.prototype.sortByOwner=function(){$("#repoResults-sortSelect").val("owner");
$("#repoResults-sortSelect").trigger("change")};e.prototype.filterPublic=function(){$("#repoSearchOwnership").val(1);l()};e.prototype.filterAll=function(){$("#repoSearchOwnership").val(2);l()};e.prototype.filterOwned=function(){$("#repoSearchOwnership").val(3);l()};e.prototype.filterOwnedByMe=function(){AppController.loginController.getLoggedIn()&&($("#repoSearchOwnership").val(4),l())};e.prototype.setParams=function(b){void 0==b?this.clearParams():(this.query=b.query,this.ownership=b.ownership,this.types=
b.types)};e.prototype.clearParams=function(){this.types=this.ownership=this.query=void 0};return e}(RepoSearchScreen);
RepoViewScreen=function(e){e.prototype.display=function(e){var k=this.data;null!=k.id&&ScreenManager.setScreenParameters({id:k.id});$("#repoViewSearchBtn").attr("href","#"+RepoSearchScreen.prototype.displayName);$("#repoViewSearchBtn").click(function(d){d.preventDefault();ScreenManager.changeScreen(new RepoSearchScreen(k))});AppController.identityController.owns(k)||AppController.serverController.getAdmin()?$("#repoViewDeleteBtn").click(function(){ModalManager.showModal(new ConfirmModal(function(){EcRepository._delete(k,
function(){ScreenManager.changeScreen(new RepoSearchScreen);ModalManager.hideModal()},function(d){void 0==d&&(d="Unable to connect to server to delete item");ViewManager.getView("#repoViewMessageContainer").displayAlert(d)})},"Are you sure you want to delete this object?"))}):$("#repoViewDeleteBtn").remove();$("#repoViewBtn").click(function(d){d.preventDefault()});EcRepository.get(k.id,function(d){k=d;ViewManager.showView(new RepoEdit(k,"#repoViewSaveBtn","#repoViewMessageContainer"),"#repoViewResult")},
function(d){void 0==d&&(d="Unable to get object from repository");ViewManager.getView("#repoViewMessageContainer").displayAlert(d)})};return e}(RepoViewScreen);
RollupRuleSearchScreen=function(e){function l(e){var g=$("#rollupRuleSearchText").val();if(null==g||""==g)g="*";null!=h&&clearTimeout(h);var c=$("#rollupRuleSearchOwnership").val(),c=1==c?"public":3==c?"owned":4==c?"me":"all",f;f=void 0==e?k:d;h=setTimeout(function(){var a={};if(1<window.location.hash.split("?").length)for(var d=window.location.hash.split(/[?&]/),h=1;h<d.length;h++){var k=d[h].split("\x3d");2==k.length&&(a[k[0]]=k[1])}"*"!=g&&(a.query=g);"all"!=c&&(a.ownership=c);0<Object.keys(a).length?
(ScreenManager.setScreenParameters(a),ScreenManager.getCurrentScreen().setParams(a)):(ScreenManager.setScreenParameters(null),ScreenManager.getCurrentScreen().clearParams());ViewManager.getView("#rollupRuleSearchMessageContainer").clearAlert("searchFail");ViewManager.getView("#rollupRuleSearchResults").deselectAll();a={};a.ownership=c;a.size=24;a.start=e;EcRollupRule.search(AppController.serverController.getRepoInterface(),g,f,b,a)},100)}function k(b){ViewManager.getView("#rollupRuleSearchResults").clear();
d(b)}function d(b){ViewManager.getView("#menuContainer").showSortBasic();ViewManager.getView("#menuContainer").showSortByCompetency();ViewManager.getView("#rollupRuleSearchResults").populate(b);0==b.length&&0==$("#rollupRuleResults-data").first().children().size()?ViewManager.getView("#rollupRuleSearchResults").showNoDataMessage():24>b.length?$("#moreSearchResults").addClass("hide"):($("#getMoreResults").click(function(){$("#getMoreResults").addClass("hide");$("#loadingMoreResults").removeClass("hide");
runRelationshipSearch($("#rollupRuleResults-data .row[data-id]").size())}),$("#getMoreResults").removeClass("hide"),$("#moreSearchResults").removeClass("hide"),$("#loadingMoreResults").addClass("hide"));h=null}function b(b){void 0==b&&(b="Unable to Connect to Server for Competency Search");ViewManager.getView("#rollupRuleSearchMessageContainer").displayAlert(b,"searchFail");ViewManager.getView("#rollupRuleSearchResults").showNoDataMessage()}var h=null;e.prototype.display=function(b){b=this.query;
var d=this.ownership;ViewManager.showView(new MessageContainer("rollupRuleSearch"),"#rollupRuleSearchMessageContainer");ViewManager.showView(new DataViewer("rollupRuleResults",{sort:{Competency:function(b,d){if(void 0==b)return!0;b=EcRemoteLinkedData.trimVersionFromUrl(b.competency).split("/");b=b[b.length-1];d=EcRemoteLinkedData.trimVersionFromUrl(d.competency).split("/");d=d[d.length-1];return b>d?-1:1}},clickDataEdit:function(b){ScreenManager.changeScreen(new CompetencyViewScreen({id:b.competency}),
function(){ModalManager.showModal(new EditRollupRuleModal(b,function(){ScreenManager.reloadCurrentScreen()}))})},clickDataSelect:function(b,d,a,e){d=$(b.target).closest(".row");a=d.attr("data-aggregateId");void 0!=a&&(e=d.siblings("[data-aggregateId\x3d'"+a+"']"),$(b.target).is(":checked")?e.find(".datum-select:checked").size()==e.size()?(d.siblings("[data-competencyId\x3d'"+a+"']").find(".datum-select").prop("checked","checked"),d.siblings("[data-competencyId\x3d'"+a+"']").find(".datum-select").prop("indeterminate",
!1)):d.siblings("[data-competencyId\x3d'"+a+"']").find(".datum-select").prop("indeterminate",!0):0==e.find(".datum-select:checked").size()?(d.siblings("[data-competencyId\x3d'"+a+"']").find(".datum-select").removeAttr("checked"),d.siblings("[data-competencyId\x3d'"+a+"']").find(".datum-select").prop("indeterminate",!1)):d.siblings("[data-competencyId\x3d'"+a+"']").find(".datum-select").prop("indeterminate",!0))},moreMenuTools:function(){var b=$("\x3cdiv\x3e\x3c/div\x3e");el=$("\x3cli\x3e\x3cspan\x3e\x3ci class\x3d'fa fa-download'\x3e\x3c/i\x3e Export\x3c/span\x3e\x3c/li\x3e");
el.click(function(){var b=ViewManager.getView("#rollupRuleSearchResults").getSelected();ModalManager.showModal(new RepoExportModal(b))});b.append(el);return b.contents()},aggregateDataRows:function(b,d,a){var c;"Competency"==$("#rollupRuleSearchResults #rollupRuleResults-sortSelect").val()&&void 0!=a.competency?(c=a.competency,EcCompetency.get(c,function(a){var d;c==a.shortId()?d="":(d=c.split("/"),d=d[d.length-1]);var f=a.shortId().split("/"),f=f[f.length-1];""!=d&&(f+="-"+d);b.attr("data-aggregateId",
f);var e;0==$("#rollupRuleSearchResults .competencyAggregateRow[data-competencyId\x3d"+f+"]").size()?($("#rollupRuleSearchResults #rollupRuleResults-data").append("\x3cdiv class\x3d'row column competencyAggregateRow' data-competencyId\x3d'"+f+"'\x3e\x3c/div\x3e"),e=$("#rollupRuleSearchResults .competencyAggregateRow[data-competencyId\x3d'"+f+"']"),e.append($("\x3cinput type\x3d'checkbox' class\x3d'datum-select'\x3e\x3c/input\x3e)")),e.on("click",".datum-select",function(a){$(".dataView").find(".datum-select:checked").size()==
$("#rollupRuleResults-data .row").size()?$(".toggleSelectData").text("Unselect All"):$(".toggleSelectData").text("Select All");if($(a.target).is(":checked")){var b=e.siblings("[data-aggregateId\x3d'"+f+"']");b.addClass("selected");b.find(".datum-select").prop("checked","checked");var b=ViewManager.getView("#rollupRuleSearchResults").getSelected(),c=!0,d;for(d in b){var g=b[d];AppController.identityController.owns(g)||(c=!1)}c?($("#rollupRuleResults-menu").find(".fa-group").removeClass("hide"),$("#rollupRuleResults-menu").find(".fa-trash").removeClass("hide")):
($("#rollupRuleResults-menu").find(".fa-group").addClass("hide"),AppController.serverController.getAdmin()||$("#rollupRuleResults-menu").find(".fa-trash").addClass("hide"))}else{b=e.siblings("[data-aggregateId\x3d'"+f+"']");b.removeClass("selected");b.find(".datum-select").removeAttr("checked");b=ViewManager.getView("#rollupRuleSearchResults").getSelected();c=!0;for(d in b)g=b[d],AppController.identityController.owns(g)||(c=!1);c&&($("#rollupRuleResults-menu").find(".fa-group").removeClass("hide"),
$("#rollupRuleResults-menu").find(".fa-trash").removeClass("hide"))}$(a.target).closest(".dataView").find(".datum-select").is(":checked")?($(a.target).closest(".dataView").addClass("selecting"),$("#rollupRuleResults-menu").is(":visible")||$("#rollupRuleResults-menu").slideDown(),$(".dataViewMenu .dataViewSelected").text($(".dataView").find("[data-id] .datum-select:checked").size())):($(a.target).closest(".dataView").removeClass("selecting"),$("#rollupRuleResults-menu").is(":visible")&&$("#rollupRuleResults-menu").slideUp())}),
e.attr("style","padding:7px 2px;padding-left:30px;background-color:#f3f3f3;cursor:default;"),e.append("\x3cdiv class\x3d'small-9 columns'\x3e\x3c/div\x3e"),e.find(".small-9").append(a.name),""!=d&&e.find(".small-9").append("\x3csmall\x3e(Version:"+d+")\x3c/small\x3e"),e.append("\x3cdiv class\x3d'small-3 columns'\x3e\x3cdiv class\x3d'rowToolbar'\x3e\x3cspan class\x3d'fa-stack fa-lg dataViewBtn' style\x3d'font-size: 0.45rem;margin-right:.8rem;' title\x3d'Load All Relationships'\x3e\x3ci class\x3d'fa fa-refresh fa-stack-2x' style\x3d'font-size: 3em;top: -4px;'\x3e\x3c/i\x3e\x3ci class\x3d'fa fa-plus fa-stack-1x' style\x3d'top: -2px;'\x3e\x3c/i\x3e\x3c/span\x3e \x3ca style\x3d'color:inherit;'\x3e\x3ci title\x3d'View Competency' class\x3d'fa fa-external-link dataViewBtn' style\x3d'margin-right:1rem;'\x3e\x3c/a\x3e\x3c/i\x3e\x3c/div\x3e\x3c/div\x3e"),
e.find(".fa-stack").click(function(b){b.preventDefault();$(this).find(".fa-plus").hasClass("hide")||($(this).find(".fa-plus").addClass("hide"),$(this).find(".fa-refresh").addClass("fa-spin"),a.rollupRules(AppController.serverController.getRepoInterface(),null,function(a){ViewManager.getView("#rollupRuleSearchMessageContainer").displayAlert("Error getting all rules: "+a);e.find(".fa-refresh").removeClass("fa-spin");e.find(".fa-plus").removeClass("hide")},function(a){e.nextAll(".competencyAggregateRow").first().before("\x3cdiv class\x3d'row column loadingRow' style\x3d'text-align:center;padding:7px 2px;font-style:italic;'\x3eLoading...\x3c/div\x3e");
ViewManager.getView("#rollupRuleSearchResults").populate(a);e.find(".fa-stack").remove();e.nextAll(".loadingRow").first().remove();e.find(".rowToolbar").css("padding-top","5px")}))}),e.find("a").attr("href","#"+CompetencyViewScreen.prototype.getDisplayName()+"?id\x3d"+c),e.find("a").click(function(b){b.preventDefault();ScreenManager.changeScreen(new CompetencyViewScreen(a));return!1})):e=$("#rollupRuleSearchResults .competencyAggregateRow[data-competencyId\x3d'"+f+"']");0<e.nextAll(".competencyAggregateRow").size()?
e.nextAll(".competencyAggregateRow").first().before(b):0<e.nextAll(".row").size()?e.nextAll(".row").last().after(b):e.after(b)},function(a){ViewManager.getView("#rollupRuleSearchMessageContainer").displayAlert("Error Retrieving Aggregate Competency:"+a);var c;0==$("#rollupRuleSearchResults .competencyAggregateRow[data-competencyId\x3dunknown]").size()?($("#rollupRuleSearchResults #rollupRuleResults-data").prepend("\x3cdiv class\x3d'row column competencyAggregateRow' data-competencyId\x3d'unknown'\x3e\x3c/div\x3e"),
c=$("#rollupRuleSearchResults .competencyAggregateRow[data-competencyId\x3d'unknown']"),c.append($("\x3cinput type\x3d'checkbox' class\x3d'datum-select'\x3e\x3c/input\x3e)")),c.on("click",".datum-select",function(a){$(".dataView").find(".datum-select:checked").size()==$("#rollupRuleResults-data .row").size()?$(".toggleSelectData").text("Unselect All"):$(".toggleSelectData").text("Select All");if($(a.target).is(":checked")){var b=c.siblings("[data-aggregateId\x3d'"+shortCompId+"']");b.addClass("selected");
b.find(".datum-select").prop("checked","checked");var b=ViewManager.getView("#rollupRuleSearchResults").getSelected(),d=!0,f;for(f in b){var e=b[f];AppController.identityController.owns(e)||(d=!1)}d?($("#rollupRuleResults-menu").find(".fa-group").removeClass("hide"),$("#rollupRuleResults-menu").find(".fa-trash").removeClass("hide")):($("#rollupRuleResults-menu").find(".fa-group").addClass("hide"),AppController.serverController.getAdmin()||$("#rollupRuleResults-menu").find(".fa-trash").addClass("hide"))}else{b=
c.siblings("[data-aggregateId\x3d'"+shortCompId+"']");b.removeClass("selected");b.find(".datum-select").removeAttr("checked");b=ViewManager.getView("#rollupRuleSearchResults").getSelected();d=!0;for(f in b)e=b[f],AppController.identityController.owns(e)||(d=!1);d&&($("#rollupRuleResults-menu").find(".fa-group").removeClass("hide"),$("#rollupRuleResults-menu").find(".fa-trash").removeClass("hide"))}$(a.target).closest(".dataView").find(".datum-select").is(":checked")?($(a.target).closest(".dataView").addClass("selecting"),
$("#rollupRuleResults-menu").is(":visible")||$("#rollupRuleResults-menu").slideDown(),$(".dataViewMenu .dataViewSelected").text($(".dataView").find("[data-id] .datum-select:checked").size())):($(a.target).closest(".dataView").removeClass("selecting"),$("#rollupRuleResults-menu").is(":visible")&&$("#rollupRuleResults-menu").slideUp())}),c.attr("style","padding:7px 2px;padding-left:30px;background-color:#f3f3f3;cursor:default;color:#f74646;font-weight:500;"),c.append("\x3cdiv class\x3d'small-12 columns'\x3e\x3c/div\x3e"),
c.find(".small-12").append("Unknown Competency")):c=$("#rollupRuleSearchResults .competencyAggregateRow[data-competencyId\x3d'unknown']");0<c.nextAll(".competencyAggregateRow").size()?c.nextAll(".competencyAggregateRow").first().before(b):0<c.nextAll(".row").size()?c.nextAll(".row").last().after(b):c.after(b)})):$("#rollupRuleSearchResults #rollupRuleResults-data").append(b)},buildDataRow:function(b,d,a){"Competency"==$("#rollupRuleSearchResults #rollupRuleResults-sortSelect").val()&&void 0!=a.competency?
b.append("\x3ca\x3e\x3cdiv class\x3d'small-3 columns datum-name'\x3e\x3c/div\x3e\x3c/a\x3e\x3cdiv class\x3d'small-6 columns datum-description'\x3e\x3c/div\x3e\x3cdiv class\x3d'small-3 columns datum-owner'\x3e\x3c/div\x3e"):b.append("\x3ca\x3e\x3cdiv class\x3d'small-2 columns end datum-name'\x3e\x3c/div\x3e\x3c/a\x3e\x3cdiv class\x3d'small-4 columns datum-description'\x3e\x3c/div\x3e\x3cdiv class\x3d'small-3 columns datum-competency'\x3e\x3c/div\x3e\x3cdiv class\x3d'small-3 columns datum-owner'\x3e\x3c/div\x3e");
if(void 0==a.owner||0==a.owner.length)b.find(".datum-owner").html("Public");else for(var c in a.owner){var f=EcRemoteLinkedData.trimVersionFromUrl(d),e=f.split("/")[f.split("/").length-1]+"-owner-"+c,f=$("\x3cspan id\x3d'"+e+"'\x3e\x3c/span\x3e");b.find(".datum-owner").append(f);var g=function(){0<$("#"+e).size()?ViewManager.showView(new IdentityDisplay(a.owner[c]),"#"+e):setTimeout(g,500)};setTimeout(g,500)}0<b.find(".datum-competency").size()&&(EcCompetency.get(a.competency,function(a){b.find(".datum-competency").html("for \x3cspan style\x3d'font-style:italic;'\x3e\x3c/span\x3e");
b.find(".datum-competency span").text(a.getName())},function(){b.find(".datum-competency").text("Unknown Competency")}),b.find(".datum-competency").text("Loading.."));void 0!=a.name&&""!=a.name&&b.find(".datum-name").text(a.name);void 0!=a.description&&""!=a.description&&b.find(".datum-description").text(a.description);b.find("a").click(function(b){b.preventDefault();ScreenManager.changeScreen(new CompetencyViewScreen({id:a.competency}),function(){ModalManager.showModal(new EditRollupRuleModal(a,
function(){ScreenManager.reloadCurrentScreen()}))})})}}),"#rollupRuleSearchResults");$("#rollupRuleSearchSubmit").click(function(b){b.preventDefault();l()});$("#rollupRuleSearchOwnership").change(function(b){b.preventDefault();l()});$("#rollupRuleSearchText").keypress(function(b){13==b.which&&l()});null!=b&&$("#rollupRuleSearchText").val(b);AppController.loginController.getLoggedIn()?($("#rollupRuleSearchOwnership").attr("max",4),$("#rollupRuleSearchOwnershipLoggedIn").removeClass("hide"),$("#rollupRuleSearchOwnershipPublic").addClass("hide")):
($("#rollupRuleSearchOwnershipLoggedIn").addClass("hide"),$("#rollupRuleSearchOwnershipPublic").removeClass("hide"));null!=d&&("public"==d?d=1:"owned"==d?d=3:"me"==d&&(d=4),$("#rollupRuleSearchOwnership").val(d));l();ViewManager.getView("#menuContainer").showSortBasic();ViewManager.getView("#menuContainer").showSortByCompetency()};e.prototype.onClose=function(){ViewManager.getView("#menuContainer").hideSort()};e.prototype.sortByTimestamp=function(){$("#rollupRuleResults-sortSelect").val("timestamp");
$("#rollupRuleResults-sortSelect").trigger("change")};e.prototype.sortByOwner=function(){$("#rollupRuleResults-sortSelect").val("owner");$("#rollupRuleResults-sortSelect").trigger("change")};e.prototype.filterPublic=function(){$("#rollupRuleSearchOwnership").val(1);l()};e.prototype.filterAll=function(){$("#rollupRuleSearchOwnership").val(2);l()};e.prototype.filterOwned=function(){$("#rollupRuleSearchOwnership").val(3);l()};e.prototype.filterOwnedByMe=function(){AppController.loginController.getLoggedIn()&&
($("#rollupRuleSearchOwnership").val(4),l())};e.prototype.setParams=function(b){void 0==b?this.clearParams():(this.query=b.query,this.ownership=b.ownership)};e.prototype.clearParams=function(){this.ownership=this.query=void 0};return e}(RollupRuleSearchScreen);
var SaveIdModal=function(e){function l(){ModalManager.hideModal();AppMenu.prototype.rebuildIdentityList()}function k(d){ViewManager.getView("#saveIdentityMessageContainer").displayAlert(d)}e.prototype.display=function(d){d=this.msg;ViewManager.showView(new MessageContainer("saveId"),"#saveIdentityMessageContainer");void 0==d&&(d="Something has changed...");$("#saveMessageContainer").text(d);$("#saveId").click(function(b){AppController.loginController.save(l,k)});$("#skipSaveId").click(function(b){ModalManager.hideModal()})};
return e}(SaveIdModal);
UserAdminScreen=function(e){e.prototype.display=function(e){ViewManager.showView(new MessageContainer("userAdmin"),"#userAdminMessageContainer");ViewManager.showView(new MessageContainer("moodleToCass"),"#moodleToCassMessageContainer");ViewManager.showView(new MessageContainer("cassToMoodle"),"#cassToMoodleMessageContainer");ViewManager.showView(new MessageContainer("database"),"#databaseMessageContainer");$("#xapiAdapterConfigureBtn").click(function(e){e.preventDefault();$(".configRow").addClass("hide");$("#xapiConfiguration").removeClass("hide")});
$("#moodleAdapterConfigureBtn").click(function(e){e.preventDefault();$(".configRow").addClass("hide");$("#moodleConfiguration").removeClass("hide")});XapiConfig.get(AppController.serverController.selectedServerUrl,function(e){null!=e&&(e.enabled?$("#xapiAdapterEnabledSwitch").prop("checked",!0):$("#xapiAdapterEnabledSwitch").prop("checked",!1),null!=e.xapiEndpoint&&$("#xapiEndpointInput").val(e.xapiEndpoint),null!=e.xapiHostName&&$("#xapiEndpointHostnameInput").val(e.xapiHostName),null!=e.xapiAuth&&
$("#xapiAuthKeyInput").val(e.xapiAuth))},function(e){});$("#xapiSaveBtn").click(function(e){e.preventDefault();e=new XapiConfig;e.enabled=$("#xapiAdapterEnabledSwitch").prop("checked");e.xapiEndpoint=$("#xapiEndpointInput").val();e.xapiHostName=$("#xapiEndpointHostnameInput").val();e.xapiAuth=$("#xapiAuthKeyInput").val();e.save(AppController.serverController.selectedServerUrl,function(){$("#xapiConfiguration").effect("highlight",{},1500)},function(){})});MoodleConfig.get(AppController.serverController.selectedServerUrl,
function(e){null!=e&&(e.moodleToCassEnabled?($("#moodleToCassEnabledSwitch").prop("checked",!0),$("#moodleToCassContainer").removeClass("hide"),$("#moodleToCassBtn").removeAttr("disabled")):($("#moodleToCassEnabledSwitch").prop("checked",!1),$("#moodleToCassContainer").addClass("hide"),$("#moodleToCassBtn").attr("disabled","disabled")),e.cassToMoodleEnabled?($("#cassToMoodleEnabledSwitch").prop("checked",!0),$("#cassToMoodleContainer").removeClass("hide"),$("#cassToMoodleBtn").removeAttr("disabled")):
($("#cassToMoodleEnabledSwitch").prop("checked",!1),$("#cassToMoodleContainer").addClass("hide"),$("#cassToMoodleBtn").attr("disabled","disabled")),null!=e.moodleEndpoint&&$("#moodleEndpointInput").val(e.moodleEndpoint),null!=e.moodleToken&&$("#moodleTokenInput").val(e.moodleToken))},function(e){});$("#moodleToCassEnabledSwitch").on("change",function(){$("#moodleToCassEnabledSwitch").is(":checked")?$("#moodleToCassContainer").removeClass("hide"):$("#moodleToCassContainer").addClass("hide")});$("#cassToMoodleEnabledSwitch").on("change",
function(){$("#cassToMoodleEnabledSwitch").is(":checked")?$("#cassToMoodleContainer").removeClass("hide"):$("#cassToMoodleContainer").addClass("hide")});$("#moodleSaveBtn").click(function(e){e.preventDefault();e=new MoodleConfig;e.moodleToCassEnabled=$("#moodleToCassEnabledSwitch").prop("checked");e.cassToMoodleEnabled=$("#cassToMoodleEnabledSwitch").prop("checked");e.moodleEndpoint=$("#moodleEndpointInput").val();e.moodleToken=$("#moodleTokenInput").val();e.save(AppController.serverController.selectedServerUrl,
function(){$("#moodleConfiguration").effect("highlight",{},1500);$("#cassToMoodleEnabledSwitch").is(":checked")?$("#cassToMoodleBtn").removeAttr("disabled"):$("#cassToMoodleBtn").attr("disabled","disabled");$("#moodleToCassEnabledSwitch").is(":checked")?$("#moodleToCassBtn").removeAttr("disabled"):$("#moodleToCassBtn").attr("disabled","disabled")},function(){})});$("#moodleToCassBtn").click(function(){void 0!=$("#moodleToCassBtn").attr("disabled")&&""!=$("#moodleToCassBtn").attr("disabled")?(ViewManager.getView("#moodleToCassMessageContainer").displayWarning("Save Moodle Configuration First"),
$("#moodleSaveBtn").effect("highlight",{},1500)):(ViewManager.getView("#moodleToCassMessageContainer").clearWarning(),$("#moodleToCassSyncing").removeClass("hide"),$("#moodleToCassBtn").attr("disabled","disabled"),MoodleConfig.syncMoodleToCass(AppController.serverController.selectedServerUrl,function(e){$("#moodleToCassSyncing").addClass("hide");$("#moodleToCassBtn").removeAttr("disabled");ViewManager.getView("#moodleToCassMessageContainer").clearAlert();ViewManager.getView("#moodleToCassMessageContainer").displaySuccess("Successfully Synced")},
function(e){$("#moodleToCassSyncing").addClass("hide");$("#moodleToCassBtn").removeAttr("disabled");ViewManager.getView("#moodleToCassMessageContainer").clearSuccess();ViewManager.getView("#moodleToCassMessageContainer").displayAlert("Error Syncing: "+error)}))});$("#cassToMoodleBtn").click(function(){void 0!=$("#cassToMoodleBtn").attr("disabled")&&""!=$("#cassToMoodleBtn").attr("disabled")?(ViewManager.getView("#cassToMoodleMessageContainer").displayWarning("Save Moodle Configuration First"),$("#moodleSaveBtn").effect("highlight",
{},1500)):(ViewManager.getView("#cassToMoodleMessageContainer").clearWarning(),$("#cassToMoodleSyncing").removeClass("hide"),$("#cassToMoodleBtn").attr("disabled","disabled"),MoodleConfig.syncCassToMoodle(AppController.serverController.selectedServerUrl,function(e){$("#cassToMoodleSyncing").addClass("hide");$("#cassToMoodleBtn").removeAttr("disabled");ViewManager.getView("#cassToMoodleMessageContainer").clearAlert();ViewManager.getView("#cassToMoodleMessageContainer").displaySuccess("Successfully Synced")},
function(e){$("#cassToMoodleSyncing").addClass("hide");$("#cassToMoodleBtn").removeAttr("disabled");ViewManager.getView("#cassToMoodleMessageContainer").clearSuccess();ViewManager.getView("#cassToMoodleMessageContainer").displayAlert("Error Syncing: "+error)}))});$("#skyrepoBackup").click(function(){var e=prompt("Please enter the Server Secret (from the .secret file on the CASS Server) to complete the backup");AppController.serverController.repoInterface.backup(e,function(){ViewManager.getView("#databaseMessageContainer").clearAlert();
ViewManager.getView("#databaseMessageContainer").displaySuccess("Successfully backed up database")},function(d){d="Error backing up database: "+d;ViewManager.getView("#databaseMessageContainer").displayAlert(d);ViewManager.getView("#databaseMessageContainer").clearSuccess()})});$("#skyrepoRestore").click(function(){var e=prompt("Please enter the Server Secret (from the .secret file on the CASS Server) to complete the restore");AppController.serverController.repoInterface.restoreBackup(e,function(){ViewManager.getView("#databaseMessageContainer").clearAlert();
ViewManager.getView("#databaseMessageContainer").displaySuccess("Successfully restored database")},function(d){d="Error restoring database: "+d;ViewManager.getView("#databaseMessageContainer").displayAlert(d);ViewManager.getView("#databaseMessageContainer").clearSuccess()})});$("#skyrepoWipe").click(function(){var e=prompt("Please enter the Server Secret (from the .secret file on the CASS Server) to complete the database wipe");AppController.serverController.repoInterface.wipe(e,function(){ViewManager.getView("#databaseMessageContainer").clearAlert();
ViewManager.getView("#databaseMessageContainer").displaySuccess("Successfully wiped database")},function(d){d="Error wiping database: "+d;ViewManager.getView("#databaseMessageContainer").displayAlert(d);ViewManager.getView("#databaseMessageContainer").clearSuccess()})})};return e}(UserAdminScreen);
UserIdentityScreen=function(e){function l(b){$("#identityKeys").html("");$("#addKeyIv").val("");for(var c in b){var d=$("\x3cdiv class\x3d'identityKey' style\x3d'min-height:1.33rem;'\x3e\x3c/div\x3e"),a=b[c],e=a.ppk.toPem().replaceAll("\r?\n",""),g=a.displayName,h=$("\x3cspan class\x3d'has-tip'\x3e\x3c/span\x3e");h.attr("title",e);var k=function(){copyTextToClipboard(e);alert("Copied Key to Clipboard")};h.on("click",k);h.text(g);d.append(h);var l=$("\x3ci class\x3d'fa fa-pencil float-right'\x3e\x3c/i\x3e");
l.on("click",function(){var b=h.text();l.addClass("hide");h.off("click");h.removeClass("has-tip");h.attr("contenteditable",!0);h.focus();var c,d;window.getSelection&&document.createRange?(d=document.createRange(),d.selectNodeContents(h.get(0)),d.collapse(!0),c=window.getSelection(),c.removeAllRanges(),c.addRange(d)):document.body.createTextRange&&(d=document.body.createTextRange(),d.moveToElementText(h.get(0)),d.collapse(!0),d.select());h.blur(function(){""==h.text()?h.text(b):b!=h.text()&&(a.displayName=
h.text(),ModalManager.showModal(new SaveIdModal));h.off("click");h.on("click",k);h.addClass("has-tip");l.removeClass("hide")})});d.append(l);$("#identityKeys").append(d);d=$("\x3coption\x3e\x3c/option\x3e");d.attr("value",e);d.text(g);$("#shareContactIdentity").append(d)}}function k(b){$("#contactList").html("");for(var c in b){var d=b[c].pk.toPem().replaceAll("\r?\n",""),a=b[c].displayName,e=$("\x3cspan\x3e\x3c/span\x3e");e.attr("title",d);e.text(a);$("#contactList").append(e);$("#contactList").append($("\x3cbr/\x3e"))}}
function d(b){if(0==b.length)$("#addKeyPpk").addClass("is-invalid-label");else if($("#addKeyPpk").removeClass("is-invalid-label"),is(b,"FileList"))for(var c in b){var d=b[c],a=new FileReader;a.onload=function(a,b){return function(c){AppController.identityController.addKey(b.result,a.name.replace(".pem",""),function(){l(EcIdentityManager.ids);AppController.loginController.loginServer.fetchServerAdminKeys(function(a){for(var b=0;b<EcIdentityManager.ids.length;b++)-1!=a.indexOf(EcIdentityManager.ids[b].ppk.toPk().toPem())&&
(AppController.loginController.setAdmin(!0),ViewManager.getView("#menuContainer").checkAdmin())},function(){});1==EcIdentityManager.ids.length&&AppController.identityController.select(EcIdentityManager.ids[0].ppk.toPem());ModalManager.showModal(new SaveIdModal);$("#addKeyPpk").replaceWith($("#addKeyPpk").val("").clone(!0));ViewManager.getView("#menuContainer").rebuildIdentityList()})}}(d,a);is(d,"File")&&a.readAsText(d)}}function b(b,c){var d=window.document.location.hash.split("?");if(1<d.length&&
(d=d[1],d.startsWith("action"))){var a=d.split("\x26");if(6==a.length&&a[0].startsWith("action")&&a[1].startsWith("contactDisplayName")&&a[2].startsWith("contactKey")&&a[3].startsWith("contactServer")&&a[4].startsWith("responseToken")&&a[5].startsWith("responseSignature")&&(d=a[0].split("\x3d"),1<d.length&&"newContact"==d[1])){var d=decodeURIComponent(a[1].split("\x3d")[1]),e=decodeURIComponent(a[2].split("\x3d")[1]),g=decodeURIComponent(a[3].split("\x3d")[1]),h=decodeURIComponent(a[4].split("\x3d")[1]),
a=decodeURIComponent(a[5].split("\x3d")[1]),l=new EcContact;l.displayName=d;l.pk=EcPk.fromPem(e);l.source=g;null==EcIdentityManager.getContact(l.pk)&&(EcIdentityManager.addContact(l),k(EcIdentityManager.contacts),ModalManager.showModal(new ContactGrantModal(l,h,a,function(){ModalManager.showModal(new SaveIdModal("You have added a contact"))})));ScreenManager.replaceHistory(b,c,null)}}}function h(){if(document.selection){document.selection.empty();var b=document.body.createTextRange();b.moveToElementText(document.getElementById("invitationContainer"));
b.select()}else window.getSelection&&(window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges(),b=document.createRange(),b.selectNode(document.getElementById("invitationContainer")),window.getSelection().addRange(b));document.removeEventListener("copy",copyEvent,!0);document.removeEventListener("copy",copyEvent,!1);try{var c=document.execCommand("copy");console.log("Copying text command was "+(c?"successful":"unsuccessful"));
c?($("#copyInvitation").find("#copy").css("display","none"),$("#copyInvitation").find("#copied").css("display","inline-block"),$("#copyInvitation").find("#copied").fadeOut(1E3,function(){$("#copyInvitation").find("#copy").css("display","inline-block")}),ViewManager.getView("#invitationMessageContainer").displaySuccess("Succesfully Copied to Clipboard"),setTimeout(function(){ViewManager.getView("#invitationMessageContainer").clearSuccess()},3E3)):(ViewManager.getView("#invitationMessageContainer").displayWarning("Unable to Copy to Clipboard"),
ViewManager.getView("#invitationMessageContainer").clearSuccess())}catch(f){console.log("Oops, unable to copy"),ViewManager.getView("#invitationMessageContainer").displayWarning("Unable to Copy to Clipboard"),ViewManager.getView("#invitationMessageContainer").clearSuccess()}document.addEventListener("copy",copyEvent)}function g(){AppController.serverController.getRepoInterface().search((new EcContactGrant).getSearchStringByType(),function(b){EcRepository.get(b.shortId(),function(b){var c=new EcEncryptedValue;
c.copyFrom(b);b=c.decryptIntoObject();null!=b&&(c=new EcContactGrant,c.copyFrom(b),c.valid()&&ModalManager.showModal(new ContactAcceptModal(c,function(){k(EcIdentityManager.contacts);ModalManager.showModal(new SaveIdModal("You have added a contact"))})))},null)},null,null)}e.prototype.display=function(e){ViewManager.showView(new MessageContainer("userIdentity"),"#userIdentityMessageContainer");ViewManager.showView(new MessageContainer("copyInvitation"),"#invitationMessageContainer");AppController.loginController.getLoggedIn()&&
(b(this,e),k(EcIdentityManager.contacts),g());$("#adminButton").click(function(b){b.preventDefault();ScreenManager.changeScreen(new UserAdminScreen)});AppController.loginController.getAdmin()||$("#adminButtonContainer").remove();l(EcIdentityManager.ids);$("#identityServerName").text(AppController.serverController.selectedServerName);$("#identityServerUrl").text(AppController.serverController.selectedServerUrl);$("#importIdentity").click(function(b){b.preventDefault();$("#importContainer").removeClass("hide");
$("#generateContainer").addClass("hide")});$("#startGenerateIdentity").click(function(b){b.preventDefault();$("#generateContainer").removeClass("hide");$("#importContainer").addClass("hide")});$("#createImportIdentity").click(function(b){b.preventDefault();d($("#addKeyPpk")[0].files)});$("#generateIdentity").click(function(){$("#generateInProgress").removeClass("hide");$("#generateIdentity").addClass("hide");var b=$("#generateIdentityName").val();AppController.identityController.generateIdentity(function(b){l(EcIdentityManager.ids);
download(b.displayName+".pem",b.ppk.toPem());ModalManager.showModal(new SaveIdModal("Your identities have changed"));$("#generateIdentity").removeClass("hide");$("#generateInProgress").addClass("hide")},b)});$("#openSaveModal").click(function(){ModalManager.showModal(new SaveIdModal)});$("#generateInvitation").click(function(){var b=$("#shareContactName").val();if(void 0!=b&&""!=b){var d=EcPpk.fromPem($("#shareContactIdentity").val());if(void 0!=d&&""!=d){var a="Hi, I would like to add you as a contact in CASS.\n\nIf we are using the same CASS system, you may click the following link. If not, change the URL of my CASS server ("+
window.location.href.split("/")[2]+") to yours.\n\n",e=EcAes.newIv(32),b=window.location+"?action\x3dnewContact\x26contactDisplayName\x3d"+encodeURIComponent(b)+"\x26contactKey\x3d"+encodeURIComponent(d.toPk().toPem())+"\x26contactServer\x3d"+encodeURIComponent(AppController.serverController.selectedServerUrl)+"\x26responseToken\x3d"+encodeURIComponent(e)+"\x26responseSignature\x3d"+encodeURIComponent(EcRsaOaep.sign(d,e)),a=a.replaceAll("Hi,","Hi, \x3cbr/\x3e\x3cbr/\x3e");$("#invitationBox").html(a);
$("#linkBox").text(b);$("#invitationContainer").removeClass("hide");$("#invitationContainerHeader").removeClass("hide");$("#copyInvitation").removeClass("hide");$("#generateInvitation").text("Re-Generate");$("#invitationContainer").click(function(a){"invitationBox"!=$(a.target).attr("id")&&h()});$("#copyInvitation").mousedown(function(){h()});setTimeout(function(){h()},100)}}})};e.prototype.refreshIdentities=function(b){l(b)};return e}(UserIdentityScreen);
WelcomeScreen=function(e){e.prototype.display=function(e){};return e}(WelcomeScreen);